// Fig 1. WARP Data Storage
// Style: Git object vocabulary (i)
// Shows: Normal Git commits vs WARP patch commits — invisible to normal Git workflows

digraph data_storage {
  bgcolor=transparent
  rankdir=TB
  newrank=true
  fontname="Times-Roman"
  fontsize=11
  label=<<I>Fig. 1.  WARP Data Storage — invisible to normal Git workflows</I>>
  labelloc=b
  labeljust=c

  node [fontname="Times-Roman", fontsize=10, penwidth=0.8]
  edge [fontname="Times-Roman", fontsize=8, penwidth=0.8]

  // --- Normal Git side ---
  subgraph cluster_normal {
    label=<<B>Normal Git Objects</B>>
    labelloc=t
    style=rounded
    color="#606060"
    penwidth=0.8
    fontname="Times-Roman"
    fontsize=9

    HEAD [shape=box, style="dashed,filled", fillcolor=white, label="HEAD"]
    main_ref [shape=box, style="dashed,filled", fillcolor=white, label="refs/heads/main"]
    HEAD -> main_ref [style=dashed, penwidth=0.5]

    C3 [shape=box, style="rounded,filled", fillcolor="#e8e8e8",
        label=<C3<BR/><FONT FACE="Courier" POINT-SIZE="8">a1b2c3d</FONT>>]
    C2 [shape=box, style="rounded,filled", fillcolor="#e8e8e8",
        label=<C2<BR/><FONT FACE="Courier" POINT-SIZE="8">e4f5a6b</FONT>>]
    C1 [shape=box, style="rounded,filled", fillcolor="#e8e8e8",
        label=<C1<BR/><FONT FACE="Courier" POINT-SIZE="8">7c8d9e0</FONT>>]

    main_ref -> C3 [style=dashed, penwidth=0.5]
    C3 -> C2 [label="parent"]
    C2 -> C1 [label="parent"]

    T3 [shape=folder, style=filled, fillcolor="#f0f0f0", label="tree"]
    C3 -> T3 [label="tree", penwidth=0.5]

    src_blob [shape=ellipse, style=filled, fillcolor=white, label="src/index.js"]
    pkg_blob [shape=ellipse, style=filled, fillcolor=white, label="package.json"]
    T3 -> src_blob [penwidth=0.5]
    T3 -> pkg_blob [penwidth=0.5]
  }

  // --- WARP side ---
  subgraph cluster_warp {
    label=<<B>WARP Patch Objects</B>>
    labelloc=t
    style=rounded
    color="#606060"
    penwidth=0.8
    fontname="Times-Roman"
    fontsize=9

    warp_ref [shape=box, style="dashed,filled", fillcolor=white,
              label=<refs/warp/myGraph/<BR/>writers/alice>]

    P3 [shape=box, style="rounded,filled", fillcolor="#e8e8e8",
        label=<P3  <FONT FACE="Courier" POINT-SIZE="8">lamport=3</FONT><BR/><FONT FACE="Courier" POINT-SIZE="8">f1a2b3c</FONT>>]
    P2 [shape=box, style="rounded,filled", fillcolor="#e8e8e8",
        label=<P2  <FONT FACE="Courier" POINT-SIZE="8">lamport=2</FONT><BR/><FONT FACE="Courier" POINT-SIZE="8">d4e5f6a</FONT>>]
    P1 [shape=box, style="rounded,filled", fillcolor="#e8e8e8",
        label=<P1  <FONT FACE="Courier" POINT-SIZE="8">lamport=1</FONT><BR/><FONT FACE="Courier" POINT-SIZE="8">b7c8d9e</FONT>>]

    warp_ref -> P3 [style=dashed, penwidth=0.5]
    P3 -> P2 [label="parent"]
    P2 -> P1 [label="parent"]

    WT3 [shape=folder, style=filled, fillcolor="#f0f0f0", label="tree"]
    P3 -> WT3 [label="tree", penwidth=0.5]

    patch_blob [shape=ellipse, style=filled, fillcolor=white,
                label=<patch.cbor>]
    content_blob [shape=ellipse, style=filled, fillcolor=white,
                  label=<_content_*>]
    WT3 -> patch_blob [penwidth=0.5]
    WT3 -> content_blob [penwidth=0.5]
  }

  // --- Invisible-to-git-log annotation ---
  // WARP data lives under refs/warp/ — invisible to git log, git diff, git status
  invisible_note [shape=none, margin=0, fontsize=9, fontname="Times-Roman",
                  label=<<TABLE BORDER="0" CELLBORDER="0" CELLSPACING="0">
                    <TR><TD>visible to <FONT FACE="Courier">git log</FONT></TD></TR>
                    <HR/>
                    <TR><TD>invisible to <FONT FACE="Courier">git log</FONT><BR/>
                    (lives under <FONT FACE="Courier">refs/warp/</FONT>)</TD></TR>
                  </TABLE>>]

  // Ranking
  {rank=same; HEAD; warp_ref}
  {rank=same; C3; P3}
  {rank=same; C1; P1}
  {rank=same; T3; WT3}
}
