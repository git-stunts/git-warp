// Fig 7. Checkpoint Tree Structure
// Style: Git object vocabulary (i)
// Shows: Checkpoint commit with tree entries and their roles

digraph checkpoint_tree {
  bgcolor=transparent
  rankdir=TB
  fontname="Times-Roman"
  fontsize=11
  label=<<I>Fig. 7.  Checkpoint Tree — snapshot for fast recovery</I>>
  labelloc=b
  labeljust=c
  nodesep=0.4
  ranksep=0.5

  node [fontname="Times-Roman", fontsize=10, penwidth=0.8]
  edge [fontname="Times-Roman", fontsize=8, penwidth=0.8]

  // Checkpoint ref
  ckpt_ref [shape=box, style="dashed,filled", fillcolor=white,
            label=<refs/warp/&lt;graph&gt;/<BR/>checkpoints/head>]

  // Checkpoint commit
  commit [shape=none, margin=0,
          label=<<TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" BGCOLOR="#e8e8e8">
            <TR><TD><B>Checkpoint Commit</B><BR/><FONT FACE="Courier" POINT-SIZE="8">7c8d9e0...</FONT></TD></TR>
            <TR><TD ALIGN="LEFT"><FONT FACE="Courier" POINT-SIZE="8">eg-kind: checkpoint</FONT><BR ALIGN="LEFT"/>
              <FONT FACE="Courier" POINT-SIZE="8">eg-checkpoint: 1</FONT><BR ALIGN="LEFT"/></TD></TR>
          </TABLE>>]

  ckpt_ref -> commit [style=dashed, penwidth=0.5]

  // Tree
  tree [shape=folder, style=filled, fillcolor="#f0f0f0",
        label=<tree<BR/><FONT FACE="Courier" POINT-SIZE="7">a1b2c3d...</FONT>>]
  commit -> tree [label="tree"]

  // Tree entries — blobs
  state_cbor [shape=ellipse, style="filled,bold", fillcolor="#d0d0d0", penwidth=1.2,
              label=<state.cbor<BR/><FONT POINT-SIZE="8"><B>AUTHORITATIVE</B></FONT>>]
  visible_cbor [shape=ellipse, style=filled, fillcolor=white,
                label=<visible.cbor<BR/><FONT POINT-SIZE="8"><I>cache only</I></FONT>>]
  frontier_cbor [shape=ellipse, style=filled, fillcolor=white,
                 label=<frontier.cbor>]
  applied_vv [shape=ellipse, style=filled, fillcolor=white,
              label=<appliedVV.cbor>]
  provenance [shape=ellipse, style=filled, fillcolor=white,
              label=<provenanceIndex.cbor<BR/><FONT POINT-SIZE="8"><I>optional</I></FONT>>]
  content [shape=ellipse, style=filled, fillcolor="#f0f0f0",
           label=<_content_*<BR/><FONT POINT-SIZE="8">GC anchors</FONT>>]

  // Tree to blob connections
  tree -> state_cbor [penwidth=0.8]
  tree -> visible_cbor [penwidth=0.5]
  tree -> frontier_cbor [penwidth=0.5]
  tree -> applied_vv [penwidth=0.5]
  tree -> provenance [penwidth=0.5, style=dashed]
  tree -> content [penwidth=0.5]

  // Annotation
  note [shape=plaintext, fontsize=8, fontname="Times-Roman",
        label=<state.cbor is the single source of truth;<BR/>all other entries are derived caches or GC anchors>]

  state_cbor -> note [style=invis]
}
