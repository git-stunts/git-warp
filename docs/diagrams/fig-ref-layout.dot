// Fig 3. Git Ref Layout
// Style: Git object vocabulary (i)
// Shows: Tree structure of refs/warp/<graph>/ namespace

digraph ref_layout {
  bgcolor=transparent
  rankdir=TB
  fontname="Times-Roman"
  fontsize=11
  label=<<I>Fig. 3.  Ref Layout â€” the refs/warp/ namespace</I>>
  labelloc=b
  labeljust=c
  nodesep=0.6
  ranksep=0.5

  node [fontname="Times-Roman", fontsize=10, penwidth=0.8]
  edge [fontname="Times-Roman", fontsize=8, penwidth=0.8]

  // Directory nodes (folders)
  refs [shape=folder, style=filled, fillcolor="#f0f0f0", label="refs/"]
  warp [shape=folder, style=filled, fillcolor="#f0f0f0", label="warp/"]
  graphdir [shape=folder, style=filled, fillcolor="#f0f0f0",
            label=<&lt;graphName&gt;/>]
  writers [shape=folder, style=filled, fillcolor="#f0f0f0", label="writers/"]
  checkpoints [shape=folder, style=filled, fillcolor="#f0f0f0", label="checkpoints/"]
  coverage [shape=folder, style=filled, fillcolor="#f0f0f0", label="coverage/"]
  cursor [shape=folder, style=filled, fillcolor="#f0f0f0", label="cursor/"]
  saved [shape=folder, style=filled, fillcolor="#f0f0f0", label="saved/"]
  audit [shape=folder, style=filled, fillcolor="#f0f0f0", label="audit/"]
  trust [shape=folder, style=filled, fillcolor="#f0f0f0", label="trust/"]

  // Leaf refs (dashed boxes pointing to commits)
  alice_ref [shape=box, style="dashed,filled", fillcolor=white, label="alice"]
  bob_ref [shape=box, style="dashed,filled", fillcolor=white, label="bob"]
  ckpt_head [shape=box, style="dashed,filled", fillcolor=white, label="head"]
  cov_head [shape=box, style="dashed,filled", fillcolor=white, label="head"]
  cur_active [shape=box, style="dashed,filled", fillcolor=white, label="active"]
  bookmark [shape=box, style="dashed,filled", fillcolor=white, label="bookmark"]
  audit_alice [shape=box, style="dashed,filled", fillcolor=white, label="alice"]
  audit_bob [shape=box, style="dashed,filled", fillcolor=white, label="bob"]
  trust_rec [shape=box, style="dashed,filled", fillcolor=white, label="records"]
  seek_cache [shape=box, style="dashed,filled", fillcolor=white, label="seek-cache"]

  // Commit targets
  c_alice [shape=box, style="rounded,filled", fillcolor="#e8e8e8",
           label=<patch commit<BR/><FONT FACE="Courier" POINT-SIZE="7">a1b2c3d</FONT>>]
  c_bob [shape=box, style="rounded,filled", fillcolor="#e8e8e8",
         label=<patch commit<BR/><FONT FACE="Courier" POINT-SIZE="7">d4e5f6a</FONT>>]
  c_ckpt [shape=box, style="rounded,filled", fillcolor="#e8e8e8",
          label=<checkpoint<BR/><FONT FACE="Courier" POINT-SIZE="7">7c8d9e0</FONT>>]
  c_cov [shape=box, style="rounded,filled", fillcolor="#e8e8e8",
         label=<octopus merge<BR/><FONT FACE="Courier" POINT-SIZE="7">f1a2b3c</FONT>>]

  // Directory hierarchy
  refs -> warp
  warp -> graphdir
  graphdir -> writers
  graphdir -> checkpoints
  graphdir -> coverage
  graphdir -> cursor
  graphdir -> audit
  graphdir -> trust
  graphdir -> seek_cache

  writers -> alice_ref
  writers -> bob_ref
  checkpoints -> ckpt_head
  coverage -> cov_head
  cursor -> cur_active
  cursor -> saved
  saved -> bookmark
  audit -> audit_alice
  audit -> audit_bob
  trust -> trust_rec

  // Elision nodes (leaf refs without explicit commit targets)
  elision_cur [shape=plaintext, fontsize=9, label="..."]
  elision_bookmark [shape=plaintext, fontsize=9, label="..."]
  elision_audit_a [shape=plaintext, fontsize=9, label="..."]
  elision_audit_b [shape=plaintext, fontsize=9, label="..."]
  elision_trust [shape=plaintext, fontsize=9, label="..."]
  elision_cache [shape=plaintext, fontsize=9, label="..."]

  cur_active -> elision_cur [style=dashed, penwidth=0.5]
  bookmark -> elision_bookmark [style=dashed, penwidth=0.5]
  audit_alice -> elision_audit_a [style=dashed, penwidth=0.5]
  audit_bob -> elision_audit_b [style=dashed, penwidth=0.5]
  trust_rec -> elision_trust [style=dashed, penwidth=0.5]
  seek_cache -> elision_cache [style=dashed, penwidth=0.5]

  // Ref-to-commit arrows (dashed)
  alice_ref -> c_alice [style=dashed, penwidth=0.5]
  bob_ref -> c_bob [style=dashed, penwidth=0.5]
  ckpt_head -> c_ckpt [style=dashed, penwidth=0.5]
  cov_head -> c_cov [style=dashed, penwidth=0.5]

  // Octopus parents
  c_cov -> c_alice [label="parent", penwidth=0.5]
  c_cov -> c_bob [label="parent", penwidth=0.5]
}
