
╭─── Claude Code v2.1.23 ──────────────────────────────────────────────────────╮
│                                                    │ Tips for getting        │
│                 Welcome back James!                │ started                 │
│                                                    │ Run /init to create a … │
│                       ▐▛███▜▌                      │ ─────────────────────── │
│                      ▝▜█████▛▘                     │ Recent activity         │
│                        ▘▘ ▝▝                       │ No recent activity      │
│                                                    │                         │
│    Opus 4.5 · Claude Max · jkross@gmail.com's      │                         │
│    Organization                                    │                         │
│   ~/git/git-stunts/empty-graph/docs/lessons/refs   │                         │
╰──────────────────────────────────────────────────────────────────────────────╯

❯ Please familiarize yourself with this repo and its code and how it works. 

⏺ I'll explore this repository to understand its structure and how it works.

⏺ Explore(Explore git-stunts repo structure)
  ⎿  Done (35 tool uses · 78.8k tokens · 1m 29s)

⏺ Git Stunts Repository Overview

  This is a monorepo of specialized libraries under the @git-stunts npm
  namespace that creatively repurpose Git as a database and data structure
  platform rather than just version control.

  Package Summary
  Package: plumbing
  Purpose: Low-level Git command execution (foundation layer) - multi-runtime
    (Node/Bun/Deno)
  ────────────────────────────────────────
  Package: cas
  Purpose: Content Addressable Store - encrypted, chunked binary storage in Git
  ────────────────────────────────────────
  Package: trailer-codec
  Purpose: Git commit message trailer parsing/generation (RFC 822 compliant)
  ────────────────────────────────────────
  Package: vault
  Purpose: OS-native keychain interface for secrets (macOS/Linux/Windows)
  ────────────────────────────────────────
  Package: alfred
  Purpose: Resilience patterns (retry, circuit breaker, timeout)
  ────────────────────────────────────────
  Package: empty-graph
  Purpose: Graph database built on Git commits pointing to the empty tree
  ────────────────────────────────────────
  Package: docker-guard
  Purpose: Ensures execution only inside Docker containers
  Architecture

  All packages follow hexagonal architecture (ports/adapters) with Domain-Driven
   Design:

  src/
  ├── domain/           # Pure business logic
  │   ├── entities/     # GitCommit, GraphNode
  │   ├── value-objects/# GitSha, GitRef, GitTrailer
  │   └── services/     # Core logic
  ├── ports/            # Abstract interfaces
  └── infrastructure/
      └── adapters/     # Runtime-specific implementations

  Key Design Principles

  - Streaming-first - constant memory regardless of data size
  - Security-first - command sanitization, AES-256-GCM encryption, DoS
  protection
  - Type safety - Zod schema validation throughout
  - Multi-runtime - Node.js ≥20, Bun ≥1.3.5, Deno ≥2.0
  - Docker enforcement - tests run in containers for safety

  The "Stunts"

  The clever insight is using Git's properties for non-version-control purposes:
  - Immutable audit trails (commits can't be changed)
  - Content addressing (automatic deduplication)
  - Distributed replication (push/pull just works)
  - Cryptographic verification (SHA hashes)

  The empty-graph package is particularly interesting - it stores graph data
  entirely in commit messages/trailers with all commits pointing to Git's empty
  tree SHA (4b825dc...), so there are no actual files—just the commit DAG
  itself.

  The file you have open (GitGraphAdapter.js) is the bridge between the graph
  domain model and Git storage in the empty-graph package.

✻ Churned for 1m 51s

❯ A reviewer claims that we have a massive problem: the git GC will nuke    
  our graph nodes because we aren't anchoring them to a ref. Is that true?  

⏺ Good question. Let me check how the graph nodes are actually created and
  whether they're anchored to refs.

⏺ Searched for 1 pattern, read 1 file (ctrl+o to expand)

⏺ I see commitNode() uses git commit-tree which creates a dangling commit. Let
  me check the higher-level API to see if nodes get anchored after creation.

⏺ Read 1 file (ctrl+o to expand)

⏺ Let me check if the documentation mentions this GC concern.

⏺ Searched for 1 pattern (ctrl+o to expand)

⏺ Let me check the README for the full context around GC and ref management.

⏺ Read 1 file (ctrl+o to expand)

⏺ Let me check the GraphService to understand how nodes are created.

⏺ Read 1 file (ctrl+o to expand)

⏺ Now I have the full picture. Here's the assessment:

  The Reviewer is Partially Right

  The concern is valid but overstated. Here's the nuanced reality:

  What Actually Happens

  1. createNode() creates dangling commits - It uses git commit-tree which
  produces a loose object not attached to any ref. This is true.
  2. But Git GC has a grace period - By default, gc.pruneExpire is 2 weeks.
  Loose objects younger than this aren't pruned, even if unreachable. Also, git 
  gc --auto only triggers at ~6700 loose objects.
  3. The intended usage pattern works - Looking at the examples in
  empty-graph/examples/setup.js:136-138:
  git update-ref refs/heads/main ${parentSha}
  3. Users are expected to anchor their graph's tip(s) to refs.

  The Real Problem

  The library doesn't make ref management easy or obvious:
  ┌────────────────────────────────┬──────────────────────────────────────────┐
  │          What exists           │              What's missing              │
  ├────────────────────────────────┼──────────────────────────────────────────┤
  │ GitGraphAdapter.updateRef()    │ No graph.updateRef() convenience method  │
  ├────────────────────────────────┼──────────────────────────────────────────┤
  │ Examples show the pattern      │ README doesn't prominently warn about GC │
  ├────────────────────────────────┼──────────────────────────────────────────┤
  │ Index anchored via saveIndex() │ No automatic anchoring of graph nodes    │
  └────────────────────────────────┴──────────────────────────────────────────┘
  Why It's Not "Massive"

  - Commits with parents pointing to them are reachable if any descendant is
  anchored
  - The 2-week grace period handles most workflows
  - A graph with proper ref management (tip anchored to refs/heads/main or
  similar) is fully protected

  Where It Could Bite You

  1. Creating orphan nodes that never get children
  2. Running git gc --prune=now manually
  3. Very long-running processes that create commits but don't anchor them
  within 2 weeks

  Bottom line: The architecture is sound, but the documentation and API could
  better guide users to avoid this footgun. Consider adding a graph.anchor(sha, 
  ref) convenience method and a prominent warning in the README.

✻ Worked for 1m 2s

❯ How should users typically do it then? What would automating it look      
  like? Why do you think it hasn't been automated already?                  

⏺ Good questions. Let me look at how the examples actually do it and think
  through the design tradeoffs.

⏺ Read 1 file (ctrl+o to expand)

⏺ This example shows the pattern clearly. Let me answer your three questions:

  1. How Users Should Typically Do It

  The example at lines 110-146 shows the pattern:

  // Build the DAG, tracking tips
  let parentSha = null;
  for (const event of events) {
    parentSha = await graph.createNode({
      message: event,
      parents: parentSha ? [parentSha] : [],
    });
  }

  // Anchor only the tips (nodes with no children)
  execSync(`git update-ref refs/heads/main ${parentSha}`);
  execSync(`git update-ref refs/heads/cancelled-order ${cancelledSha}`);

  Key insight: You only need to anchor the tips (leaf nodes). All ancestors
  become reachable automatically through the parent chain.

  2. What Automating It Could Look Like

  Several options with different tradeoffs:

  Option A: Working ref (auto-advance)
  const graph = new EmptyGraph({
    persistence,
    workingRef: 'refs/heads/main'  // auto-updated after each createNode
  });

  Option B: Explicit anchor convenience method
  const sha = await graph.createNode({ message: 'data' });
  await graph.anchor(sha, 'refs/heads/main');  // wrapper around update-ref

  Option C: Transaction pattern
  const tx = graph.beginTransaction('refs/heads/main');
  await tx.createNode({ message: 'A' });
  await tx.createNode({ message: 'B', parents: ['$0'] });
  await tx.commit();  // anchors the tip
  // tx.abort() would just abandon the dangling commits

  3. Why It Probably Hasn't Been Automated
  Reason: Performance
  Explanation: git update-ref is a syscall + fsync. Doing it per-node adds
  ~1-5ms
     latency each. For bulk writes, this compounds badly.
  ────────────────────────────────────────
  Reason: Semantic mismatch
  Explanation: Refs represent meaningful branch tips, not every node.
    Auto-anchoring every node creates nonsense refs.
  ────────────────────────────────────────
  Reason: DAG building
  Explanation: When constructing complex graphs (multiple branches, merges), you

    build the structure then anchor the tips. Intermediate nodes don't
     need refs.
  ────────────────────────────────────────
  Reason: Only tips matter
  Explanation: A chain of 1000 nodes needs exactly 1 ref (at the tip). The other

    999 are reachable through parents.
  ────────────────────────────────────────
  Reason: Flexibility
  Explanation: Different apps want different ref strategies: single stream,
    multiple topics, namespaced by tenant, etc.
  The design assumes: Users understand that Git refs work like pointers, and
  that reachability flows backward through parent links. This is correct Git
  semantics, but it's a footgun for users who don't grok it.

  The gap is documentation, not architecture. The README should prominently
  state: "Anchor your graph tips to refs or they'll be garbage collected."

✻ Crunched for 34s

❯ Do you think it would greatly simplify things if we just provided a       
  CreateGraph(ref) API? What is YOUR recommendation for how this should be  
  handled? And what are the implications of setting a node to a ref? For    
  example, if my DAG has 6 root nodes, do I need 6 refs? How do I check out 
  the correct git state to view the entire graph?                           

⏺ These are great questions that expose a fundamental design tension. Let me
  think through this.

  The Multiple Roots Problem

  You're right to flag this. If your DAG has 6 disconnected root nodes (no
  common ancestors), you need 6 refs to keep them all reachable. But it gets
  worse:

  A ← B ← C          (tip: C)
  D ← E              (tip: E)
  F                  (tip: F, orphan root)

  You'd need refs for C, E, and F. And if you later add nodes, you need to track
   which tips changed.

  How Do You "View" the Whole Graph?

  This is where it gets interesting. Empty-graph's query methods all take a ref
  parameter:

  graph.iterateNodes({ ref: 'main' })      // walks from one tip
  graph.rebuildIndex('main')               // indexes from one tip

  There's no built-in "give me everything" operation. Git itself uses git log 
  --all which walks from all refs. The library doesn't expose this.

  My Recommendation: Synthetic Anchor Node

  The cleanest pattern is a single anchor commit that merges all tips:

  A ← B ← C ←─┐
  D ← E ←─────┼── ANCHOR (refs/heads/graph)
  F ←─────────┘

  The anchor commit:
  - Has all current tips as parents
  - Points to the empty tree (like all nodes)
  - Has a marker message: {"_type": "anchor"}
  - Gets updated whenever the graph changes

  This gives you:
  - Single ref to protect everything from GC
  - Single entry point for queries (iterateNodes({ ref: 'graph' }))
  - Natural Git semantics (it's just a merge commit)

  What the API Could Look Like

  // Option 1: Explicit graph management
  const graph = EmptyGraph.create({
    persistence,
    ref: 'refs/empty-graph/main'  // anchor ref
  });

  await graph.createNode({ message: 'A' });  // dangling
  await graph.createNode({ message: 'B' });  // dangling
  await graph.sync();  // creates/updates anchor with all unanchored tips

  // Option 2: Auto-sync mode
  const graph = EmptyGraph.create({
    persistence,
    ref: 'refs/empty-graph/main',
    autoSync: true  // anchor after each mutation
  });

  // Option 3: Batch with explicit anchor
  const tips = await graph.createNodes([
    { message: 'A' },
    { message: 'B', parents: ['$0'] },
    { message: 'C' },  // disconnected root
  ]);
  await graph.anchor('refs/empty-graph/main', tips);

  Why This Probably Wasn't Done
  Reason: "Users should understand Git"
  Counterpoint: Most won't. This is a leaky abstraction.
  ────────────────────────────────────────
  Reason: "Flexibility for advanced use cases"
  Counterpoint: 90% of users want "just work" mode
  ────────────────────────────────────────
  Reason: "Performance overhead of anchor commits"
  Counterpoint: One extra commit per sync is negligible
  ────────────────────────────────────────
  Reason: "Complicates the mental model"
  Counterpoint: Current model requires understanding Git GC - that's harder
  The Real Implication

  The current design treats empty-graph as a Git power-user tool. You're
  expected to manage refs yourself because you might have sophisticated needs.

  But if the goal is "graph database that happens to use Git," then the
  abstraction should hide Git's ref/GC mechanics entirely. A CreateGraph(ref) or
   graph.sync(ref) API would do that.

  My recommendation: Add a graph.sync(ref?) method that:
  1. Finds all commits not reachable from ref (or creates the ref if missing)
  2. Creates an anchor commit with those tips as parents
  3. Updates the ref

  This preserves flexibility (you can still manage refs manually) while
  providing a safe default for users who just want it to work.

✻ Crunched for 42s

❯ Why wouldn't we just create an anchor for the graph and then add that     
  commit as a parent for every node in the grpah no matter what?            

⏺ That's a clever idea, but there's a subtle problem with edge direction. Let me
   draw it out:

  What You're Proposing

  ANCHOR (refs/heads/graph points here)
     ↑
     ├── A (parent: ANCHOR)
     ├── B (parent: ANCHOR)
     └── C (parent: ANCHOR, A)

  Every node has ANCHOR as a parent. Simple!

  The Problem: Git Reachability Goes Backwards

  Git's reachability traverses parent pointers, not child pointers:

  ref → commit → parent → grandparent → ...

  So with your proposal:
  - ref points to ANCHOR
  - ANCHOR has no parents (it's the root)
  - git log refs/heads/graph shows... just ANCHOR

  The nodes A, B, C are children of ANCHOR, not ancestors. Git can't "see" them
  from the ref because it only walks backward through parents, not forward
  through children.

  For GC Protection, You Need the Opposite

  A ←─────┐
  B ←─────┼── ANCHOR (refs/heads/graph)
  C ← D ←─┘

  ANCHOR has A, B, D as parents. Now:
  - ref points to ANCHOR
  - Following parents: ANCHOR → A, B, D → C
  - All nodes are reachable
  - git log refs/heads/graph shows everything

  Why "Universal Parent" Doesn't Work
  ┌───────────────────────┬────────┬───────────┬──────────────────────────────┐
  │       Approach        │  GC    │  Query    │             Why              │
  │                       │ Safe?  │  Works?   │                              │
  ├───────────────────────┼────────┼───────────┼──────────────────────────────┤
  │ ANCHOR is parent of   │ ❌     │ ❌        │ Ref can't reach nodes (wrong │
  │ all nodes             │        │           │  direction)                  │
  ├───────────────────────┼────────┼───────────┼──────────────────────────────┤
  │ ANCHOR has all tips   │ ✅     │ ✅        │ Ref reaches everything via   │
  │ as parents            │        │           │ parent chain                 │
  └───────────────────────┴────────┴───────────┴──────────────────────────────┘
  The Simple Fix

  The API you're imagining could still work, it just needs to flip the
  relationship:

  // At graph creation
  const anchor = await graph.createNode({ message: '{"_type":"anchor"}' });
  await persistence.updateRef('refs/heads/graph', anchor);

  // When adding nodes, periodically "re-anchor"
  const tips = findCurrentTips();  // nodes with no children
  const newAnchor = await graph.createNode({
    message: '{"_type":"anchor"}',
    parents: tips  // ANCHOR has tips as parents, not the other way around
  });
  await persistence.updateRef('refs/heads/graph', newAnchor);

  The anchor is always the "newest" commit that sits on top of the whole graph,
  making everything beneath it reachable.

✻ Churned for 45s

❯ How do users interact with a given graph? Do they have to git checkout    
  the ref? That kinda sucks because it affects their working tree.          

⏺ This is actually one of the clever parts of empty-graph's design - you never
  need to checkout anything.

  The "Empty" in Empty-Graph

  Remember, every commit points to the empty tree
  (4b825dc642cb6eb9a060e54bf8d69288fbee4904):

  // From GitGraphAdapter.js:73
  const args = ['commit-tree', this.emptyTree, ...parentArgs, '-m', message];

  There are no files. Ever. The working tree is completely irrelevant.

  How Users Actually Interact

  All interaction is through the API or raw git plumbing commands:

  // Create nodes - no checkout needed
  const sha = await graph.createNode({ message: JSON.stringify(myData) });

  // Read nodes - no checkout needed  
  const data = JSON.parse(await graph.readNode(sha));

  // Query the graph - no checkout needed
  for await (const node of graph.iterateNodes({ ref: 'refs/heads/graph' })) {
    console.log(node.message);
  }

  // Traverse relationships - no checkout needed
  const children = await graph.getChildren(sha);

  Or with raw git:

  # View a node's data
  git show -s --format=%B <sha>

  # List all nodes
  git log --format="%H %s" refs/heads/graph

  # View the graph structure
  git log --graph --oneline --all

  The Working Tree Stays Untouched

  my-project/
  ├── .git/
  │   ├── objects/      ← graph data lives here (commit objects)
  │   └── refs/
  │       └── heads/
  │           └── graph ← points to anchor commit
  ├── src/              ← completely unaffected
  ├── package.json      ← completely unaffected
  └── ...

  You could have a normal codebase in the working tree AND an empty-graph
  database in the same repo. They don't interfere because the graph commits have
   no tree content.

  This Is Actually a Feature
  ┌──────────────────────────┬────────────────────────────────────────┐
  │      Traditional DB      │              Empty-Graph               │
  ├──────────────────────────┼────────────────────────────────────────┤
  │ Separate data directory  │ Lives in .git/objects                  │
  ├──────────────────────────┼────────────────────────────────────────┤
  │ Own replication protocol │ git push / git pull                    │
  ├──────────────────────────┼────────────────────────────────────────┤
  │ Own backup strategy      │ Git bundles, mirrors                   │
  ├──────────────────────────┼────────────────────────────────────────┤
  │ Affects filesystem       │ Zero filesystem footprint outside .git │
  └──────────────────────────┴────────────────────────────────────────┘
  The graph is "invisible" - it exists purely in Git's object store. You query
  it through the API, not by checking out files.

❯ What if we just make a ref to the emtpy-tree? Does that solve the problem 
  entirely?                                                                 

⏺ No, unfortunately. The reference direction is wrong again.

  The Relationship

  Commit ──points to──► Empty Tree

  A commit references its tree. The tree doesn't reference commits that use it.

  What a Ref to Empty Tree Gets You

  refs/empty-graph/anchor → 4b825dc642cb6eb9a060e54bf8d69288fbee4904 (empty
  tree)

  Git reachability from this ref:
  - Empty tree → (trees reference blobs and subtrees, of which there are none)
  - Done. Nothing else reachable.

  The commits that point to the empty tree aren't reachable from the empty tree.
   It's a one-way reference.

  Analogy

  It's like saying "I have everyone's phone number, so everyone can call me." No
   - you having their numbers doesn't mean they can reach you.

  Commit A ──has tree──► Empty Tree ◄──has tree── Commit B
                              │
                              ▼
                      ref points here

  # Can't traverse backwards from tree to commits

  What Would Actually Work

  You need refs that point to commits, and those commits must have your graph
  nodes as ancestors:

  ref → Anchor Commit → (parents) → Graph Nodes → (parents) → ... → Empty Tree
          │
          └── reachability flows this direction via parent pointers

  There's no shortcut around the fundamental Git data model: reachability flows
  from refs through commits via parent pointers. Trees and blobs are leaf nodes
  in the reference graph - nothing points back up to commits from them.

❯ From a DX perspective, assuming that most people won't know Git internals 
  well enough, what would be the most intuitive way to handle this? Does    
  that leave the door open for power users who want finer control over how  
  refs are managed?                                                         

⏺ Great question. Here's my recommendation:

  The Ideal DX: "Just a Graph"

  Users should think: "I have a graph. I put things in it. I get things out."

  // Dead simple - no Git concepts exposed
  const graph = await EmptyGraph.open('orders');

  await graph.addNode({ message: 'event-1' });
  await graph.addNode({ message: 'event-2', parents: [sha1] });

  for await (const node of graph.nodes()) {
    console.log(node.message);
  }

  await graph.close();  // ensures everything is persisted

  What Happens Under the Hood
  ┌────────────────┬──────────────────────────────────────────────────┐
  │  User Action   │                Internal Behavior                 │
  ├────────────────┼──────────────────────────────────────────────────┤
  │ open('orders') │ Creates/loads refs/empty-graph/orders            │
  ├────────────────┼──────────────────────────────────────────────────┤
  │ addNode(...)   │ Creates commit, marks graph dirty                │
  ├────────────────┼──────────────────────────────────────────────────┤
  │ close()        │ Creates anchor commit with all tips, updates ref │
  └────────────────┴──────────────────────────────────────────────────┘
  The user never sees refs, anchors, or GC. It just works.

  API Proposal

  // Simple mode (recommended for most users)
  const graph = await EmptyGraph.open('my-graph');

  // Explicit sync (for long-running processes)
  const graph = await EmptyGraph.open('my-graph', { autoSync: false });
  await graph.addNode(...);
  await graph.addNode(...);
  await graph.sync();  // anchor now, don't wait for close()

  // Power user: full control
  const graph = await EmptyGraph.open({
    name: 'my-graph',
    ref: 'refs/custom/my-app/graphs/orders',  // custom ref location
    manage: false,  // I'll handle refs myself
  });
  // Now it's the current behavior - user manages refs manually

  Sync Strategies

  // Option 1: Sync on close (default - simple, but risky if crash)
  const graph = await EmptyGraph.open('orders');
  // ... work ...
  await graph.close();

  // Option 2: Explicit sync (for durability)
  await graph.sync();  // anchor immediately

  // Option 3: Batch for bulk operations
  await graph.batch(async (tx) => {
    for (const event of thousandEvents) {
      await tx.addNode({ message: event });
    }
  });  // single anchor at end, not 1000

  // Option 4: Auto-sync (safest, slowest)
  const graph = await EmptyGraph.open('orders', { autoSync: true });
  await graph.addNode(...);  // anchored immediately

  Power User Escape Hatches

  const graph = await EmptyGraph.open('orders', { manage: false });

  // Direct ref access
  await graph.persistence.updateRef('refs/heads/custom', someSha);

  // Multiple refs for complex topologies
  await graph.persistence.updateRef('refs/graphs/orders/stream-1', tip1);
  await graph.persistence.updateRef('refs/graphs/orders/stream-2', tip2);

  // Manual anchor creation
  const anchor = await graph.createAnchor([tip1, tip2, tip3]);
  await graph.persistence.updateRef('refs/graphs/orders/all', anchor);

  Summary
  ┌──────────────┬──────────────────────────────┬────────────────────────┐
  │  User Type   │             Mode             │      Thinks About      │
  ├──────────────┼──────────────────────────────┼────────────────────────┤
  │ Beginner     │ open('name')                 │ Just the graph         │
  ├──────────────┼──────────────────────────────┼────────────────────────┤
  │ Intermediate │ { autoSync: false } + sync() │ Durability checkpoints │
  ├──────────────┼──────────────────────────────┼────────────────────────┤
  │ Power user   │ { manage: false }            │ Full Git ref control   │
  └──────────────┴──────────────────────────────┴────────────────────────┘
  The key principle: safe by default, controllable when needed. The simple API
  hides Git entirely, but the layers beneath are accessible for users who need
  them.

✻ Worked for 34s

❯ OK I need a report: docs/REFS.md that explains:\                          
  \                                                                         
  The current problem.\                                                     
  \                                                                         
  The available options and their implications from the user's              
  perspective.\                                                             
  \                                                                         
  Final recommendation and its implications.                                

⏺ Write(~/git/git-stunts/empty-graph/docs/REFS.md)
  ⎿  Wrote 375 lines to ../../REFS.md
      1 # Ref Management and Garbage Collection in Empty-Graph
      2 
      3 ## Executive Summary
      4 
      5 Empty-graph creates Git commits that are not automatically anchor
        ed to refs. Without explicit ref management, these commits are vu
        lnerable to garbage collection. This document analyzes the proble
        m, evaluates solutions, and recommends a backward-compatible API
        that provides safe defaults while preserving flexibility for adva
        nced users.
      6 
      7 ---
      8 
      9 ## The Problem
     … +365 lines (ctrl+o to expand)

⏺ Created docs/REFS.md. Here's a summary of what it covers:

  Document Structure

  1. The Problem
  - How createNode() creates dangling commits via git commit-tree
  - Git GC behavior (2-week grace period, auto-trigger thresholds)
  - The footgun: data silently disappears after GC
  - Why current "manual ref management" is insufficient for most users

  2. Options Evaluated
  ┌────────────────────────────┬──────────────────────────────────────────────┐
  │           Option           │                   Verdict                    │
  ├────────────────────────────┼──────────────────────────────────────────────┤
  │ Status quo (manual refs)   │ Unacceptable as only option                  │
  ├────────────────────────────┼──────────────────────────────────────────────┤
  │ Auto-anchor every mutation │ Too slow for bulk writes                     │
  ├────────────────────────────┼──────────────────────────────────────────────┤
  │ Explicit sync/flush        │ Good for intermediate users                  │
  ├────────────────────────────┼──────────────────────────────────────────────┤
  │ Sync on close              │ Reasonable default                           │
  ├────────────────────────────┼──────────────────────────────────────────────┤
  │ Universal parent           │ Doesn't work (wrong edge direction)          │
  ├────────────────────────────┼──────────────────────────────────────────────┤
  │ Ref to empty tree          │ Doesn't work (trees don't reference commits) │
  └────────────────────────────┴──────────────────────────────────────────────┘
  3. Recommendation: Tiered API

  - Tier 1 (default): EmptyGraph.open('name') - fully managed, auto-sync on
  close
  - Tier 2: { autoSync: false } - user calls sync() explicitly
  - Tier 3: { managed: false } - current behavior, full manual control

  4. Implications
  - Backward compatible (constructor still works as unmanaged)
  - New open() factory is the recommended safe path
  - Performance/storage overhead analysis
  - Migration path for existing users

  The document also includes an appendix explaining Git's reachability model for
   readers unfamiliar with Git internals.

✻ Baked for 1m 14s

❯ Couldn't we "bake" the tiers into the API? Something like                 
  EmptyGraph.open('name') VS EmptyGraph.open({ name, disableAutoSync }) VS  
  EmptyGraph.open({ name, fullManualControl }). I think the user should     
  have to opt-in to advanced features, especially when the default behavior 
  is destructive and counter-intuitive like this case                       

⏺ You're absolutely right. The API shape should guide users toward the safe
  path. The current proposal with boolean flags makes it too easy to
  accidentally opt into dangerous modes.

  Let me update the document with a "pit of success" API design.

⏺ Update(~/git/git-stunts/empty-graph/docs/REFS.md)
  ⎿  Added 100 lines, removed 31 lines
      199 
      200  ## Recommended Solution
      201 
      202 -### Tiered API with Safe Defaults                             
      202 +### Pit of Success API Design
      203 
      204 -Provide three tiers of ref management, with the safest option 
          -as the default:                                               
      204 +The API shape itself should guide users toward safe behavior.
          +Advanced modes require explicit opt-in through progressively m
          +ore verbose configuration.
      205 
      206 -#### Tier 1: Managed Mode (Default)                           
      206 +**Design Principles:**
      207 +1. The simplest API is the safest API
      208 +2. Dangerous options require explicit, scary-sounding opt-in
      209 +3. You cannot accidentally end up in an unsafe mode
      210 +4. The type signature communicates the tier
      211 
      212 +---
      213 +
      214 +#### Tier 1: Safe Mode (Simple String)
      215 +
      216  ```javascript
      217  const graph = await EmptyGraph.open('my-graph');
      218 
     ...
      222  await graph.close();  // Auto-anchors all nodes
      223  ```
      224 
      225 +**API:** `EmptyGraph.open(name: string)`
      226 +
      227  **Behavior:**
      218 -- `open(name)` creates or loads ref at `refs/empty-graph/{name
          -}`                                                            
      228 +- Creates or loads ref at `refs/empty-graph/{name}`
      229  - Tracks all created nodes internally
      220 -- `close()` creates anchor commit with all unanchored tips as 
          -parents, updates ref                                          
      221 -- `sync()` available for explicit durability checkpoints      
      230 +- `close()` automatically creates anchor commit and updates re
          +f
      231 +- `sync()` available for explicit durability checkpoints befor
          +e close
      232 +- **Impossible to lose data** (unless process crashes before c
          +lose)
      233 
      234  **Internal anchor mechanism:**
      235  ```
     ...
      246  All nodes reachable via parent traversal.
      247  ```
      248 
      238 -#### Tier 2: Manual Sync Mode                                 
      249 +---
      250 
      251 +#### Tier 2: Manual Sync Mode (Object with `manualSync`)
      252 +
      253  ```javascript
      241 -const graph = await EmptyGraph.open('my-graph', { autoSync: fa
          -lse });                                                       
      254 +const graph = await EmptyGraph.open({
      255 +  name: 'my-graph',
      256 +  manualSync: true,  // Explicit opt-in to manual sync respons
          +ibility
      257 +});
      258 
      259  await graph.addNode({ message: 'A' });
      260  await graph.addNode({ message: 'B' });
      245 -await graph.sync();  // Explicit anchor point                 
      261 +await graph.sync();  // User's responsibility to call this
      262 
      263  await graph.addNode({ message: 'C' });
      248 -await graph.sync();  // Another anchor point                  
      264 +await graph.sync();
      265 +
      266 +await graph.close();  // Does NOT auto-sync
      267  ```
      268 
      269 +**API:** `EmptyGraph.open({ name: string, manualSync: true })`
      270 +
      271  **Behavior:**
      252 -- Same as Tier 1, but close() does not auto-sync              
      272 +- Same ref management as Tier 1
      273 +- `close()` does NOT auto-sync (user took responsibility)
      274  - User controls exactly when anchoring happens
      254 -- Useful for batching or custom durability guarantees         
      275 +- Useful for batching, transactions, or custom durability guar
          +antees
      276 +- **Data loss possible** if user forgets to sync
      277 
      256 -#### Tier 3: Unmanaged Mode (Power Users)                     
      278 +**Why require an object?** The user must "escalate" from a sim
          +ple string to an object, signaling awareness that they're taki
          +ng on responsibility.
      279 
      280 +---
      281 +
      282 +#### Tier 3: Unmanaged Mode (Object with `unmanaged`)
      283 +
      284  ```javascript
      259 -const graph = await EmptyGraph.open('my-graph', { managed: fal
          -se });                                                        
      285 +const graph = await EmptyGraph.open({
      286 +  name: 'my-graph',
      287 +  unmanaged: true,  // "I know what I'm doing"
      288 +});
      289 
      290  // Library does not touch refs at all
      291  // User has full control via persistence adapter
      263 -await graph.persistence.updateRef('refs/custom/location', some
          -Sha);                                                         
      292 +const sha = await graph.createNode({ message: 'data' });
      293 +await graph.persistence.updateRef('refs/custom/location', sha)
          +;
      294  ```
      295 
      296 +**API:** `EmptyGraph.open({ name: string, unmanaged: true })`
      297 +
      298  **Behavior:**
      267 -- Current behavior preserved exactly                          
      268 -- No automatic ref management                                 
      269 -- User responsible for GC protection                          
      270 -- Full flexibility for advanced topologies                    
      299 +- Current library behavior preserved exactly
      300 +- No automatic ref management whatsoever
      301 +- `sync()` and auto-sync disabled
      302 +- User responsible for all GC protection
      303 +- Full flexibility for advanced topologies (multiple refs, cus
          +tom namespaces, etc.)
      304 +- **Data loss expected** without manual ref management
      305 
      306 +**Why `unmanaged` instead of `managed: false`?**
      307 +- Positive opt-in to dangerous behavior
      308 +- The word "unmanaged" sounds risky (which it is)
      309 +- Cannot be set accidentally (no default to override)
      310 +
      311 +---
      312 +
      313 +#### Mutual Exclusivity
      314 +
      315 +The options are mutually exclusive and validated at runtime:
      316 +
      317 +```javascript
      318 +// Valid
      319 +EmptyGraph.open('foo');
      320 +EmptyGraph.open({ name: 'foo' });
      321 +EmptyGraph.open({ name: 'foo', manualSync: true });
      322 +EmptyGraph.open({ name: 'foo', unmanaged: true });
      323 +
      324 +// Invalid - throws immediately
      325 +EmptyGraph.open({ name: 'foo', manualSync: true, unmanaged: tr
          +ue });
      326 +// Error: "manualSync and unmanaged are mutually exclusive"
      327 +```
      328 +
      329 +---
      330 +
      331  ### API Surface
      332 
      333  ```typescript
      275 -interface EmptyGraphOptions {                                 
      276 -  persistence: GraphPersistencePort;                          
      334 +// Tier 1: Simple, safe
      335 +function open(name: string): Promise<EmptyGraph>;
      336 
      278 -  // Ref management tier                                      
      279 -  managed?: boolean;          // default: true (Tier 1/2)     
      280 -  autoSync?: boolean;         // default: true (Tier 1) when m
          -anaged=true                                                   
      337 +// Tier 2 & 3: Explicit configuration
      338 +interface OpenOptions {
      339 +  name: string;
      340 
      282 -  // Custom ref location (only when managed=true)             
      283 -  ref?: string;               // default: 'refs/empty-graph/{n
          -ame}'                                                         
      341 +  // Tier 2: User controls sync points
      342 +  manualSync?: boolean;
      343 +
      344 +  // Tier 3: Full manual control (implies manualSync)
      345 +  unmanaged?: boolean;
      346 +
      347 +  // Optional: custom ref location (ignored if unmanaged)
      348 +  ref?: string;  // default: 'refs/empty-graph/{name}'
      349  }
      350 +function open(options: OpenOptions): Promise<EmptyGraph>;
      351 
      352  class EmptyGraph {
      353    // Existing API unchanged
     ...
      355    readNode(sha): Promise<string>;
      356    // ...
      357 
      292 -  // New API for managed mode                                 
      293 -  static open(name: string, options?): Promise<EmptyGraph>;   
      294 -  sync(): Promise<void>;      // Anchor all unanchored nodes  
      295 -  close(): Promise<void>;     // Sync (if autoSync) and cleanu
          -p                                                             
      358 +  // New managed mode API
      359 +  static open(name: string): Promise<EmptyGraph>;
      360 +  static open(options: OpenOptions): Promise<EmptyGraph>;
      361 
      362 +  sync(): Promise<void>;      // Anchor all unanchored nodes (
          +no-op if unmanaged)
      363 +  close(): Promise<void>;     // Sync (if Tier 1) and cleanup
      364 +
      365    // Introspection
      366    readonly dirty: boolean;    // True if unsynced nodes exist
      299 -  readonly ref: string;       // Current ref path             
      367 +  readonly ref: string | null; // Current ref path (null if un
          +managed)
      368 +  readonly mode: 'managed' | 'manualSync' | 'unmanaged';
      369  }
      370  ```
      371 

⏺ Now let me update the migration path to reflect the new API design.

⏺ Update(~/git/git-stunts/empty-graph/docs/REFS.md)
  ⎿  Added 11 lines, removed 3 lines
      371 
      372  ### Migration Path
      373 
      374 -1. **Existing code continues to work:** Constructor-based inst
          -antiation (`new EmptyGraph({ persistence })`) defaults to `man
          -aged: false` for backward compatibility.                      
      374 +1. **Existing code continues to work:** Constructor-based inst
          +antiation (`new EmptyGraph({ persistence })`) behaves as `unma
          +naged` mode for backward compatibility. A deprecation warning
          +is logged recommending migration to `open()`.
      375 
      376 -2. **New recommended pattern:** `EmptyGraph.open(name)` uses m
          -anaged mode by default.                                       
      376 +2. **New recommended pattern:** `EmptyGraph.open(name)` is the
          + primary API, featured in all documentation and examples.
      377 
      378 -3. **Documentation updated:** Examples use `open()` pattern, w
          -ith clear warnings about unmanaged mode.                      
      378 +3. **Deprecation timeline:**
      379 +   - v3.0: Introduce `open()` API, deprecate constructor for n
          +ew code
      380 +   - v4.0: Constructor logs warning on every instantiation
      381 +   - v5.0: Constructor removed, `open({ unmanaged: true })` re
          +quired for manual control
      382 
      383 +4. **Documentation updated:**
      384 +   - All examples use `open()` pattern
      385 +   - Constructor documented only in "Migration" section
      386 +   - Clear warnings about `unmanaged` mode with required ackno
          +wledgment of GC risks
      387 +
      388  ---
      389 
      390  ## Implications of Recommendation

⏺ Update(~/git/git-stunts/empty-graph/docs/REFS.md)
  ⎿  Added 4 lines, removed 3 lines
      397 
      398  ### For Existing Users
      399 
      400 -- No breaking changes                                         
      401 -- Can opt into managed mode incrementally                     
      402 -- Power user workflows preserved                              
      400 +- **No immediate breaking changes:** Constructor continues to
          +work as `unmanaged`
      401 +- **Clear migration path:** Deprecation warnings guide users t
          +o `open()` API
      402 +- **Power user workflows preserved:** `open({ unmanaged: true 
          +})` provides identical behavior
      403 +- **Gradual adoption:** Can migrate one graph at a time
      404 
      405  ### Performance Characteristics
      406 

⏺ Updated. Here's the key change to the API design:

  Before (Boolean Flags)

  // Too easy to get wrong
  EmptyGraph.open('name', { autoSync: false });
  EmptyGraph.open('name', { managed: false });
  EmptyGraph.open('name', { managed: false, autoSync: false }); // confusing

  After (Pit of Success)

  // Tier 1: Simplest = Safest
  EmptyGraph.open('my-graph');

  // Tier 2: Must escalate to object, explicit opt-in
  EmptyGraph.open({ name: 'my-graph', manualSync: true });

  // Tier 3: Even more explicit, scary-sounding name
  EmptyGraph.open({ name: 'my-graph', unmanaged: true });

  // Invalid - fails fast
  EmptyGraph.open({ name: 'my-graph', manualSync: true, unmanaged: true });
  // Error: mutually exclusive

  Why This Is Better
  ┌──────────────────────┬───────────────────────┬─────────────────────────────┐
  │        Aspect        │     Boolean Flags     │       Explicit Opt-in       │
  ├──────────────────────┼───────────────────────┼─────────────────────────────┤
  │ Default safety       │ Depends on defaults   │ String = safe, always       │
  ├──────────────────────┼───────────────────────┼─────────────────────────────┤
  │ Accidental danger    │ managed: false typo   │ Must type unmanaged: true   │
  ├──────────────────────┼───────────────────────┼─────────────────────────────┤
  │ API communicates     │ No                    │ unmanaged sounds risky      │
  │ risk                 │                       │                             │
  ├──────────────────────┼───────────────────────┼─────────────────────────────┤
  │ Type signature       │ Same for all modes    │ String vs Object            │
  │                      │                       │ distinguishes               │
  ├──────────────────────┼───────────────────────┼─────────────────────────────┤
  │ Discoverability      │ Must read docs for    │ Simple path obvious         │
  │                      │ flags                 │                             │
  └──────────────────────┴───────────────────────┴─────────────────────────────┘
  The API shape itself now enforces that users must deliberately choose to enter
   dangerous territory. The simplest thing you can type (open('name')) is also
  the safest thing you can do.

✻ Crunched for 57s

❯ OK consider this: it is unreleased software, there are no existing users  
  (besides our internal tests lol) and we should break things now rahter    
  than later as we are trying to release soon.                              

⏺ Even better. Let me clean up the document to remove all the backward
  compatibility baggage and just present the clean design.

⏺ Update(~/git/git-stunts/empty-graph/docs/REFS.md)
  ⎿  Added 6 lines, removed 13 lines
      369  }
      370  ```
      371 
      372 -### Migration Path                                            
      372 +### Breaking Changes from Current Implementation
      373 
      374 -1. **Existing code continues to work:** Constructor-based inst
          -antiation (`new EmptyGraph({ persistence })`) behaves as `unma
          -naged` mode for backward compatibility. A deprecation warning 
          -is logged recommending migration to `open()`.                 
      374 +This is unreleased software. We break things now to avoid tech
          +nical debt later.
      375 
      376 -2. **New recommended pattern:** `EmptyGraph.open(name)` is the
          - primary API, featured in all documentation and examples.     
      376 +1. **Constructor removed:** `new EmptyGraph({ persistence })`
          +no longer exists
      377 +2. **`open()` is the only entry point:** All instantiation goe
          +s through the static factory
      378 +3. **Safe by default:** The simplest API (`open('name')`) is f
          +ully managed
      379 +4. **Persistence is internal:** Users provide `cwd`, not a per
          +sistence adapter (unless `unmanaged`)
      380 
      378 -3. **Deprecation timeline:**                                  
      379 -   - v3.0: Introduce `open()` API, deprecate constructor for n
          -ew code                                                       
      380 -   - v4.0: Constructor logs warning on every instantiation    
      381 -   - v5.0: Constructor removed, `open({ unmanaged: true })` re
          -quired for manual control                                     
      382 -                                                              
      383 -4. **Documentation updated:**                                 
      384 -   - All examples use `open()` pattern                        
      385 -   - Constructor documented only in "Migration" section       
      386 -   - Clear warnings about `unmanaged` mode with required ackno
          -wledgment of GC risks                                         
      387 -                                                              
      381  ---
      382 
      383  ## Implications of Recommendation

⏺ Update(~/git/git-stunts/empty-graph/docs/REFS.md)
  ⎿  Added 5 lines, removed 11 lines
      382 
      383  ## Implications of Recommendation
      384 
      385 -### For New Users                                             
      385 +### For Users
      386 
      387 -- Data is safe by default                                     
      388 -- No Git knowledge required                                   
      389 -- Simple mental model: open, write, close                     
      387 +- **Data is safe by default:** No Git knowledge required
      388 +- **Simple mental model:** Open, write, close
      389 +- **Power users accommodated:** `unmanaged` mode provides full
          + control when needed
      390 +- **Explicit risk acceptance:** Dangerous modes require explic
          +it opt-in
      391 
      391 -### For Existing Users                                        
      392 -                                                              
      393 -- **No immediate breaking changes:** Constructor continues to 
          -work as `unmanaged`                                           
      394 -- **Clear migration path:** Deprecation warnings guide users t
          -o `open()` API                                                
      395 -- **Power user workflows preserved:** `open({ unmanaged: true 
          -})` provides identical behavior                               
      396 -- **Gradual adoption:** Can migrate one graph at a time       
      397 -                                                              
      392  ### Performance Characteristics
      393 
      394  | Operation | Managed Mode | Unmanaged Mode |

⏺ Update(~/git/git-stunts/empty-graph/docs/REFS.md)
  ⎿  Added 42 lines, removed 15 lines
      331  ### API Surface
      332 
      333  ```typescript
      334 -// Tier 1: Simple, safe                                       
      334 +// Tier 1: Simple, safe (most users)
      335  function open(name: string): Promise<EmptyGraph>;
      336 
      337  // Tier 2 & 3: Explicit configuration
      338  interface OpenOptions {
      339 +  // Required
      340    name: string;
      341 
      341 -  // Tier 2: User controls sync points                        
      342 +  // Optional: working directory (default: process.cwd())
      343 +  cwd?: string;
      344 +
      345 +  // Optional: custom ref location (default: 'refs/empty-graph
          +/{name}')
      346 +  ref?: string;
      347 +
      348 +  // Tier 2: User controls sync points (default: false)
      349    manualSync?: boolean;
      350 
      344 -  // Tier 3: Full manual control (implies manualSync)         
      351 +  // Tier 3: Full manual control, requires persistence adapter
      352    unmanaged?: boolean;
      346 -                                                              
      347 -  // Optional: custom ref location (ignored if unmanaged)     
      348 -  ref?: string;  // default: 'refs/empty-graph/{name}'        
      353 +  persistence?: GraphPersistencePort;  // Required if unmanage
          +d: true
      354  }
      355  function open(options: OpenOptions): Promise<EmptyGraph>;
      356 
      357  class EmptyGraph {
      353 -  // Existing API unchanged                                   
      354 -  createNode(options): Promise<string>;                       
      355 -  readNode(sha): Promise<string>;                             
      356 -  // ...                                                      
      357 -                                                              
      358 -  // New managed mode API                                     
      358 +  // Only entry point - no public constructor
      359    static open(name: string): Promise<EmptyGraph>;
      360    static open(options: OpenOptions): Promise<EmptyGraph>;
      361 
      362 -  sync(): Promise<void>;      // Anchor all unanchored nodes (
          -no-op if unmanaged)                                           
      363 -  close(): Promise<void>;     // Sync (if Tier 1) and cleanup 
      362 +  // Graph operations (unchanged)
      363 +  createNode(options): Promise<string>;
      364 +  readNode(sha): Promise<string>;
      365 +  getNode(sha): Promise<GraphNode>;
      366 +  listNodes(options): Promise<GraphNode[]>;
      367 +  iterateNodes(options): AsyncGenerator<GraphNode>;
      368 
      369 +  // Lifecycle
      370 +  sync(): Promise<void>;      // Anchor all unanchored nodes
      371 +  close(): Promise<void>;     // Sync (unless manualSync) and 
          +release resources
      372 +
      373    // Introspection
      374    readonly dirty: boolean;    // True if unsynced nodes exist
      367 -  readonly ref: string | null; // Current ref path (null if un
          -managed)                                                      
      375 +  readonly ref: string | null; // Ref path (null if unmanaged)
      376    readonly mode: 'managed' | 'manualSync' | 'unmanaged';
      377  }
      378  ```
      379 
      380 +### Validation Rules
      381 +
      382 +```typescript
      383 +// Enforced at runtime with clear error messages
      384 +
      385 +if (options.manualSync && options.unmanaged) {
      386 +  throw new Error('manualSync and unmanaged are mutually exclu
          +sive');
      387 +}
      388 +
      389 +if (options.unmanaged && !options.persistence) {
      390 +  throw new Error('unmanaged mode requires a persistence adapt
          +er');
      391 +}
      392 +
      393 +if (!options.unmanaged && options.persistence) {
      394 +  throw new Error('persistence adapter only allowed in unmanag
          +ed mode (use cwd instead)');
      395 +}
      396 +```
      397 +```
      398 +
      399  ### Breaking Changes from Current Implementation
      400 
      401  This is unreleased software. We break things now to avoid tech
           nical debt later.

⏺ Update(~/git/git-stunts/empty-graph/docs/REFS.md)
  ⎿  Added 8 lines, removed 4 lines
      432  - For typical usage (sync per session), negligible
      433  - For extreme cases (sync after every node), ~20% overhead
      434 
      435 -### Compatibility                                             
      435 +### Graph Compatibility
      436 
      437 -- Graphs created in managed mode readable by unmanaged code   
      438 -- Graphs created in unmanaged mode can be "adopted" by managed
          - mode                                                         
      439 -- Anchor commits are valid graph nodes (can be filtered by `_t
          -ype: "anchor"` in message)                                    
      437 +- Graphs created in managed mode are readable in unmanaged mod
          +e (they're just Git commits)
      438 +- Graphs created in unmanaged mode can be "adopted" by opening
          + with managed mode
      439 +- Anchor commits are valid graph nodes with a reserved message
          + format:
      440 +  ```json
      441 +  {"_type": "empty-graph:anchor", "version": 1}
      442 +  ```
      443 +- Anchor commits are automatically filtered from query results
          + (unless explicitly requested)
      444 
      445  ---
      446 

⏺ Let me verify the final document looks coherent.

⏺ Read 1 file (ctrl+o to expand)

⏺ I see a couple of issues - a stray code fence and outdated executive summary.
  Let me fix those.

⏺ Update(~/git/git-stunts/empty-graph/docs/REFS.md)
  ⎿  Removed 1 line
      394    throw new Error('persistence adapter only allowed in unmanag
           ed mode (use cwd instead)');
      395  }
      396  ```
      397 -```                                                           
      397 
      398  ### Breaking Changes from Current Implementation
      399 

⏺ Update(~/git/git-stunts/empty-graph/docs/REFS.md)
  ⎿  Added 1 line, removed 1 line
      2 
      3  ## Executive Summary
      4 
      5 -Empty-graph creates Git commits that are not automatically ancho
        -red to refs. Without explicit ref management, these commits are 
        -vulnerable to garbage collection. This document analyzes the pro
        -blem, evaluates solutions, and recommends a backward-compatible 
        -API that provides safe defaults while preserving flexibility for
        - advanced users.                                                
      5 +Empty-graph creates Git commits that are not automatically ancho
        +red to refs. Without explicit ref management, these commits are
        +vulnerable to garbage collection. This document analyzes the pro
        +blem, evaluates solutions, and recommends a new API design that
        +is safe by default while preserving flexibility for advanced use
        +rs.
      6 
      7  ---
      8 

⏺ Let me also update the footgun example to clarify it's showing the old API.

⏺ Update(~/git/git-stunts/empty-graph/docs/REFS.md)
  ⎿  Added 2 lines, removed 1 line
      33 
      34  ### The Footgun
      35 
      36 -A user who does this:                                          
      36 +With the current (pre-fix) API, a user who does this:
      37 
      38  ```javascript
      39 +// Current API - being replaced
      40  const graph = new EmptyGraph({ persistence });
      41  const sha = await graph.createNode({ message: 'important data'
          });
      42  // ... time passes, gc runs ...

⏺ Done. The document now:

  1. Frames the problem clearly - explains the current footgun without
  backward-compat baggage
  2. Evaluates all options honestly - including why the "clever" ideas
  (universal parent, ref to empty tree) don't work
  3. Recommends a pit-of-success API where:
    - open('name') → safest, simplest
    - open({ name, manualSync: true }) → user controls sync
    - open({ name, unmanaged: true, persistence }) → full manual control
  4. Is explicit about breaking changes - constructor is gone, open() is the
  only entry point
  5. Documents the implementation requirements:
    - Validation rules for mutual exclusivity
    - Anchor commit format ({"_type": "empty-graph:anchor", "version": 1})
    - Anchors filtered from queries by default

  The key insight from your feedback: users shouldn't have to disable safety
  features, they should have to enable dangerous ones. The API shape now
  enforces this.

✻ Brewed for 1m 7s

❯ So, even in the most basic "manage this shit for me" API that you're      
  recommending, someone has to call .close() before it updates the ref?     

⏺ You're right - that's still a footgun. If they forget close() or crash before
  it, data is lost.

  The truly safe default would be sync after every mutation:

  const graph = await EmptyGraph.open('my-graph');
  await graph.createNode({ message: 'A' });  // immediately synced
  await graph.createNode({ message: 'B' });  // immediately synced
  // No close() needed for safety - already anchored

  Then batching becomes the opt-in for performance, not the default:

  // Bulk operations explicitly opt into deferred sync
  await graph.batch(async (tx) => {
    await tx.createNode({ message: 'A' });
    await tx.createNode({ message: 'B' });
    await tx.createNode({ message: 'C' });
  });  // single sync at end of batch

  This flips the model:
  ┌──────────────────────────┬───────────────────────────────────┐
  │     Current Proposal     │          Better Proposal          │
  ├──────────────────────────┼───────────────────────────────────┤
  │ Deferred sync by default │ Eager sync by default             │
  ├──────────────────────────┼───────────────────────────────────┤
  │ Safety requires close()  │ Safety is automatic               │
  ├──────────────────────────┼───────────────────────────────────┤
  │ Batch is implicit        │ Batch is explicit opt-in          │
  ├──────────────────────────┼───────────────────────────────────┤
  │ Crash = data loss        │ Crash = lose only in-flight batch │
  └──────────────────────────┴───────────────────────────────────┘
  The performance hit for eager sync is real (~1-5ms per node), but for most use
   cases that's fine. Users who need bulk performance explicitly ask for it with
   batch().

  Should I update the doc to flip this?

❯ What if we just made a Writer API that the user uses to commit their      
  changes?                                                                  

⏺ That's cleaner. Explicit writer makes the "these changes aren't persisted yet"
   state obvious:

  const graph = await EmptyGraph.open('my-graph');

  // Reading - always safe, no ceremony
  const node = await graph.getNode(sha);
  for await (const n of graph.nodes()) { ... }

  // Writing - explicit commit required
  const writer = graph.writer();
  const sha = await writer.createNode({ message: 'A' });
  await writer.createNode({ message: 'B', parents: [sha] });
  await writer.commit();  // anchors everything

  Why this is better:
  ┌─────────────────────┬───────────────────┬──────────────────────────────────┐
  │       Aspect        │     Auto-sync     │            Writer API            │
  ├─────────────────────┼───────────────────┼──────────────────────────────────┤
  │ Mental model        │ Magic happens     │ Explicit staging → commit        │
  │                     │ somewhere         │                                  │
  ├─────────────────────┼───────────────────┼──────────────────────────────────┤
  │ Familiar pattern    │ Unique to this    │ Git, databases, ORMs             │
  │                     │ lib               │                                  │
  ├─────────────────────┼───────────────────┼──────────────────────────────────┤
  │ "Did it save?"      │ Who knows         │ You called commit() or you       │
  │                     │                   │ didn't                           │
  ├─────────────────────┼───────────────────┼──────────────────────────────────┤
  │ Forgetting close()  │ Data loss         │ Graph still works fine (it's     │
  │                     │                   │ just a reader)                   │
  ├─────────────────────┼───────────────────┼──────────────────────────────────┤
  │ Multiple concurrent │ Unclear           │ Multiple writers, each commits   │
  │  writes             │                   │ independently                    │
  └─────────────────────┴───────────────────┴──────────────────────────────────┘
  The graph itself becomes stateless for reads:

  const graph = await EmptyGraph.open('my-graph');
  // graph has no pending state, nothing to close/flush
  // it's just a view into the data

  Writers are the unit of work:

  const writer = graph.writer();
  // writer accumulates changes
  // writer.commit() persists them
  // if you drop the writer without commit, changes are lost (obviously)

  No implicit sync, no close() to remember, no magic. You write, you commit,
  done.

  Want me to update the doc with this model?

❯ What would that mean for the critique that we don't support batched       
  writes or transactions?                                                   

⏺ That's the beauty - the Writer IS the batch/transaction. It solves both
  problems with one concept:

  // This IS a batched write
  const writer = graph.writer();
  await writer.createNode({ message: 'A' });
  await writer.createNode({ message: 'B' });
  await writer.createNode({ message: 'C' });
  await writer.commit();  // one anchor, one ref update

  // This IS a transaction
  const writer = graph.writer();
  try {
    await writer.createNode({ message: 'debit account' });
    await writer.createNode({ message: 'credit account' });
    await writer.commit();
  } catch (err) {
    // Don't commit - changes are discarded
    // No cleanup needed, commits were never anchored
  }

  One primitive, three features:
  ┌──────────────┬───────────────────────────────┐
  │   Feature    │    How Writer Provides It     │
  ├──────────────┼───────────────────────────────┤
  │ GC safety    │ commit() creates anchor       │
  ├──────────────┼───────────────────────────────┤
  │ Batching     │ Accumulate N ops, single sync │
  ├──────────────┼───────────────────────────────┤
  │ Transactions │ All-or-nothing on commit()    │
  └──────────────┴───────────────────────────────┘
  For users who want immediate persistence:

  // Convenience method for single-write-and-commit
  const sha = await graph.writeNode({ message: 'data' });

  // Equivalent to:
  const writer = graph.writer();
  const sha = await writer.createNode({ message: 'data' });
  await writer.commit();

  The critique disappears because the API is batch/transaction-oriented by
  design. Individual writes are just batches of size 1.

❯ The only weird thing is that if you add nodes to a "branch" (not a git    
  branch, but a graph branch) that is already anchroed upstream, there's no 
  need to "commit". This not only breaks "transaction" semenatics but       
  means that "commit" is likely not necessary most of the time.             

⏺ I think there might be some confusion about reachability direction. Let me
  clarify:

  New nodes are never automatically reachable, regardless of what they point to.

  Before:
  ref → ANCHOR → A → B → C (root)

  After creating NEW with parent A:
  ref → ANCHOR → A → B → C
           ↑
          NEW points to A, but nothing points to NEW

  NEW is NOT reachable from ref

  Git reachability follows parent pointers from ref toward roots, not from roots
   toward tips. A new node pointing to an already-anchored node doesn't help -
  nothing points to the new node.

  Every new node needs to be anchored (directly or via a descendant that gets
  anchored).

  Unless I'm misunderstanding your scenario - were you thinking of a different
  case?

✻ Churned for 37s

❯ Sorry, I meant, OUR code (the empty graph) would "see" the dangling       
  commits as valid nodes and traverse to them etc. But git would not.       

⏺ Ah, that's a great point. So the problem is:

  1. User creates node with writer.createNode()
  2. Empty-graph happily reads it, traverses to it, everything "works"
  3. User thinks "why do I need to commit? It's already there"
  4. Two weeks later, GC runs, node vanishes

  The commit isn't about visibility, it's about durability - but that's not
  obvious because the node appears to work fine without it.

  This breaks the transaction mental model:
  - Traditional DB: uncommitted = invisible to others
  - Empty-graph: uncommitted = visible but may randomly disappear later

  Options:

  1. Leaky abstraction - call it anchor() not commit(), document that it's about
   GC protection, not visibility
  2. Strict isolation - uncommitted nodes aren't queryable from graph.nodes(),
  only through the writer. Makes the abstraction clean but limits
  read-your-writes.
  3. Just auto-anchor everything - accept the perf hit, make it truly safe,
  offer batch() for bulk operations
  4. Warn on read of unanchored nodes - graph queries return the node but with a
   { anchored: false } flag or logged warning

  Which direction feels right to you? I'm leaning toward either (1) with very
  clear naming, or (3) accepting that "safe by default" means "slower by
  default".

❯ What does this mean for merges... Let's say two users A and B pull down   
  the graph ref. If A adds 3 nodes (1, 2, 3) and B adds 3 nodes (4, 5, 6),  
  what happens when they push? A updates the ref to node 3. B wans to push  
  the ref to 6. Do you get a merge conflict? Diverging histories? How do    
  you resolve it?                                                           

⏺ Great question. Let's trace through it:

  Initial state (both A and B):
  remote: ref → ANCHOR_0 → [existing graph]

  A adds nodes, anchors, pushes:
  remote: ref → ANCHOR_A → 3 → 2 → 1 → ANCHOR_0 → ...

  B adds nodes locally, tries to push:
  B local: ref → ANCHOR_B → 6 → 5 → 4 → ANCHOR_0 → ...

  Git rejects B's push:
  ! [rejected] graph -> graph (non-fast-forward)

  Standard Git behavior - ANCHOR_A is not an ancestor of ANCHOR_B, so it's not a
   fast-forward.

  B must fetch and merge. But merge what? There are no files to conflict. The
  "merge" is just creating a new anchor with both histories as parents:

  ref → ANCHOR_MERGED
          ├── ANCHOR_A → 3 → 2 → 1 ─┐
          └── ANCHOR_B → 6 → 5 → 4 ─┴── ANCHOR_0 → ...

  This is actually fine for a graph database:
  - No conflicts (nodes are independent data, not file contents)
  - All nodes preserved with original SHAs
  - DAG structure is natural for graphs

  What empty-graph would need to provide:

  // B fetches and sees divergence
  await graph.fetch();

  if (graph.diverged) {
    // Merge is trivial - just create new anchor with both tips
    await graph.merge();
  }

  await graph.push();

  The merge is always automatic because there's nothing to conflict - we're just
   unifying two sets of nodes into one DAG.

  Does this change the API design? Maybe the Writer should handle this:

  const writer = graph.writer();
  await writer.createNode({ message: '4' });
  await writer.createNode({ message: '5' });
  await writer.createNode({ message: '6' });

  // push() internally: anchor, push, if rejected -> fetch, merge-anchor, retry
  await writer.push();

  The complexity is hidden. User just writes and pushes.

❯ in your example, what is ANCHOR_A ??? 

⏺ You're right to question that - I overcomplicated it.

  If A creates a linear chain (1 → 2 → 3), the ref can just point directly at
  the tip:

  ref → 3 → 2 → 1 → [previous tip] → ...

  No separate anchor commit needed for a linear chain. The anchor is only
  necessary when you have multiple tips (disconnected branches) that need to be
  unified under one ref.

  Simpler example:

  Initial:
  ref → OLD_TIP → ...

  A adds 1, 2, 3 (linear chain), pushes:
  ref → 3 → 2 → 1 → OLD_TIP → ...

  B adds 4, 5, 6 (linear chain), tries to push:
  B's local: ref → 6 → 5 → 4 → OLD_TIP → ...

  Push rejected (not fast-forward).

  B fetches, merges (creates merge commit with two parents):
  ref → MERGE → 3 → 2 → 1 → OLD_TIP
            ↘ 6 → 5 → 4 ↗

  The MERGE commit is just a regular commit with two parents (3 and 6). Git does
   this automatically with git merge. It only becomes an "anchor" in the sense
  that it unifies divergent branches.

  So the "anchor" concept is really just: a commit that makes all tips reachable
   from one ref. For linear histories, the tip itself serves that purpose. For
  divergent histories, you need a merge commit.

❯ OK I think what's complicating this in my mind is that the git graph !=   
  the actual emtpy graph. I keep confusing the two. \                       
  \                                                                         
  Do me a favor: Can you please explain this to me like this:\              
  \                                                                         
  \                                                                         
  ======================\                                                   
  STEP 1\                                                                   
  ======================\                                                   
  \                                                                         
  Add node { data: 123 }\                                                   
  \                                                                         
  +-------------------+---------------------+\                              
  | GIT VIEW          | EMPTY GRAPH VIEW    |\                              
  +-------------------+---------------------+\                              
  | <svg of git graph>|<svg of empty graph> |\                              
  +-------------------+---------------------+\                              
  \                                                                         
  etc.\                                                                     
  \                                                                         
  Make this a static HTML website in docs/lessons/refs/\                    
  Use graphviz to generate the SVGs; style the git graph like circles,      
  shas, refs, typical of git graph look and feel in most standard           
  tutorials. Style the empty graph like rounded rectangles with a header    
  and body payload, showing the commit sha, and parent shas in its          
  header... just make it look different i guess.\                           
  \                                                                         
  Run through several common workflows:\                                    
  \                                                                         
  - Single person making a "branching graph" so we can see what that looks  
  like in git vs empty tree\                                                
  - Two people making chanegs to the same graph and merging\                
  - Scenarios that would cause merge conflicts\                             
  - Scenarios that would merge cleanly\                                     
  - IDK other common things\                                                
  \                                                                         
  Seeing the two views side-by-side will help me understand this, I think.  

⏺ I'll create an interactive HTML tutorial that shows Git view vs Empty Graph
  view side-by-side.

⏺ Bash(mkdir -p /Users/james/git/git-stunts/empty-graph/docs/lessons/refs)
  ⎿  (No content)

⏺ Write(index.html)
  ⎿  Wrote 1289 lines to index.html
       1 <!DOCTYPE html>
       2 <html lang="en">
       3 <head>
       4   <meta charset="UTF-8">
       5   <meta name="viewport" content="width=device-width, initial-sca
         le=1.0">
       6   <title>Git View vs Empty Graph View</title>
       7   <script src="https://unpkg.com/@viz-js/viz@3.2.4/lib/viz-stand
         alone.js"></script>
       8   <style>
       9     :root {
      10       --git-color: #f05033;
     … +1279 lines (ctrl+o to expand)

⏺ Created the interactive tutorial. Let me verify it renders correctly.

⏺ Bash(cd /Users/james/git/git-stunts/empty-graph/docs/lessons/refs && python3
      -m http.server 8765 &
      sleep 1…)
  ⎿  Server started at http://localhost:8765

⏺ The tutorial is available at http://localhost:8765

  Here's what it covers:
  Scenario: 1. Linear Graph
  What It Shows: Single user creates chain of nodes. Git view shows commits,
    Empty Graph view shows data. Demonstrates how ref points to tip.
  ────────────────────────────────────────
  Scenario: 2. Branching Graph
  What It Shows: Single user creates fork (OrderShipped vs OrderCancelled).
  Shows
     why anchor commits are needed when you have multiple tips.
  ────────────────────────────────────────
  Scenario: 3. Clean Merge
  What It Shows: Alice and Bob modify different branches. Push/fetch/merge flow.

    Shows that merges are trivial because nodes don't conflict.
  ────────────────────────────────────────
  Scenario: 4. Same Parent
  What It Shows: Alice and Bob both add children to the same node. NOT a
  conflict
     - both nodes exist. Application decides semantics.
  ────────────────────────────────────────
  Scenario: 5. GC Problem
  What It Shows: What happens when you forget to commit. Node exists but is
    "dangling". GC deletes it. Data loss.
  Each step shows side-by-side:
  - Git View: Circles for commits, boxes for refs, arrows for parent
  relationships (styled like typical Git tutorials)
  - Empty Graph View: Rounded rectangles with header (SHA) and body (data),
  showing your logical data model

  The key visual distinction: the Git graph has anchor commits and refs that the
   Empty Graph view hides - those are infrastructure, not your data.

✻ Crunched for 3m 15s

❯ OK already in step 1 of scenario 1, that is not how Empty Graph works. It 
  doesn't create a ref right now.                                           

⏺ You're right - I was showing the proposed API, not the current behavior. Let
  me fix it to show how it actually works today.

⏺ Update(index.html)
  ⎿  Added 7 lines, removed 6 lines
      271    <div class="step">
      272      <div class="step-header">
      273        <span class="step-num">STEP 1</span>
      274 -      Initial state - empty repository with just the ref      
      274 +      Initial state - create EmptyGraph instance
      275      </div>
      276      <div class="step-description">
      277 -      <code>const graph = await EmptyGraph.open('events')</cod
          -e>                                                            
      278 -      <p>Graph opened. Ref created at <code>refs/empty-graph/e
          -vents</code>, but points to nothing yet.</p>                  
      277 +      <code>const plumbing = new GitPlumbing({ cwd: './repo' }
          +);<br>
      278 +const persistence = new GitGraphAdapter({ plumbing });<br>
      279 +const graph = new EmptyGraph({ persistence });</code>
      280 +      <p>Graph created. <strong>No ref exists yet.</strong> Th
          +e library doesn't create any refs automatically.</p>
      281      </div>
      282      <div class="views">
      283        <div class="view git-view">
     ...
      288              bgcolor="transparent";
      289              node [fontname="Helvetica", fontsize=11];
      290 
      289 -            ref [label="refs/empty-graph/events", shape=box, s
          -tyle=filled, fillcolor="#ffcccc", fontcolor="#333"];          
      290 -            null [label="(nothing)", shape=plaintext, fontcolo
          -r="#999"];                                                    
      291 -            ref -> null [style=dashed, color="#999"];         
      291 +            empty [label="(empty .git/objects/)\n(no refs)", s
          +hape=plaintext, fontcolor="#999"];
      292            }
      293          '></div>
      294 +        <p style="text-align:center;font-size:11px;color:#666;
          +">Nothing in Git yet - no commits, no refs</p>
      295        </div>
      296        <div class="view graph-view">
      297          <h4>Empty Graph View</h4>
  ⎿  Interrupted · What should Claude do instead?

❯ Yeah, show me CURRENTLY (git view, graph view) vs With FIX: (git view,    
  graph view) and a comparison/explination at each step of the scenario.    
  Sorry I'm being so diffigcult today, I am very distracted by non-work     
  related things in my life today.                                          

⏺ No worries at all - that's a much better structure. Let me rewrite it with a
  4-panel comparison: Current vs Fixed, each with Git and Graph views.

⏺ Write(index.html)
  ⎿  Added 599 lines, removed 1065 lines
       3  <head>
       4    <meta charset="UTF-8">
       5    <meta name="viewport" content="width=device-width, initial-sc
          ale=1.0">
       6 -  <title>Git View vs Empty Graph View</title>                  
       6 +  <title>Empty Graph: Current vs Fixed - Ref Management</title>
       7    <script src="https://unpkg.com/@viz-js/viz@3.2.4/lib/viz-stan
          dalone.js"></script>
       8    <style>
       9      :root {
      10 +      --current-color: #dc3545;
      11 +      --fixed-color: #28a745;
      12        --git-color: #f05033;
      13        --graph-color: #6f42c1;
      12 -      --bg-light: #f8f9fa;                                     
      13 -      --border: #dee2e6;                                       
      14      }
      15 
      16 -    * {                                                        
      17 -      box-sizing: border-box;                                  
      18 -    }                                                          
      16 +    * { box-sizing: border-box; }
      17 
      18      body {
      19        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI
          ', Roboto, sans-serif;
      20        line-height: 1.6;
      23 -      max-width: 1400px;                                       
      21 +      max-width: 1600px;
      22        margin: 0 auto;
      23        padding: 20px;
      26 -      background: #fff;                                        
      24 +      background: #f5f5f5;
      25        color: #333;
      26      }
      27 
      28      h1 {
      29        text-align: center;
      32 -      border-bottom: 3px solid var(--border);                  
      33 -      padding-bottom: 20px;                                    
      30 +      margin-bottom: 10px;
      31      }
      32 
      36 -    h2 {                                                       
      37 -      color: #333;                                             
      38 -      margin-top: 60px;                                        
      39 -      padding: 15px;                                           
      40 -      background: var(--bg-light);                             
      41 -      border-left: 4px solid var(--git-color);                 
      33 +    .subtitle {
      34 +      text-align: center;
      35 +      color: #666;
      36 +      margin-bottom: 30px;
      37      }
      38 
      44 -    .intro {                                                   
      45 -      background: #e7f3ff;                                     
      46 -      border: 1px solid #b3d7ff;                               
      47 -      border-radius: 8px;                                      
      48 -      padding: 20px;                                           
      49 -      margin: 20px 0;                                          
      50 -    }                                                          
      51 -                                                               
      52 -    .intro h3 {                                                
      53 -      margin-top: 0;                                           
      54 -      color: #0066cc;                                          
      55 -    }                                                          
      56 -                                                               
      39      .step {
      58 -      margin: 40px 0;                                          
      59 -      border: 1px solid var(--border);                         
      60 -      border-radius: 8px;                                      
      40 +      background: white;
      41 +      margin: 30px 0;
      42 +      border-radius: 12px;
      43 +      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      44        overflow: hidden;
      45      }
      46 
     ...
       48        background: #333;
       49        color: white;
       50        padding: 15px 20px;
       68 -      font-family: monospace;                                 
       69 -      font-size: 14px;                                        
       51 +      font-size: 18px;
       52      }
       53 
       72 -    .step-header .step-num {                                  
       73 -      background: var(--git-color);                           
       54 +    .step-header .num {
       55 +      background: #666;
       56        padding: 4px 12px;
       57        border-radius: 4px;
       58        margin-right: 15px;
       59        font-weight: bold;
       60 +      font-size: 14px;
       61      }
       62 
       80 -    .step-description {                                       
       63 +    .step-code {
       64 +      background: #1e1e1e;
       65 +      color: #d4d4d4;
       66        padding: 15px 20px;
       82 -      background: var(--bg-light);                            
       83 -      border-bottom: 1px solid var(--border);                 
       67 +      font-family: 'Monaco', 'Menlo', monospace;
       68 +      font-size: 13px;
       69 +      border-bottom: 1px solid #333;
       70      }
       71 
       86 -    .step-description code {                                  
       87 -      background: #e9ecef;                                    
       88 -      padding: 2px 6px;                                       
       89 -      border-radius: 3px;                                     
       90 -      font-size: 14px;                                        
       72 +    .comparison {
       73 +      display: grid;
       74 +      grid-template-columns: 1fr 1fr;
       75      }
       76 
       77 +    .current-side {
       78 +      border-right: 3px solid #eee;
       79 +    }
       80 +
       81 +    .side-header {
       82 +      padding: 10px 20px;
       83 +      font-weight: bold;
       84 +      font-size: 12px;
       85 +      text-transform: uppercase;
       86 +      letter-spacing: 1px;
       87 +    }
       88 +
       89 +    .current-side .side-header {
       90 +      background: #ffebee;
       91 +      color: var(--current-color);
       92 +      border-bottom: 2px solid var(--current-color);
       93 +    }
       94 +
       95 +    .fixed-side .side-header {
       96 +      background: #e8f5e9;
       97 +      color: var(--fixed-color);
       98 +      border-bottom: 2px solid var(--fixed-color);
       99 +    }
      100 +
      101      .views {
      102        display: grid;
      103        grid-template-columns: 1fr 1fr;
      104      }
      105 
      106      .view {
       99 -      padding: 20px;                                          
      100 -      min-height: 200px;                                      
      107 +      padding: 15px;
      108 +      min-height: 180px;
      109 +      border-right: 1px solid #eee;
      110      }
      111 
      103 -    .view:first-child {                                       
      104 -      border-right: 1px solid var(--border);                  
      112 +    .view:last-child {
      113 +      border-right: none;
      114      }
      115 
      107 -    .view h4 {                                                
      108 -      margin: 0 0 15px 0;                                     
      109 -      padding-bottom: 10px;                                   
      110 -      border-bottom: 2px solid;                               
      111 -      font-size: 14px;                                        
      116 +    .view h5 {
      117 +      margin: 0 0 10px 0;
      118 +      font-size: 11px;
      119        text-transform: uppercase;
      113 -      letter-spacing: 1px;                                    
      120 +      letter-spacing: 0.5px;
      121 +      color: #666;
      122      }
      123 
      116 -    .git-view h4 {                                            
      117 -      color: var(--git-color);                                
      118 -      border-color: var(--git-color);                         
      119 -    }                                                         
      124 +    .view h5.git { color: var(--git-color); }
      125 +    .view h5.graph { color: var(--graph-color); }
      126 
      121 -    .graph-view h4 {                                          
      122 -      color: var(--graph-color);                              
      123 -      border-color: var(--graph-color);                       
      124 -    }                                                         
      125 -                                                              
      127      .graph-container {
      128        display: flex;
      129        justify-content: center;
      130        align-items: center;
      130 -      min-height: 150px;                                      
      131 +      min-height: 120px;
      132      }
      133 
      134      .graph-container svg {
     ...
       136        height: auto;
       137      }
       138 
       138 -    .note {                                                  
       139 -      background: #fff3cd;                                   
       140 -      border: 1px solid #ffc107;                             
       141 -      border-radius: 4px;                                    
       142 -      padding: 10px 15px;                                    
       143 -      margin-top: 15px;                                      
       144 -      font-size: 14px;                                       
       139 +    .explanation {
       140 +      background: #fff9e6;
       141 +      border-top: 1px solid #eee;
       142 +      padding: 15px 20px;
       143 +      display: grid;
       144 +      grid-template-columns: 1fr 1fr;
       145 +      gap: 20px;
       146      }
       147 
       147 -    .note.danger {                                           
       148 -      background: #f8d7da;                                   
       149 -      border-color: #f5c6cb;                                 
       148 +    .explanation h5 {
       149 +      margin: 0 0 8px 0;
       150 +      font-size: 12px;
       151 +      text-transform: uppercase;
       152      }
       153 
       152 -    .note.success {                                          
       153 -      background: #d4edda;                                   
       154 -      border-color: #c3e6cb;                                 
       155 -    }                                                        
       154 +    .explanation .current h5 { color: var(--current-color); }
       155 +    .explanation .fixed h5 { color: var(--fixed-color); }
       156 
       157 -    .key-insight {                                           
       158 -      background: linear-gradient(135deg, #667eea 0%, #764ba2
           - 100%);                                                      
       159 -      color: white;                                          
       160 -      padding: 20px;                                         
       161 -      border-radius: 8px;                                    
       162 -      margin: 30px 0;                                        
       157 +    .explanation p {
       158 +      margin: 0;
       159 +      font-size: 13px;
       160      }
       161 
       165 -    .key-insight h4 {                                        
       166 -      margin: 0 0 10px 0;                                    
       167 -      font-size: 16px;                                       
       162 +    .danger {
       163 +      background: #ffebee;
       164 +      color: #c62828;
       165 +      padding: 8px 12px;
       166 +      border-radius: 4px;
       167 +      font-size: 12px;
       168 +      margin-top: 10px;
       169      }
       170 
       170 -    .scenario-intro {                                        
       171 -      padding: 15px;                                         
       172 -      background: #f8f9fa;                                   
       173 -      border-radius: 8px;                                    
       174 -      margin-bottom: 20px;                                   
       171 +    .success {
       172 +      background: #e8f5e9;
       173 +      color: #2e7d32;
       174 +      padding: 8px 12px;
       175 +      border-radius: 4px;
       176 +      font-size: 12px;
       177 +      margin-top: 10px;
       178      }
       179 
       177 -    table {                                                  
       178 -      width: 100%;                                           
       179 -      border-collapse: collapse;                             
       180 -      margin: 20px 0;                                        
       180 +    .intro {
       181 +      background: white;
       182 +      padding: 25px;
       183 +      border-radius: 12px;
       184 +      margin-bottom: 30px;
       185 +      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
       186      }
       187 
       183 -    th, td {                                                 
       184 -      border: 1px solid var(--border);                       
       185 -      padding: 12px;                                         
       186 -      text-align: left;                                      
       187 -    }                                                        
       188 +    .intro h3 { margin-top: 0; }
       189 
       189 -    th {                                                     
       190 -      background: var(--bg-light);                           
       190 +    .legend {
       191 +      display: flex;
       192 +      gap: 30px;
       193 +      margin-top: 15px;
       194 +      flex-wrap: wrap;
       195      }
       196 
       193 -    .toc {                                                   
       194 -      background: var(--bg-light);                           
       195 -      padding: 20px;                                         
       196 -      border-radius: 8px;                                    
       197 -      margin: 20px 0;                                        
       197 +    .legend-item {
       198 +      display: flex;
       199 +      align-items: center;
       200 +      gap: 8px;
       201 +      font-size: 13px;
       202      }
       203 
       200 -    .toc ul {                                                
       201 -      margin: 0;                                             
       202 -      padding-left: 20px;                                    
       204 +    .legend-color {
       205 +      width: 20px;
       206 +      height: 20px;
       207 +      border-radius: 50%;
       208      }
       209 
       205 -    .toc li {                                                
       206 -      margin: 8px 0;                                         
       207 -    }                                                        
       210 +    .legend-color.reachable { background: #ccffcc; border: 2p
           +x solid #009900; }
       211 +    .legend-color.dangling { background: #ffffcc; border: 2px
           + solid #cc9900; }
       212 +    .legend-color.anchor { background: #cce5ff; border: 2px s
           +olid #0066cc; }
       213 +    .legend-color.ref { background: #ffcccc; border: 2px soli
           +d #cc0000; }
       214 
       209 -    .toc a {                                                 
       210 -      color: #0066cc;                                        
       211 -      text-decoration: none;                                 
       215 +    table {
       216 +      width: 100%;
       217 +      border-collapse: collapse;
       218 +      margin: 15px 0;
       219 +      font-size: 14px;
       220      }
       221 
       214 -    .toc a:hover {                                           
       215 -      text-decoration: underline;                            
       222 +    th, td {
       223 +      border: 1px solid #ddd;
       224 +      padding: 10px;
       225 +      text-align: left;
       226      }
       227 +
       228 +    th { background: #f5f5f5; }
       229    </style>
       230  </head>
       231  <body>
       220 -  <h1>Git View vs Empty Graph View</h1>                      
       232 +  <h1>Empty Graph: Current vs Fixed</h1>
       233 +  <p class="subtitle">Understanding the ref/GC problem and th
           +e proposed solution</p>
       234 
       235    <div class="intro">
       223 -    <h3>Understanding the Two Perspectives</h3>              
       224 -    <p>When using Empty Graph, there are <strong>two differen
           -t graphs</strong> to keep in mind:</p>                       
       236 +    <h3>What You're Looking At</h3>
       237 +    <p>Each step shows <strong>4 panels</strong>:</p>
       238      <table>
       239        <tr>
       240 +        <th></th>
       241          <th>Git View</th>
       242          <th>Empty Graph View</th>
       243        </tr>
       244        <tr>
       231 -        <td>The actual Git commit DAG</td>                   
       232 -        <td>Your logical data graph</td>                     
       245 +        <td><strong style="color:var(--current-color)">CURREN
           +TLY</strong></td>
       246 +        <td>What Git sees (commits, refs, parent pointers)</t
           +d>
       247 +        <td>What your app sees (nodes with data)</td>
       248        </tr>
       249        <tr>
       235 -        <td>Commits, refs, parent pointers</td>              
       236 -        <td>Nodes with data, relationships</td>              
       250 +        <td><strong style="color:var(--fixed-color)">WITH FIX
           +</strong></td>
       251 +        <td>What Git sees with proposed API</td>
       252 +        <td>What your app sees (should be the same!)</td>
       253        </tr>
       238 -      <tr>                                                   
       239 -        <td>What <code>git log --graph</code> shows</td>     
       240 -        <td>What your application sees</td>                  
       241 -      </tr>                                                  
       242 -      <tr>                                                   
       243 -        <td>Determines GC reachability</td>                  
       244 -        <td>Determines your data model</td>                  
       245 -      </tr>                                                  
       254      </table>
       247 -    <p><strong>Key insight:</strong> A "branch" in your Empty
           - Graph is NOT the same as a Git branch. Your graph's structur
           -e is encoded in commit messages and parent relationships, but
           - Git sees it as just commits.</p>                            
       248 -  </div>                                                     
       255 
       250 -  <div class="toc">                                          
       251 -    <strong>Scenarios:</strong>                              
       252 -    <ul>                                                     
       253 -      <li><a href="#scenario1">Scenario 1: Single User - Line
           -ar Graph</a></li>                                            
       254 -      <li><a href="#scenario2">Scenario 2: Single User - Bran
           -ching Graph</a></li>                                         
       255 -      <li><a href="#scenario3">Scenario 3: Two Users - Clean 
           -Merge</a></li>                                               
       256 -      <li><a href="#scenario4">Scenario 4: Two Users - Diverg
           -ent Histories</a></li>                                       
       257 -      <li><a href="#scenario5">Scenario 5: The GC Problem</a>
           -</li>                                                        
       258 -    </ul>                                                    
       256 +    <div class="legend">
       257 +      <div class="legend-item"><div class="legend-color reach
           +able"></div> Reachable (GC safe)</div>
       258 +      <div class="legend-item"><div class="legend-color dangl
           +ing"></div> Dangling (GC will delete!)</div>
       259 +      <div class="legend-item"><div class="legend-color ancho
           +r"></div> Anchor commit</div>
       260 +      <div class="legend-item"><div class="legend-color ref">
           +</div> Git ref</div>
       261 +    </div>
       262    </div>
       263 
       264    <!-- ============================================== -->
       262 -  <!-- SCENARIO 1: Single User Linear Graph          -->     
       265 +  <!-- STEP 1: Initialize                            -->
       266    <!-- ============================================== -->
       267 
       265 -  <h2 id="scenario1">Scenario 1: Single User - Linear Graph</
           -h2>                                                          
       266 -                                                             
       267 -  <div class="scenario-intro">                               
       268 -    <p>Alice creates a simple event stream: User signs up, pl
           -aces an order, order ships.</p>                              
       269 -  </div>                                                     
       270 -                                                             
       268    <div class="step">
       269      <div class="step-header">
       273 -      <span class="step-num">STEP 1</span>                   
       274 -      Initial state - create EmptyGraph instance             
       270 +      <span class="num">STEP 1</span>
       271 +      Initialize the graph
       272      </div>
       276 -    <div class="step-description">                           
       277 -      <code>const plumbing = new GitPlumbing({ cwd: './repo' 
           -});<br>                                                      
       278 -const persistence = new GitGraphAdapter({ plumbing });<br>   
       279 -const graph = new EmptyGraph({ persistence });</code>        
       280 -      <p>Graph created. <strong>No ref exists yet.</strong> T
           -he library doesn't create any refs automatically.</p>        
       273 +    <div class="step-code">
       274 +// CURRENT API<br>
       275 +const graph = new EmptyGraph({ persistence: new GitGraphAdapt
           +er({ plumbing }) });<br><br>
       276 +// PROPOSED API<br>
       277 +const graph = await EmptyGraph.open('my-graph');
       278      </div>
       282 -    <div class="views">                                      
       283 -      <div class="view git-view">                            
       284 -        <h4>Git View</h4>                                    
       285 -        <div class="graph-container" data-dot='              
       286 -          digraph {                                          
       287 -            rankdir=LR;                                      
       288 -            bgcolor="transparent";                           
       289 -            node [fontname="Helvetica", fontsize=11];        
       279 
       291 -            empty [label="(empty .git/objects/)\n(no refs)", 
           -shape=plaintext, fontcolor="#999"];                          
       292 -          }                                                  
       293 -        '></div>                                             
       294 -        <p style="text-align:center;font-size:11px;color:#666
           -;">Nothing in Git yet - no commits, no refs</p>              
       280 +    <div class="comparison">
       281 +      <div class="current-side">
       282 +        <div class="side-header">Currently</div>
       283 +        <div class="views">
       284 +          <div class="view">
       285 +            <h5 class="git">Git View</h5>
       286 +            <div class="graph-container" data-dot='
       287 +              digraph {
       288 +                bgcolor="transparent";
       289 +                node [fontname="Helvetica", fontsize=11];
       290 +                empty [label="(nothing)\nNo refs\nNo commits"
           +, shape=plaintext, fontcolor="#999"];
       291 +              }
       292 +            '></div>
       293 +          </div>
       294 +          <div class="view">
       295 +            <h5 class="graph">Empty Graph View</h5>
       296 +            <div class="graph-container" data-dot='
       297 +              digraph {
       298 +                bgcolor="transparent";
       299 +                empty [label="(empty graph)", shape=plaintext
           +, fontcolor="#999"];
       300 +              }
       301 +            '></div>
       302 +          </div>
       303 +        </div>
       304        </div>
       296 -      <div class="view graph-view">                          
       297 -        <h4>Empty Graph View</h4>                            
       298 -        <div class="graph-container" data-dot='              
       299 -          digraph {                                          
       300 -            bgcolor="transparent";                           
       301 -            node [fontname="Helvetica", fontsize=10];        
       302 -            empty [label="(empty graph)", shape=plaintext, fo
           -ntcolor="#999"];                                             
       303 -          }                                                  
       304 -        '></div>                                             
       305 -      </div>                                                 
       306 -    </div>                                                   
       307 -  </div>                                                     
       305 
       309 -  <div class="step">                                         
       310 -    <div class="step-header">                                
       311 -      <span class="step-num">STEP 2</span>                   
       312 -      Create first node: UserSignedUp                        
       313 -    </div>                                                   
       314 -    <div class="step-description">                           
       315 -      <code>const n1 = await writer.createNode({ message: '{"
           -type":"UserSignedUp","userId":"alice"}' })</code>            
       316 -      <p>Returns SHA: <code>a1b2c3</code>. Node exists but is
           - <strong>dangling</strong> (not yet anchored).</p>           
       317 -    </div>                                                   
       318 -    <div class="views">                                      
       319 -      <div class="view git-view">                            
       320 -        <h4>Git View</h4>                                    
       321 -        <div class="graph-container" data-dot='              
       322 -          digraph {                                          
       323 -            rankdir=LR;                                      
       324 -            bgcolor="transparent";                           
       325 -            node [fontname="Helvetica", fontsize=11];        
       326 -            edge [fontname="Helvetica", fontsize=9];         
       327 -                                                             
       328 -            ref [label="refs/empty-graph/events", shape=box, 
           -style=filled, fillcolor="#ffcccc"];                          
       329 -            null [label="(nothing)", shape=plaintext, fontcol
           -or="#999"];                                                  
       330 -            ref -> null [style=dashed, color="#999"];        
       331 -                                                             
       332 -            a1b2c3 [label="a1b2c3", shape=circle, style=fille
           -d, fillcolor="#ffffcc", width=0.6];                          
       333 -            emptytree [label="empty\ntree", shape=box, style=
           -filled, fillcolor="#eee", fontsize=9];                       
       334 -            a1b2c3 -> emptytree [label="tree", fontsize=8, co
           -lor="#999"];                                                 
       335 -                                                             
       336 -            dangling [label="DANGLING!\n(no ref points here)"
           -, shape=plaintext, fontcolor="#cc0000", fontsize=9];         
       337 -            dangling -> a1b2c3 [style=dashed, color="#cc0000"
           -, arrowhead=none];                                           
       338 -          }                                                  
       339 -        '></div>                                             
       340 -        <div class="note danger">Commit exists but is unreach
           -able from any ref. GC will delete it!</div>                  
       306 +      <div class="fixed-side">
       307 +        <div class="side-header">With Fix</div>
       308 +        <div class="views">
       309 +          <div class="view">
       310 +            <h5 class="git">Git View</h5>
       311 +            <div class="graph-container" data-dot='
       312 +              digraph {
       313 +                bgcolor="transparent";
       314 +                node [fontname="Helvetica", fontsize=11];
       315 +                ref [label="refs/empty-graph/my-graph", shape
           +=box, style=filled, fillcolor="#ffe0e0"];
       316 +                null [label="(empty)", shape=plaintext, fontc
           +olor="#999"];
       317 +                ref -> null [style=dashed, color="#999"];
       318 +              }
       319 +            '></div>
       320 +          </div>
       321 +          <div class="view">
       322 +            <h5 class="graph">Empty Graph View</h5>
       323 +            <div class="graph-container" data-dot='
       324 +              digraph {
       325 +                bgcolor="transparent";
       326 +                empty [label="(empty graph)", shape=plaintext
           +, fontcolor="#999"];
       327 +              }
       328 +            '></div>
       329 +          </div>
       330 +        </div>
       331        </div>
       342 -      <div class="view graph-view">                          
       343 -        <h4>Empty Graph View</h4>                            
       344 -        <div class="graph-container" data-dot='              
       345 -          digraph {                                          
       346 -            bgcolor="transparent";                           
       347 -            node [fontname="Helvetica", fontsize=10];        
       348 -                                                             
       349 -            n1 [label=<<table border="0" cellborder="1" cells
           -pacing="0" cellpadding="6">                                  
       350 -              <tr><td bgcolor="#e6e6fa"><b>a1b2c3</b></td></t
           -r>                                                           
       351 -              <tr><td bgcolor="white" align="left">type: User
           -SignedUp<br/>userId: alice</td></tr>                         
       352 -              <tr><td bgcolor="#f0f0f0"><font point-size="9">
           -parents: (none)</font></td></tr>                             
       353 -            </table>>, shape=none];                          
       354 -          }                                                  
       355 -        '></div>                                             
       356 -      </div>                                                 
       332      </div>
       358 -  </div>                                                     
       333 
       360 -  <div class="step">                                         
       361 -    <div class="step-header">                                
       362 -      <span class="step-num">STEP 3</span>                   
       363 -      Create second node: OrderPlaced (child of UserSignedUp)
       364 -    </div>                                                   
       365 -    <div class="step-description">                           
       366 -      <code>const n2 = await writer.createNode({ message: '{"
           -type":"OrderPlaced","orderId":"ord-1"}', parents: [n1] })</co
           -de>                                                          
       367 -      <p>Returns SHA: <code>d4e5f6</code>. This commit has <c
           -ode>a1b2c3</code> as its Git parent.</p>                     
       368 -    </div>                                                   
       369 -    <div class="views">                                      
       370 -      <div class="view git-view">                            
       371 -        <h4>Git View</h4>                                    
       372 -        <div class="graph-container" data-dot='              
       373 -          digraph {                                          
       374 -            rankdir=LR;                                      
       375 -            bgcolor="transparent";                           
       376 -            node [fontname="Helvetica", fontsize=11];        
       377 -                                                             
       378 -            ref [label="refs/empty-graph/events", shape=box, 
           -style=filled, fillcolor="#ffcccc"];                          
       379 -            null [label="(nothing)", shape=plaintext, fontcol
           -or="#999"];                                                  
       380 -            ref -> null [style=dashed, color="#999"];        
       381 -                                                             
       382 -            d4e5f6 [label="d4e5f6", shape=circle, style=fille
           -d, fillcolor="#ffffcc", width=0.6];                          
       383 -            a1b2c3 [label="a1b2c3", shape=circle, style=fille
           -d, fillcolor="#ffffcc", width=0.6];                          
       384 -                                                             
       385 -            d4e5f6 -> a1b2c3 [label="parent"];               
       386 -                                                             
       387 -            dangling [label="BOTH DANGLING!", shape=plaintext
           -, fontcolor="#cc0000", fontsize=9];                          
       388 -          }                                                  
       389 -        '></div>                                             
       334 +    <div class="explanation">
       335 +      <div class="current">
       336 +        <h5>Current Behavior</h5>
       337 +        <p>Nothing happens in Git. No ref is created. The lib
           +rary is just an object in memory with no Git presence yet.</p
           +>
       338        </div>
       391 -      <div class="view graph-view">                          
       392 -        <h4>Empty Graph View</h4>                            
       393 -        <div class="graph-container" data-dot='              
       394 -          digraph {                                          
       395 -            bgcolor="transparent";                           
       396 -            node [fontname="Helvetica", fontsize=10];        
       397 -            rankdir=TB;                                      
       398 -                                                             
       399 -            n2 [label=<<table border="0" cellborder="1" cells
           -pacing="0" cellpadding="6">                                  
       400 -              <tr><td bgcolor="#e6e6fa"><b>d4e5f6</b></td></t
           -r>                                                           
       401 -              <tr><td bgcolor="white" align="left">type: Orde
           -rPlaced<br/>orderId: ord-1</td></tr>                         
       402 -              <tr><td bgcolor="#f0f0f0"><font point-size="9">
           -parents: [a1b2c3]</font></td></tr>                           
       403 -            </table>>, shape=none];                          
       404 -                                                             
       405 -            n1 [label=<<table border="0" cellborder="1" cells
           -pacing="0" cellpadding="6">                                  
       406 -              <tr><td bgcolor="#e6e6fa"><b>a1b2c3</b></td></t
           -r>                                                           
       407 -              <tr><td bgcolor="white" align="left">type: User
           -SignedUp<br/>userId: alice</td></tr>                         
       408 -              <tr><td bgcolor="#f0f0f0"><font point-size="9">
           -parents: (none)</font></td></tr>                             
       409 -            </table>>, shape=none];                          
       410 -                                                             
       411 -            n2 -> n1 [label="parent", fontsize=9];           
       412 -          }                                                  
       413 -        '></div>                                             
       339 +      <div class="fixed">
       340 +        <h5>Fixed Behavior</h5>
       341 +        <p>A ref is created at <code>refs/empty-graph/my-grap
           +h</code>. It doesn't point to anything yet, but the ref <em>e
           +xists</em> and is ready to anchor commits.</p>
       342        </div>
       343      </div>
       344    </div>
       345 
       418 -  <div class="step">                                         
       419 -    <div class="step-header">                                
       420 -      <span class="step-num">STEP 4</span>                   
       421 -      Create third node: OrderShipped                        
       422 -    </div>                                                   
       423 -    <div class="step-description">                           
       424 -      <code>const n3 = await writer.createNode({ message: '{"
           -type":"OrderShipped","trackingNum":"XYZ"}', parents: [n2] })<
           -/code>                                                       
       425 -      <p>Returns SHA: <code>g7h8i9</code>. Now we have a chai
           -n of 3 commits.</p>                                          
       426 -    </div>                                                   
       427 -    <div class="views">                                      
       428 -      <div class="view git-view">                            
       429 -        <h4>Git View</h4>                                    
       430 -        <div class="graph-container" data-dot='              
       431 -          digraph {                                          
       432 -            rankdir=LR;                                      
       433 -            bgcolor="transparent";                           
       434 -            node [fontname="Helvetica", fontsize=11];        
       435 -                                                             
       436 -            ref [label="refs/empty-graph/events", shape=box, 
           -style=filled, fillcolor="#ffcccc"];                          
       437 -            null [label="(nothing)", shape=plaintext, fontcol
           -or="#999"];                                                  
       438 -            ref -> null [style=dashed, color="#999"];        
       439 -                                                             
       440 -            g7h8i9 [label="g7h8i9", shape=circle, style=fille
           -d, fillcolor="#ffffcc", width=0.6];                          
       441 -            d4e5f6 [label="d4e5f6", shape=circle, style=fille
           -d, fillcolor="#ffffcc", width=0.6];                          
       442 -            a1b2c3 [label="a1b2c3", shape=circle, style=fille
           -d, fillcolor="#ffffcc", width=0.6];                          
       443 -                                                             
       444 -            g7h8i9 -> d4e5f6 -> a1b2c3;                      
       445 -                                                             
       446 -            dangling [label="ALL DANGLING!", shape=plaintext,
           - fontcolor="#cc0000", fontsize=9];                           
       447 -          }                                                  
       448 -        '></div>                                             
       449 -      </div>                                                 
       450 -      <div class="view graph-view">                          
       451 -        <h4>Empty Graph View</h4>                            
       452 -        <div class="graph-container" data-dot='              
       453 -          digraph {                                          
       454 -            bgcolor="transparent";                           
       455 -            node [fontname="Helvetica", fontsize=10];        
       456 -            rankdir=TB;                                      
       457 -                                                             
       458 -            n3 [label=<<table border="0" cellborder="1" cells
           -pacing="0" cellpadding="6">                                  
       459 -              <tr><td bgcolor="#e6e6fa"><b>g7h8i9</b></td></t
           -r>                                                           
       460 -              <tr><td bgcolor="white" align="left">type: Orde
           -rShipped<br/>trackingNum: XYZ</td></tr>                      
       461 -              <tr><td bgcolor="#f0f0f0"><font point-size="9">
           -parents: [d4e5f6]</font></td></tr>                           
       462 -            </table>>, shape=none];                          
       463 -                                                             
       464 -            n2 [label=<<table border="0" cellborder="1" cells
           -pacing="0" cellpadding="6">                                  
       465 -              <tr><td bgcolor="#e6e6fa"><b>d4e5f6</b></td></t
           -r>                                                           
       466 -              <tr><td bgcolor="white" align="left">type: Orde
           -rPlaced<br/>orderId: ord-1</td></tr>                         
       467 -              <tr><td bgcolor="#f0f0f0"><font point-size="9">
           -parents: [a1b2c3]</font></td></tr>                           
       468 -            </table>>, shape=none];                          
       469 -                                                             
       470 -            n1 [label=<<table border="0" cellborder="1" cells
           -pacing="0" cellpadding="6">                                  
       471 -              <tr><td bgcolor="#e6e6fa"><b>a1b2c3</b></td></t
           -r>                                                           
       472 -              <tr><td bgcolor="white" align="left">type: User
           -SignedUp<br/>userId: alice</td></tr>                         
       473 -              <tr><td bgcolor="#f0f0f0"><font point-size="9">
           -parents: (none)</font></td></tr>                             
       474 -            </table>>, shape=none];                          
       475 -                                                             
       476 -            n3 -> n2 -> n1;                                  
       477 -          }                                                  
       478 -        '></div>                                             
       479 -      </div>                                                 
       480 -    </div>                                                   
       481 -  </div>                                                     
       482 -                                                             
       483 -  <div class="step">                                         
       484 -    <div class="step-header">                                
       485 -      <span class="step-num">STEP 5</span>                   
       486 -      Commit the writer - anchors all nodes                  
       487 -    </div>                                                   
       488 -    <div class="step-description">                           
       489 -      <code>await writer.commit()</code>                     
       490 -      <p>The ref is updated to point at the tip (<code>g7h8i9
           -</code>). All nodes are now reachable!</p>                   
       491 -    </div>                                                   
       492 -    <div class="views">                                      
       493 -      <div class="view git-view">                            
       494 -        <h4>Git View</h4>                                    
       495 -        <div class="graph-container" data-dot='              
       496 -          digraph {                                          
       497 -            rankdir=LR;                                      
       498 -            bgcolor="transparent";                           
       499 -            node [fontname="Helvetica", fontsize=11];        
       500 -                                                             
       501 -            ref [label="refs/empty-graph/events", shape=box, 
           -style=filled, fillcolor="#ccffcc"];                          
       502 -                                                             
       503 -            g7h8i9 [label="g7h8i9", shape=circle, style=fille
           -d, fillcolor="#ccffcc", width=0.6];                          
       504 -            d4e5f6 [label="d4e5f6", shape=circle, style=fille
           -d, fillcolor="#ccffcc", width=0.6];                          
       505 -            a1b2c3 [label="a1b2c3", shape=circle, style=fille
           -d, fillcolor="#ccffcc", width=0.6];                          
       506 -                                                             
       507 -            ref -> g7h8i9 [color="#009900", penwidth=2];     
       508 -            g7h8i9 -> d4e5f6 -> a1b2c3;                      
       509 -                                                             
       510 -            safe [label="ALL REACHABLE!\n(GC safe)", shape=pl
           -aintext, fontcolor="#009900", fontsize=9];                   
       511 -          }                                                  
       512 -        '></div>                                             
       513 -        <div class="note success">Ref points to tip. Followin
           -g parent pointers reaches all commits.</div>                 
       514 -      </div>                                                 
       515 -      <div class="view graph-view">                          
       516 -        <h4>Empty Graph View</h4>                            
       517 -        <div class="graph-container" data-dot='              
       518 -          digraph {                                          
       519 -            bgcolor="transparent";                           
       520 -            node [fontname="Helvetica", fontsize=10];        
       521 -            rankdir=TB;                                      
       522 -                                                             
       523 -            n3 [label=<<table border="0" cellborder="1" cells
           -pacing="0" cellpadding="6">                                  
       524 -              <tr><td bgcolor="#ccffcc"><b>g7h8i9</b></td></t
           -r>                                                           
       525 -              <tr><td bgcolor="white" align="left">type: Orde
           -rShipped<br/>trackingNum: XYZ</td></tr>                      
       526 -              <tr><td bgcolor="#f0f0f0"><font point-size="9">
           -parents: [d4e5f6]</font></td></tr>                           
       527 -            </table>>, shape=none];                          
       528 -                                                             
       529 -            n2 [label=<<table border="0" cellborder="1" cells
           -pacing="0" cellpadding="6">                                  
       530 -              <tr><td bgcolor="#ccffcc"><b>d4e5f6</b></td></t
           -r>                                                           
       531 -              <tr><td bgcolor="white" align="left">type: Orde
           -rPlaced<br/>orderId: ord-1</td></tr>                         
       532 -              <tr><td bgcolor="#f0f0f0"><font point-size="9">
           -parents: [a1b2c3]</font></td></tr>                           
       533 -            </table>>, shape=none];                          
       534 -                                                             
       535 -            n1 [label=<<table border="0" cellborder="1" cells
           -pacing="0" cellpadding="6">                                  
       536 -              <tr><td bgcolor="#ccffcc"><b>a1b2c3</b></td></t
           -r>                                                           
       537 -              <tr><td bgcolor="white" align="left">type: User
           -SignedUp<br/>userId: alice</td></tr>                         
       538 -              <tr><td bgcolor="#f0f0f0"><font point-size="9">
           -parents: (none)</font></td></tr>                             
       539 -            </table>>, shape=none];                          
       540 -                                                             
       541 -            n3 -> n2 -> n1;                                  
       542 -          }                                                  
       543 -        '></div>                                             
       544 -        <p style="text-align:center;color:#009900;font-size:1
           -2px;">No change to graph structure - just now persistent</p> 
       545 -      </div>                                                 
       546 -    </div>                                                   
       547 -  </div>                                                     
       548 -                                                             
       549 -  <div class="key-insight">                                  
       550 -    <h4>Key Insight: Linear Graphs</h4>                      
       551 -    <p>For a linear chain, the Git graph and Empty Graph look
           - similar. The ref just needs to point to the tip, and all anc
           -estors are reachable via parent pointers. No special "anchor 
           -commit" needed.</p>                                          
       552 -  </div>                                                     
       553 -                                                             
       346    <!-- ============================================== -->
       555 -  <!-- SCENARIO 2: Single User Branching Graph       -->     
       347 +  <!-- STEP 2: Create first node                     -->
       348    <!-- ============================================== -->
       349 
       558 -  <h2 id="scenario2">Scenario 2: Single User - Branching Grap
           -h</h2>                                                       
       559 -                                                             
       560 -  <div class="scenario-intro">                               
       561 -    <p>Alice creates a graph where an order can have multiple
           - fulfillment paths (shipped vs cancelled). This creates a <st
           -rong>branching structure in the Empty Graph</strong> - but re
           -member, this is NOT a Git branch!</p>                        
       562 -  </div>                                                     
       563 -                                                             
       350    <div class="step">
       351      <div class="step-header">
       566 -      <span class="step-num">STEP 1</span>                   
       567 -      Start with existing linear graph from Scenario 1       
       352 +      <span class="num">STEP 2</span>
       353 +      Create first node
       354      </div>
       569 -    <div class="step-description">                           
       570 -      <p>We have: UserSignedUp → OrderPlaced → OrderShipped</
           -p>                                                           
       355 +    <div class="step-code">
       356 +const sha1 = await graph.createNode({ message: '{"type":"User
           +Created","name":"Alice"}' });<br>
       357 +// Returns: "a1b2c3d4..."
       358      </div>
       572 -    <div class="views">                                      
       573 -      <div class="view git-view">                            
       574 -        <h4>Git View</h4>                                    
       575 -        <div class="graph-container" data-dot='              
       576 -          digraph {                                          
       577 -            rankdir=LR;                                      
       578 -            bgcolor="transparent";                           
       579 -            node [fontname="Helvetica", fontsize=11];        
       359 
       581 -            ref [label="refs/empty-graph/events", shape=box, 
           -style=filled, fillcolor="#ccffcc"];                          
       582 -                                                             
       583 -            g7h8i9 [label="g7h8i9\n(shipped)", shape=circle, 
           -style=filled, fillcolor="#ccffcc", width=0.7];               
       584 -            d4e5f6 [label="d4e5f6\n(placed)", shape=circle, s
           -tyle=filled, fillcolor="#ccffcc", width=0.7];                
       585 -            a1b2c3 [label="a1b2c3\n(signup)", shape=circle, s
           -tyle=filled, fillcolor="#ccffcc", width=0.7];                
       586 -                                                             
       587 -            ref -> g7h8i9;                                   
       588 -            g7h8i9 -> d4e5f6 -> a1b2c3;                      
       589 -          }                                                  
       590 -        '></div>                                             
       360 +    <div class="comparison">
       361 +      <div class="current-side">
       362 +        <div class="side-header">Currently</div>
       363 +        <div class="views">
       364 +          <div class="view">
       365 +            <h5 class="git">Git View</h5>
       366 +            <div class="graph-container" data-dot='
       367 +              digraph {
       368 +                bgcolor="transparent";
       369 +                node [fontname="Helvetica", fontsize=11];
       370 +                a1b2 [label="a1b2c3", shape=circle, style=fil
           +led, fillcolor="#ffffcc", width=0.7];
       371 +                warn [label="DANGLING!\nNo ref points here", 
           +shape=plaintext, fontcolor="#cc0000", fontsize=9];
       372 +                warn -> a1b2 [style=dashed, arrowhead=none, c
           +olor="#cc0000"];
       373 +              }
       374 +            '></div>
       375 +            <div class="danger">Commit exists but is unreacha
           +ble. GC will delete it!</div>
       376 +          </div>
       377 +          <div class="view">
       378 +            <h5 class="graph">Empty Graph View</h5>
       379 +            <div class="graph-container" data-dot='
       380 +              digraph {
       381 +                bgcolor="transparent";
       382 +                node [fontname="Helvetica", fontsize=10];
       383 +                n1 [label=<<table border="0" cellborder="1" c
           +ellspacing="0" cellpadding="4">
       384 +                  <tr><td bgcolor="#e6e6fa"><b>a1b2c3</b></td
           +></tr>
       385 +                  <tr><td bgcolor="white">UserCreated<br/>nam
           +e: Alice</td></tr>
       386 +                </table>>, shape=none];
       387 +              }
       388 +            '></div>
       389 +            <p style="font-size:11px;color:#666;text-align:ce
           +nter;">Works fine... for now</p>
       390 +          </div>
       391 +        </div>
       392        </div>
       592 -      <div class="view graph-view">                          
       593 -        <h4>Empty Graph View</h4>                            
       594 -        <div class="graph-container" data-dot='              
       595 -          digraph {                                          
       596 -            bgcolor="transparent";                           
       597 -            node [fontname="Helvetica", fontsize=10, shape=bo
           -x, style="rounded,filled", fillcolor="white"];               
       598 -            rankdir=TB;                                      
       393 
       600 -            n3 [label="OrderShipped\ng7h8i9"];               
       601 -            n2 [label="OrderPlaced\nd4e5f6"];                
       602 -            n1 [label="UserSignedUp\na1b2c3"];               
       603 -                                                             
       604 -            n3 -> n2 -> n1;                                  
       605 -          }                                                  
       606 -        '></div>                                             
       394 +      <div class="fixed-side">
       395 +        <div class="side-header">With Fix</div>
       396 +        <div class="views">
       397 +          <div class="view">
       398 +            <h5 class="git">Git View</h5>
       399 +            <div class="graph-container" data-dot='
       400 +              digraph {
       401 +                bgcolor="transparent";
       402 +                node [fontname="Helvetica", fontsize=11];
       403 +                ref [label="refs/.../my-graph", shape=box, st
           +yle=filled, fillcolor="#ffe0e0"];
       404 +                a1b2 [label="a1b2c3", shape=circle, style=fil
           +led, fillcolor="#ccffcc", width=0.7];
       405 +                ref -> a1b2 [color="#009900", penwidth=2];
       406 +              }
       407 +            '></div>
       408 +            <div class="success">Ref immediately updated to p
           +oint to new commit.</div>
       409 +          </div>
       410 +          <div class="view">
       411 +            <h5 class="graph">Empty Graph View</h5>
       412 +            <div class="graph-container" data-dot='
       413 +              digraph {
       414 +                bgcolor="transparent";
       415 +                node [fontname="Helvetica", fontsize=10];
       416 +                n1 [label=<<table border="0" cellborder="1" c
           +ellspacing="0" cellpadding="4">
       417 +                  <tr><td bgcolor="#ccffcc"><b>a1b2c3</b></td
           +></tr>
       418 +                  <tr><td bgcolor="white">UserCreated<br/>nam
           +e: Alice</td></tr>
       419 +                </table>>, shape=none];
       420 +              }
       421 +            '></div>
       422 +            <p style="font-size:11px;color:#009900;text-align
           +:center;">Same view, but now persistent!</p>
       423 +          </div>
       424 +        </div>
       425        </div>
       426      </div>
       609 -  </div>                                                     
       427 
       611 -  <div class="step">                                         
       612 -    <div class="step-header">                                
       613 -      <span class="step-num">STEP 2</span>                   
       614 -      Create a branch: OrderCancelled (also child of OrderPla
           -ced)                                                         
       615 -    </div>                                                   
       616 -    <div class="step-description">                           
       617 -      <code>const n4 = await writer.createNode({ message: '{"
           -type":"OrderCancelled","reason":"Customer request"}', parents
           -: [n2] })</code>                                             
       618 -      <p>Returns SHA: <code>j1k2l3</code>. This creates a <st
           -rong>fork in the Empty Graph</strong> - both OrderShipped and
           - OrderCancelled have the same parent.</p>                    
       619 -    </div>                                                   
       620 -    <div class="views">                                      
       621 -      <div class="view git-view">                            
       622 -        <h4>Git View</h4>                                    
       623 -        <div class="graph-container" data-dot='              
       624 -          digraph {                                          
       625 -            rankdir=LR;                                      
       626 -            bgcolor="transparent";                           
       627 -            node [fontname="Helvetica", fontsize=11];        
       628 -                                                             
       629 -            ref [label="refs/empty-graph/events", shape=box, 
           -style=filled, fillcolor="#ccffcc"];                          
       630 -                                                             
       631 -            g7h8i9 [label="g7h8i9\n(shipped)", shape=circle, 
           -style=filled, fillcolor="#ccffcc", width=0.7];               
       632 -            d4e5f6 [label="d4e5f6\n(placed)", shape=circle, s
           -tyle=filled, fillcolor="#ccffcc", width=0.7];                
       633 -            a1b2c3 [label="a1b2c3\n(signup)", shape=circle, s
           -tyle=filled, fillcolor="#ccffcc", width=0.7];                
       634 -            j1k2l3 [label="j1k2l3\n(cancelled)", shape=circle
           -, style=filled, fillcolor="#ffffcc", width=0.7];             
       635 -                                                             
       636 -            ref -> g7h8i9;                                   
       637 -            g7h8i9 -> d4e5f6 -> a1b2c3;                      
       638 -            j1k2l3 -> d4e5f6;                                
       639 -                                                             
       640 -            dangling [label="DANGLING!\n(new node)", shape=pl
           -aintext, fontcolor="#cc0000", fontsize=9];                   
       641 -            dangling -> j1k2l3 [style=dashed, color="#cc0000"
           -, arrowhead=none];                                           
       642 -          }                                                  
       643 -        '></div>                                             
       644 -        <div class="note danger">j1k2l3 is not reachable! Ref
           - → g7h8i9 → d4e5f6 → a1b2c3. No path to j1k2l3.</div>        
       428 +    <div class="explanation">
       429 +      <div class="current">
       430 +        <h5>Current Behavior</h5>
       431 +        <p><code>git commit-tree</code> creates a commit obje
           +ct in <code>.git/objects/</code>. But nothing points to it. Y
           +our app can read it (Git stores it), but Git considers it gar
           +bage.</p>
       432        </div>
       646 -      <div class="view graph-view">                          
       647 -        <h4>Empty Graph View</h4>                            
       648 -        <div class="graph-container" data-dot='              
       649 -          digraph {                                          
       650 -            bgcolor="transparent";                           
       651 -            node [fontname="Helvetica", fontsize=10, shape=bo
           -x, style="rounded,filled", fillcolor="white"];               
       652 -            rankdir=TB;                                      
       653 -                                                             
       654 -            n3 [label="OrderShipped\ng7h8i9"];               
       655 -            n4 [label="OrderCancelled\nj1k2l3", fillcolor="#f
           -fffcc"];                                                     
       656 -            n2 [label="OrderPlaced\nd4e5f6"];                
       657 -            n1 [label="UserSignedUp\na1b2c3"];               
       658 -                                                             
       659 -            n3 -> n2;                                        
       660 -            n4 -> n2;                                        
       661 -            n2 -> n1;                                        
       662 -          }                                                  
       663 -        '></div>                                             
       664 -        <p style="text-align:center;font-size:12px;">Graph no
           -w has two branches from OrderPlaced</p>                      
       433 +      <div class="fixed">
       434 +        <h5>Fixed Behavior</h5>
       435 +        <p>After creating the commit, the ref is updated to p
           +oint to it. The commit is immediately reachable and GC-safe.
           +One extra <code>git update-ref</code> call.</p>
       436        </div>
       437      </div>
       438    </div>
       439 
       669 -  <div class="step">                                         
       670 -    <div class="step-header">                                
       671 -      <span class="step-num">STEP 3</span>                   
       672 -      Commit - but we have TWO tips now!                     
       673 -    </div>                                                   
       674 -    <div class="step-description">                           
       675 -      <code>await writer.commit()</code>                     
       676 -      <p>Problem: We have two tips (g7h8i9 and j1k2l3). The r
           -ef can only point to ONE commit. Solution: Create an <strong>
           -anchor commit</strong> with both tips as parents.</p>        
       677 -    </div>                                                   
       678 -    <div class="views">                                      
       679 -      <div class="view git-view">                            
       680 -        <h4>Git View</h4>                                    
       681 -        <div class="graph-container" data-dot='              
       682 -          digraph {                                          
       683 -            rankdir=LR;                                      
       684 -            bgcolor="transparent";                           
       685 -            node [fontname="Helvetica", fontsize=11];        
       686 -                                                             
       687 -            ref [label="refs/empty-graph/events", shape=box, 
           -style=filled, fillcolor="#ccffcc"];                          
       688 -                                                             
       689 -            anchor [label="ANCHOR\nm3n4o5", shape=circle, sty
           -le=filled, fillcolor="#cce5ff", width=0.7];                  
       690 -            g7h8i9 [label="g7h8i9\n(shipped)", shape=circle, 
           -style=filled, fillcolor="#ccffcc", width=0.7];               
       691 -            d4e5f6 [label="d4e5f6\n(placed)", shape=circle, s
           -tyle=filled, fillcolor="#ccffcc", width=0.7];                
       692 -            a1b2c3 [label="a1b2c3\n(signup)", shape=circle, s
           -tyle=filled, fillcolor="#ccffcc", width=0.7];                
       693 -            j1k2l3 [label="j1k2l3\n(cancelled)", shape=circle
           -, style=filled, fillcolor="#ccffcc", width=0.7];             
       694 -                                                             
       695 -            ref -> anchor [color="#009900", penwidth=2];     
       696 -            anchor -> g7h8i9;                                
       697 -            anchor -> j1k2l3;                                
       698 -            g7h8i9 -> d4e5f6;                                
       699 -            j1k2l3 -> d4e5f6;                                
       700 -            d4e5f6 -> a1b2c3;                                
       701 -          }                                                  
       702 -        '></div>                                             
       703 -        <div class="note success">Anchor commit (m3n4o5) has 
           -TWO parents. All nodes now reachable.</div>                  
       704 -      </div>                                                 
       705 -      <div class="view graph-view">                          
       706 -        <h4>Empty Graph View</h4>                            
       707 -        <div class="graph-container" data-dot='              
       708 -          digraph {                                          
       709 -            bgcolor="transparent";                           
       710 -            node [fontname="Helvetica", fontsize=10, shape=bo
           -x, style="rounded,filled", fillcolor="#ccffcc"];             
       711 -            rankdir=TB;                                      
       712 -                                                             
       713 -            n3 [label="OrderShipped\ng7h8i9"];               
       714 -            n4 [label="OrderCancelled\nj1k2l3"];             
       715 -            n2 [label="OrderPlaced\nd4e5f6"];                
       716 -            n1 [label="UserSignedUp\na1b2c3"];               
       717 -                                                             
       718 -            n3 -> n2;                                        
       719 -            n4 -> n2;                                        
       720 -            n2 -> n1;                                        
       721 -                                                             
       722 -            note [label="(anchor is hidden from\ngraph querie
           -s)", shape=plaintext, fontcolor="#666", fontsize=9];         
       723 -          }                                                  
       724 -        '></div>                                             
       725 -        <p style="text-align:center;font-size:12px;">Anchor c
           -ommit is internal - not part of your data model</p>          
       726 -      </div>                                                 
       727 -    </div>                                                   
       728 -  </div>                                                     
       729 -                                                             
       730 -  <div class="key-insight">                                  
       731 -    <h4>Key Insight: Branching Graphs Need Anchors</h4>      
       732 -    <p>When your Empty Graph has multiple "tips" (nodes with 
           -no children), Git needs a way to reach all of them from one r
           -ef. The anchor commit is a synthetic merge commit that has al
           -l tips as parents. It's not part of your data model - it's in
           -frastructure.</p>                                            
       733 -  </div>                                                     
       734 -                                                             
       440    <!-- ============================================== -->
       736 -  <!-- SCENARIO 3: Two Users Clean Merge             -->     
       441 +  <!-- STEP 3: Create second node (with parent)      -->
       442    <!-- ============================================== -->
       443 
       739 -  <h2 id="scenario3">Scenario 3: Two Users - Clean Merge</h2>
       740 -                                                             
       741 -  <div class="scenario-intro">                               
       742 -    <p>Alice and Bob both pull the graph. Alice adds nodes to
           - one branch, Bob adds to another. They push without conflict.
           -</p>                                                         
       743 -  </div>                                                     
       744 -                                                             
       444    <div class="step">
       445      <div class="step-header">
       747 -      <span class="step-num">STEP 1</span>                   
       748 -      Initial state - both Alice and Bob pull the same graph 
       446 +      <span class="num">STEP 3</span>
       447 +      Create second node (child of first)
       448      </div>
       750 -    <div class="step-description">                           
       751 -      <p>Both users have the branching graph from Scenario 2.
           -</p>                                                         
       449 +    <div class="step-code">
       450 +const sha2 = await graph.createNode({<br>
       451 +&nbsp;&nbsp;message: '{"type":"OrderPlaced","orderId":"order-
           +123"}',<br>
       452 +&nbsp;&nbsp;parents: [sha1]<br>
       453 +});<br>
       454 +// Returns: "d4e5f6a7..."
       455      </div>
       753 -    <div class="views">                                      
       754 -      <div class="view git-view">                            
       755 -        <h4>Git View (both users)</h4>                       
       756 -        <div class="graph-container" data-dot='              
       757 -          digraph {                                          
       758 -            rankdir=LR;                                      
       759 -            bgcolor="transparent";                           
       760 -            node [fontname="Helvetica", fontsize=11];        
       456 
       762 -            ref [label="refs/empty-graph/events", shape=box, 
           -style=filled, fillcolor="#ccffcc"];                          
       763 -            anchor [label="ANCHOR", shape=circle, style=fille
           -d, fillcolor="#cce5ff", width=0.6];                          
       764 -            shipped [label="shipped", shape=circle, style=fil
           -led, fillcolor="#ccffcc", width=0.6];                        
       765 -            cancelled [label="cancelled", shape=circle, style
           -=filled, fillcolor="#ccffcc", width=0.6];                    
       766 -            placed [label="placed", shape=circle, style=fille
           -d, fillcolor="#ccffcc", width=0.6];                          
       767 -            signup [label="signup", shape=circle, style=fille
           -d, fillcolor="#ccffcc", width=0.6];                          
       768 -                                                             
       769 -            ref -> anchor;                                   
       770 -            anchor -> shipped;                               
       771 -            anchor -> cancelled;                             
       772 -            shipped -> placed;                               
       773 -            cancelled -> placed;                             
       774 -            placed -> signup;                                
       775 -          }                                                  
       776 -        '></div>                                             
       457 +    <div class="comparison">
       458 +      <div class="current-side">
       459 +        <div class="side-header">Currently</div>
       460 +        <div class="views">
       461 +          <div class="view">
       462 +            <h5 class="git">Git View</h5>
       463 +            <div class="graph-container" data-dot='
       464 +              digraph {
       465 +                rankdir=LR;
       466 +                bgcolor="transparent";
       467 +                node [fontname="Helvetica", fontsize=11];
       468 +                d4e5 [label="d4e5f6", shape=circle, style=fil
           +led, fillcolor="#ffffcc", width=0.6];
       469 +                a1b2 [label="a1b2c3", shape=circle, style=fil
           +led, fillcolor="#ffffcc", width=0.6];
       470 +                d4e5 -> a1b2 [label="parent", fontsize=9];
       471 +                warn [label="BOTH DANGLING!", shape=plaintext
           +, fontcolor="#cc0000", fontsize=9];
       472 +              }
       473 +            '></div>
       474 +            <div class="danger">Two commits, zero refs. Both
           +will be deleted by GC.</div>
       475 +          </div>
       476 +          <div class="view">
       477 +            <h5 class="graph">Empty Graph View</h5>
       478 +            <div class="graph-container" data-dot='
       479 +              digraph {
       480 +                rankdir=TB;
       481 +                bgcolor="transparent";
       482 +                node [fontname="Helvetica", fontsize=10];
       483 +                n2 [label=<<table border="0" cellborder="1" c
           +ellspacing="0" cellpadding="4">
       484 +                  <tr><td bgcolor="#e6e6fa"><b>d4e5f6</b></td
           +></tr>
       485 +                  <tr><td bgcolor="white">OrderPlaced</td></t
           +r>
       486 +                </table>>, shape=none];
       487 +                n1 [label=<<table border="0" cellborder="1" c
           +ellspacing="0" cellpadding="4">
       488 +                  <tr><td bgcolor="#e6e6fa"><b>a1b2c3</b></td
           +></tr>
       489 +                  <tr><td bgcolor="white">UserCreated</td></t
           +r>
       490 +                </table>>, shape=none];
       491 +                n2 -> n1;
       492 +              }
       493 +            '></div>
       494 +          </div>
       495 +        </div>
       496        </div>
       778 -      <div class="view graph-view">                          
       779 -        <h4>Empty Graph View (both users)</h4>               
       780 -        <div class="graph-container" data-dot='              
       781 -          digraph {                                          
       782 -            bgcolor="transparent";                           
       783 -            node [fontname="Helvetica", fontsize=10, shape=bo
           -x, style="rounded,filled", fillcolor="white"];               
       784 -            rankdir=TB;                                      
       497 
       786 -            shipped [label="OrderShipped"];                  
       787 -            cancelled [label="OrderCancelled"];              
       788 -            placed [label="OrderPlaced"];                    
       789 -            signup [label="UserSignedUp"];                   
       790 -                                                             
       791 -            shipped -> placed;                               
       792 -            cancelled -> placed;                             
       793 -            placed -> signup;                                
       794 -          }                                                  
       795 -        '></div>                                             
       498 +      <div class="fixed-side">
       499 +        <div class="side-header">With Fix</div>
       500 +        <div class="views">
       501 +          <div class="view">
       502 +            <h5 class="git">Git View</h5>
       503 +            <div class="graph-container" data-dot='
       504 +              digraph {
       505 +                rankdir=LR;
       506 +                bgcolor="transparent";
       507 +                node [fontname="Helvetica", fontsize=11];
       508 +                ref [label="ref", shape=box, style=filled, fi
           +llcolor="#ffe0e0"];
       509 +                d4e5 [label="d4e5f6", shape=circle, style=fil
           +led, fillcolor="#ccffcc", width=0.6];
       510 +                a1b2 [label="a1b2c3", shape=circle, style=fil
           +led, fillcolor="#ccffcc", width=0.6];
       511 +                ref -> d4e5 [color="#009900", penwidth=2];
       512 +                d4e5 -> a1b2 [label="parent", fontsize=9];
       513 +              }
       514 +            '></div>
       515 +            <div class="success">Ref moved to new tip. Both c
           +ommits reachable.</div>
       516 +          </div>
       517 +          <div class="view">
       518 +            <h5 class="graph">Empty Graph View</h5>
       519 +            <div class="graph-container" data-dot='
       520 +              digraph {
       521 +                rankdir=TB;
       522 +                bgcolor="transparent";
       523 +                node [fontname="Helvetica", fontsize=10];
       524 +                n2 [label=<<table border="0" cellborder="1" c
           +ellspacing="0" cellpadding="4">
       525 +                  <tr><td bgcolor="#ccffcc"><b>d4e5f6</b></td
           +></tr>
       526 +                  <tr><td bgcolor="white">OrderPlaced</td></t
           +r>
       527 +                </table>>, shape=none];
       528 +                n1 [label=<<table border="0" cellborder="1" c
           +ellspacing="0" cellpadding="4">
       529 +                  <tr><td bgcolor="#ccffcc"><b>a1b2c3</b></td
           +></tr>
       530 +                  <tr><td bgcolor="white">UserCreated</td></t
           +r>
       531 +                </table>>, shape=none];
       532 +                n2 -> n1;
       533 +              }
       534 +            '></div>
       535 +          </div>
       536 +        </div>
       537        </div>
       538      </div>
       798 -  </div>                                                     
       539 
       800 -  <div class="step">                                         
       801 -    <div class="step-header">                                
       802 -      <span class="step-num">STEP 2</span>                   
       803 -      Alice adds "Delivered" after "Shipped", Bob adds "Refun
           -ded" after "Cancelled"                                       
       804 -    </div>                                                   
       805 -    <div class="step-description">                           
       806 -      <p>Alice: <code>createNode({ message: 'Delivered', pare
           -nts: [shipped] })</code><br>                                 
       807 -      Bob: <code>createNode({ message: 'Refunded', parents: [
           -cancelled] })</code></p>                                     
       808 -    </div>                                                   
       809 -    <div class="views">                                      
       810 -      <div class="view git-view">                            
       811 -        <h4>Git View - Alice's local</h4>                    
       812 -        <div class="graph-container" data-dot='              
       813 -          digraph {                                          
       814 -            rankdir=LR;                                      
       815 -            bgcolor="transparent";                           
       816 -            node [fontname="Helvetica", fontsize=10];        
       817 -                                                             
       818 -            ref [label="ref", shape=box, style=filled, fillco
           -lor="#ccffcc"];                                              
       819 -            anchor [label="ANCHOR", shape=circle, style=fille
           -d, fillcolor="#cce5ff", width=0.5];                          
       820 -            delivered [label="delivered\n(NEW)", shape=circle
           -, style=filled, fillcolor="#ffffcc", width=0.6];             
       821 -            shipped [label="shipped", shape=circle, style=fil
           -led, fillcolor="#ccffcc", width=0.5];                        
       822 -            cancelled [label="cancelled", shape=circle, style
           -=filled, fillcolor="#ccffcc", width=0.5];                    
       823 -            placed [label="placed", shape=circle, style=fille
           -d, fillcolor="#ccffcc", width=0.5];                          
       824 -                                                             
       825 -            ref -> anchor;                                   
       826 -            anchor -> shipped -> placed;                     
       827 -            anchor -> cancelled -> placed;                   
       828 -            delivered -> shipped [color="#cc0000", style=dash
           -ed];                                                         
       829 -          }                                                  
       830 -        '></div>                                             
       831 -        <p style="text-align:center;font-size:11px;color:#cc0
           -000;">Alice's "delivered" is dangling</p>                    
       540 +    <div class="explanation">
       541 +      <div class="current">
       542 +        <h5>Current Behavior</h5>
       543 +        <p>Another dangling commit. Yes, d4e5f6 points to a1b
           +2c3 as its parent, but that doesn't help - nothing points TO
           +d4e5f6, so neither is reachable.</p>
       544        </div>
       833 -      <div class="view graph-view">                          
       834 -        <h4>Git View - Bob's local</h4>                      
       835 -        <div class="graph-container" data-dot='              
       836 -          digraph {                                          
       837 -            rankdir=LR;                                      
       838 -            bgcolor="transparent";                           
       839 -            node [fontname="Helvetica", fontsize=10];        
       840 -                                                             
       841 -            ref [label="ref", shape=box, style=filled, fillco
           -lor="#ccffcc"];                                              
       842 -            anchor [label="ANCHOR", shape=circle, style=fille
           -d, fillcolor="#cce5ff", width=0.5];                          
       843 -            refunded [label="refunded\n(NEW)", shape=circle, 
           -style=filled, fillcolor="#ffffcc", width=0.6];               
       844 -            shipped [label="shipped", shape=circle, style=fil
           -led, fillcolor="#ccffcc", width=0.5];                        
       845 -            cancelled [label="cancelled", shape=circle, style
           -=filled, fillcolor="#ccffcc", width=0.5];                    
       846 -            placed [label="placed", shape=circle, style=fille
           -d, fillcolor="#ccffcc", width=0.5];                          
       847 -                                                             
       848 -            ref -> anchor;                                   
       849 -            anchor -> shipped -> placed;                     
       850 -            anchor -> cancelled -> placed;                   
       851 -            refunded -> cancelled [color="#cc0000", style=das
           -hed];                                                        
       852 -          }                                                  
       853 -        '></div>                                             
       854 -        <p style="text-align:center;font-size:11px;color:#cc0
           -000;">Bob's "refunded" is dangling</p>                       
       545 +      <div class="fixed">
       546 +        <h5>Fixed Behavior</h5>
       547 +        <p>Ref is updated to point to the new tip (d4e5f6). S
           +ince d4e5f6's parent is a1b2c3, both are now reachable via: r
           +ef → d4e5f6 → a1b2c3.</p>
       548        </div>
       549      </div>
       550    </div>
       551 
       859 -  <div class="step">                                         
       860 -    <div class="step-header">                                
       861 -      <span class="step-num">STEP 3</span>                   
       862 -      Alice commits and pushes first                         
       863 -    </div>                                                   
       864 -    <div class="step-description">                           
       865 -      <code>await alice.writer.commit(); await alice.push();<
           -/code>                                                       
       866 -      <p>Alice creates new anchor with "delivered" as additio
           -nal tip, pushes to remote.</p>                               
       867 -    </div>                                                   
       868 -    <div class="views">                                      
       869 -      <div class="view git-view">                            
       870 -        <h4>Git View - Remote after Alice pushes</h4>        
       871 -        <div class="graph-container" data-dot='              
       872 -          digraph {                                          
       873 -            rankdir=LR;                                      
       874 -            bgcolor="transparent";                           
       875 -            node [fontname="Helvetica", fontsize=10];        
       552 +  <!-- ============================================== -->
       553 +  <!-- STEP 4: Create a branch (two children)        -->
       554 +  <!-- ============================================== -->
       555 
       877 -            ref [label="ref", shape=box, style=filled, fillco
           -lor="#ccffcc"];                                              
       878 -            anchor2 [label="ANCHOR_2", shape=circle, style=fi
           -lled, fillcolor="#cce5ff", width=0.6];                       
       879 -            delivered [label="delivered", shape=circle, style
           -=filled, fillcolor="#ccffcc", width=0.5];                    
       880 -            shipped [label="shipped", shape=circle, style=fil
           -led, fillcolor="#ccffcc", width=0.5];                        
       881 -            cancelled [label="cancelled", shape=circle, style
           -=filled, fillcolor="#ccffcc", width=0.5];                    
       882 -            placed [label="placed", shape=circle, style=fille
           -d, fillcolor="#ccffcc", width=0.5];                          
       883 -                                                             
       884 -            ref -> anchor2 [color="#009900", penwidth=2];    
       885 -            anchor2 -> delivered -> shipped -> placed;       
       886 -            anchor2 -> cancelled -> placed;                  
       887 -          }                                                  
       888 -        '></div>                                             
       889 -      </div>                                                 
       890 -      <div class="view graph-view">                          
       891 -        <h4>Empty Graph View - Remote</h4>                   
       892 -        <div class="graph-container" data-dot='              
       893 -          digraph {                                          
       894 -            bgcolor="transparent";                           
       895 -            node [fontname="Helvetica", fontsize=10, shape=bo
           -x, style="rounded,filled", fillcolor="#ccffcc"];             
       896 -            rankdir=TB;                                      
       897 -                                                             
       898 -            delivered [label="Delivered"];                   
       899 -            shipped [label="OrderShipped"];                  
       900 -            cancelled [label="OrderCancelled"];              
       901 -            placed [label="OrderPlaced"];                    
       902 -            signup [label="UserSignedUp"];                   
       903 -                                                             
       904 -            delivered -> shipped -> placed;                  
       905 -            cancelled -> placed;                             
       906 -            placed -> signup;                                
       907 -          }                                                  
       908 -        '></div>                                             
       909 -      </div>                                                 
       910 -    </div>                                                   
       911 -  </div>                                                     
       912 -                                                             
       556    <div class="step">
       557      <div class="step-header">
       915 -      <span class="step-num">STEP 4</span>                   
       916 -      Bob commits and tries to push - REJECTED               
       558 +      <span class="num">STEP 4</span>
       559 +      Create a branch in the graph (second child of first nod
           +e)
       560      </div>
       918 -    <div class="step-description">                           
       919 -      <code>await bob.writer.commit(); await bob.push(); // F
           -AILS!</code>                                                 
       920 -      <p>Bob's anchor has the OLD anchor as ancestor. Remote 
           -has ANCHOR_2. Not a fast-forward.</p>                        
       561 +    <div class="step-code">
       562 +const sha3 = await graph.createNode({<br>
       563 +&nbsp;&nbsp;message: '{"type":"OrderCancelled","reason":"Chan
           +ged mind"}',<br>
       564 +&nbsp;&nbsp;parents: [sha1]  // Same parent as sha2!<br>
       565 +});<br>
       566 +// Returns: "g7h8i9j0..."
       567      </div>
       922 -    <div class="views">                                      
       923 -      <div class="view git-view">                            
       924 -        <h4>Git View - The conflict</h4>                     
       925 -        <div class="graph-container" data-dot='              
       926 -          digraph {                                          
       927 -            rankdir=TB;                                      
       928 -            bgcolor="transparent";                           
       929 -            node [fontname="Helvetica", fontsize=10];        
       568 
       931 -            subgraph cluster_remote {                        
       932 -              label="Remote";                                
       933 -              style=filled;                                  
       934 -              fillcolor="#e6ffe6";                           
       935 -              anchor2 [label="ANCHOR_2\n(Alice)", shape=circl
           -e, style=filled, fillcolor="#cce5ff"];                       
       936 -            }                                                
       937 -                                                             
       938 -            subgraph cluster_bob {                           
       939 -              label="Bob local";                             
       940 -              style=filled;                                  
       941 -              fillcolor="#fff0f0";                           
       942 -              anchor_bob [label="ANCHOR_B\n(Bob)", shape=circ
           -le, style=filled, fillcolor="#ffcccc"];                      
       943 -            }                                                
       944 -                                                             
       945 -            anchor1 [label="ANCHOR_1\n(original)", shape=circ
           -le, style=filled, fillcolor="#eee"];                         
       946 -                                                             
       947 -            anchor2 -> anchor1 [style=dashed, label="ancestor
           -"];                                                          
       948 -            anchor_bob -> anchor1 [style=dashed, label="ances
           -tor"];                                                       
       949 -                                                             
       950 -            conflict [label="DIVERGED!\nNot fast-forward", sh
           -ape=plaintext, fontcolor="#cc0000"];                         
       951 -          }                                                  
       952 -        '></div>                                             
       953 -        <div class="note danger">Bob's history diverged from 
           -remote. Push rejected.</div>                                 
       569 +    <div class="comparison">
       570 +      <div class="current-side">
       571 +        <div class="side-header">Currently</div>
       572 +        <div class="views">
       573 +          <div class="view">
       574 +            <h5 class="git">Git View</h5>
       575 +            <div class="graph-container" data-dot='
       576 +              digraph {
       577 +                rankdir=LR;
       578 +                bgcolor="transparent";
       579 +                node [fontname="Helvetica", fontsize=10];
       580 +                d4e5 [label="d4e5f6", shape=circle, style=fil
           +led, fillcolor="#ffffcc", width=0.55];
       581 +                g7h8 [label="g7h8i9", shape=circle, style=fil
           +led, fillcolor="#ffffcc", width=0.55];
       582 +                a1b2 [label="a1b2c3", shape=circle, style=fil
           +led, fillcolor="#ffffcc", width=0.55];
       583 +                d4e5 -> a1b2;
       584 +                g7h8 -> a1b2;
       585 +                warn [label="ALL DANGLING!", shape=plaintext,
           + fontcolor="#cc0000", fontsize=9];
       586 +              }
       587 +            '></div>
       588 +            <div class="danger">Three commits, zero refs. You
           +r "graph" is invisible to Git.</div>
       589 +          </div>
       590 +          <div class="view">
       591 +            <h5 class="graph">Empty Graph View</h5>
       592 +            <div class="graph-container" data-dot='
       593 +              digraph {
       594 +                rankdir=TB;
       595 +                bgcolor="transparent";
       596 +                node [fontname="Helvetica", fontsize=9];
       597 +                n2 [label="OrderPlaced\nd4e5f6", shape=box, s
           +tyle="rounded,filled", fillcolor="white"];
       598 +                n3 [label="OrderCancelled\ng7h8i9", shape=box
           +, style="rounded,filled", fillcolor="white"];
       599 +                n1 [label="UserCreated\na1b2c3", shape=box, s
           +tyle="rounded,filled", fillcolor="white"];
       600 +                n2 -> n1;
       601 +                n3 -> n1;
       602 +              }
       603 +            '></div>
       604 +            <p style="font-size:10px;color:#666;text-align:ce
           +nter;">Nice branching graph!<br/>(that will disappear)</p>
       605 +          </div>
       606 +        </div>
       607        </div>
       955 -      <div class="view graph-view">                          
       956 -        <h4>Empty Graph View - Both changes</h4>             
       957 -        <div class="graph-container" data-dot='              
       958 -          digraph {                                          
       959 -            bgcolor="transparent";                           
       960 -            node [fontname="Helvetica", fontsize=10, shape=bo
           -x, style="rounded,filled"];                                  
       961 -            rankdir=TB;                                      
       608 
       963 -            delivered [label="Delivered", fillcolor="#ccffcc"
           -];                                                           
       964 -            refunded [label="Refunded", fillcolor="#ffcccc"];
       965 -            shipped [label="OrderShipped", fillcolor="white"]
           -;                                                            
       966 -            cancelled [label="OrderCancelled", fillcolor="whi
           -te"];                                                        
       967 -            placed [label="OrderPlaced", fillcolor="white"]; 
       968 -                                                             
       969 -            delivered -> shipped -> placed;                  
       970 -            refunded -> cancelled -> placed;                 
       971 -          }                                                  
       972 -        '></div>                                             
       973 -        <p style="text-align:center;font-size:11px;">The grap
           -hs don't conflict - they're independent branches!</p>        
       609 +      <div class="fixed-side">
       610 +        <div class="side-header">With Fix</div>
       611 +        <div class="views">
       612 +          <div class="view">
       613 +            <h5 class="git">Git View</h5>
       614 +            <div class="graph-container" data-dot='
       615 +              digraph {
       616 +                rankdir=LR;
       617 +                bgcolor="transparent";
       618 +                node [fontname="Helvetica", fontsize=10];
       619 +                ref [label="ref", shape=box, style=filled, fi
           +llcolor="#ffe0e0"];
       620 +                anchor [label="ANCHOR", shape=circle, style=f
           +illed, fillcolor="#cce5ff", width=0.6];
       621 +                d4e5 [label="d4e5f6", shape=circle, style=fil
           +led, fillcolor="#ccffcc", width=0.55];
       622 +                g7h8 [label="g7h8i9", shape=circle, style=fil
           +led, fillcolor="#ccffcc", width=0.55];
       623 +                a1b2 [label="a1b2c3", shape=circle, style=fil
           +led, fillcolor="#ccffcc", width=0.55];
       624 +                ref -> anchor [color="#009900", penwidth=2];
       625 +                anchor -> d4e5;
       626 +                anchor -> g7h8;
       627 +                d4e5 -> a1b2;
       628 +                g7h8 -> a1b2;
       629 +              }
       630 +            '></div>
       631 +            <div class="success">Anchor commit unifies both t
           +ips. All reachable.</div>
       632 +          </div>
       633 +          <div class="view">
       634 +            <h5 class="graph">Empty Graph View</h5>
       635 +            <div class="graph-container" data-dot='
       636 +              digraph {
       637 +                rankdir=TB;
       638 +                bgcolor="transparent";
       639 +                node [fontname="Helvetica", fontsize=9];
       640 +                n2 [label="OrderPlaced\nd4e5f6", shape=box, s
           +tyle="rounded,filled", fillcolor="#ccffcc"];
       641 +                n3 [label="OrderCancelled\ng7h8i9", shape=box
           +, style="rounded,filled", fillcolor="#ccffcc"];
       642 +                n1 [label="UserCreated\na1b2c3", shape=box, s
           +tyle="rounded,filled", fillcolor="#ccffcc"];
       643 +                n2 -> n1;
       644 +                n3 -> n1;
       645 +                note [label="(anchor hidden\nfrom app)", shap
           +e=plaintext, fontcolor="#999", fontsize=8];
       646 +              }
       647 +            '></div>
       648 +          </div>
       649 +        </div>
       650        </div>
       651      </div>
       976 -  </div>                                                     
       652 
       978 -  <div class="step">                                         
       979 -    <div class="step-header">                                
       980 -      <span class="step-num">STEP 5</span>                   
       981 -      Bob fetches and merges - automatic, no conflicts       
       982 -    </div>                                                   
       983 -    <div class="step-description">                           
       984 -      <code>await bob.fetch(); await bob.merge(); await bob.p
           -ush();</code>                                                
       985 -      <p>Merge creates new anchor with BOTH users' tips. No d
           -ata conflicts because nodes are independent.</p>             
       986 -    </div>                                                   
       987 -    <div class="views">                                      
       988 -      <div class="view git-view">                            
       989 -        <h4>Git View - After merge</h4>                      
       990 -        <div class="graph-container" data-dot='              
       991 -          digraph {                                          
       992 -            rankdir=LR;                                      
       993 -            bgcolor="transparent";                           
       994 -            node [fontname="Helvetica", fontsize=10];        
       995 -                                                             
       996 -            ref [label="ref", shape=box, style=filled, fillco
           -lor="#ccffcc"];                                              
       997 -            anchor3 [label="ANCHOR_3\n(merged)", shape=circle
           -, style=filled, fillcolor="#cce5ff", width=0.7];             
       998 -            delivered [label="delivered", shape=circle, style
           -=filled, fillcolor="#ccffcc", width=0.5];                    
       999 -            refunded [label="refunded", shape=circle, style=f
           -illed, fillcolor="#ccffcc", width=0.5];                      
      1000 -            shipped [label="shipped", shape=circle, style=fil
           -led, fillcolor="#ccffcc", width=0.5];                        
      1001 -            cancelled [label="cancelled", shape=circle, style
           -=filled, fillcolor="#ccffcc", width=0.5];                    
      1002 -            placed [label="placed", shape=circle, style=fille
           -d, fillcolor="#ccffcc", width=0.5];                          
      1003 -                                                             
      1004 -            ref -> anchor3 [color="#009900", penwidth=2];    
      1005 -            anchor3 -> delivered -> shipped -> placed;       
      1006 -            anchor3 -> refunded -> cancelled -> placed;      
      1007 -          }                                                  
      1008 -        '></div>                                             
      1009 -        <div class="note success">New anchor has all tips as 
           -parents. Everyone's work preserved.</div>                    
       653 +    <div class="explanation">
       654 +      <div class="current">
       655 +        <h5>Current Behavior</h5>
       656 +        <p>You now have a beautiful branching graph structure
           +... that Git doesn't know exists. All three commits are "garb
           +age" waiting to be collected.</p>
       657        </div>
      1011 -      <div class="view graph-view">                          
      1012 -        <h4>Empty Graph View - Merged</h4>                   
      1013 -        <div class="graph-container" data-dot='              
      1014 -          digraph {                                          
      1015 -            bgcolor="transparent";                           
      1016 -            node [fontname="Helvetica", fontsize=10, shape=bo
           -x, style="rounded,filled", fillcolor="#ccffcc"];             
      1017 -            rankdir=TB;                                      
      1018 -                                                             
      1019 -            delivered [label="Delivered"];                   
      1020 -            refunded [label="Refunded"];                     
      1021 -            shipped [label="OrderShipped"];                  
      1022 -            cancelled [label="OrderCancelled"];              
      1023 -            placed [label="OrderPlaced"];                    
      1024 -            signup [label="UserSignedUp"];                   
      1025 -                                                             
      1026 -            delivered -> shipped -> placed;                  
      1027 -            refunded -> cancelled -> placed;                 
      1028 -            placed -> signup;                                
      1029 -          }                                                  
      1030 -        '></div>                                             
      1031 -        <p style="text-align:center;font-size:12px;color:#009
           -900;">Both branches preserved - merge was trivial!</p>       
       658 +      <div class="fixed">
       659 +        <h5>Fixed Behavior</h5>
       660 +        <p>When there are multiple tips (d4e5f6 and g7h8i9),
           +an <strong>anchor commit</strong> is created with both as par
           +ents. The ref points to the anchor, making everything reachab
           +le. The anchor is internal infrastructure - your app doesn't
           +see it.</p>
       661        </div>
       662      </div>
       663    </div>
       664 
      1036 -  <div class="key-insight">                                  
      1037 -    <h4>Key Insight: Empty Graph Merges Are (Usually) Trivial
           -</h4>                                                        
      1038 -    <p>Because Empty Graph nodes are independent data points 
           -(not file contents), there's nothing to "conflict". A merge j
           -ust means "include all nodes from both histories". The anchor
           - commit unifies them. This is fundamentally different from me
           -rging code!</p>                                              
      1039 -  </div>                                                     
      1040 -                                                             
       665    <!-- ============================================== -->
      1042 -  <!-- SCENARIO 4: Divergent Histories               -->     
       666 +  <!-- STEP 5: Time passes, GC runs                  -->
       667    <!-- ============================================== -->
       668 
      1045 -  <h2 id="scenario4">Scenario 4: Two Users - Same Parent, Dif
           -ferent Data</h2>                                             
      1046 -                                                             
      1047 -  <div class="scenario-intro">                               
      1048 -    <p>What if Alice and Bob both add a node with the <strong
           ->same parent</strong>? Is this a "conflict"?</p>             
      1049 -  </div>                                                     
      1050 -                                                             
       669    <div class="step">
       670      <div class="step-header">
      1053 -      <span class="step-num">STEP 1</span>                   
      1054 -      Both users add a child to the same node                
       671 +      <span class="num">STEP 5</span>
       672 +      Two weeks later... GC runs
       673      </div>
      1056 -    <div class="step-description">                           
      1057 -      <p>Alice: <code>createNode({ message: 'NoteA', parents:
           - [placed] })</code><br>                                      
      1058 -      Bob: <code>createNode({ message: 'NoteB', parents: [pla
           -ced] })</code></p>                                           
      1059 -      <p>Both create children of "OrderPlaced".</p>          
       674 +    <div class="step-code">
       675 +// Automatically, or manually via: git gc --prune=now
       676      </div>
      1061 -    <div class="views">                                      
      1062 -      <div class="view git-view">                            
      1063 -        <h4>Git View - After both commit</h4>                
      1064 -        <div class="graph-container" data-dot='              
      1065 -          digraph {                                          
      1066 -            rankdir=LR;                                      
      1067 -            bgcolor="transparent";                           
      1068 -            node [fontname="Helvetica", fontsize=10];        
       677 
      1070 -            alice_anchor [label="ANCHOR_A", shape=circle, sty
           -le=filled, fillcolor="#ffe6e6", width=0.6];                  
      1071 -            bob_anchor [label="ANCHOR_B", shape=circle, style
           -=filled, fillcolor="#e6e6ff", width=0.6];                    
      1072 -            noteA [label="NoteA", shape=circle, style=filled,
           - fillcolor="#ffe6e6", width=0.5];                            
      1073 -            noteB [label="NoteB", shape=circle, style=filled,
           - fillcolor="#e6e6ff", width=0.5];                            
      1074 -            placed [label="placed", shape=circle, style=fille
           -d, fillcolor="#ccffcc", width=0.5];                          
      1075 -            signup [label="signup", shape=circle, style=fille
           -d, fillcolor="#ccffcc", width=0.5];                          
      1076 -                                                             
      1077 -            alice_anchor -> noteA -> placed -> signup;       
      1078 -            bob_anchor -> noteB -> placed;                   
      1079 -          }                                                  
      1080 -        '></div>                                             
      1081 -        <p style="text-align:center;font-size:11px;">Two inde
           -pendent anchors, both valid</p>                              
       678 +    <div class="comparison">
       679 +      <div class="current-side">
       680 +        <div class="side-header">Currently</div>
       681 +        <div class="views">
       682 +          <div class="view">
       683 +            <h5 class="git">Git View</h5>
       684 +            <div class="graph-container" data-dot='
       685 +              digraph {
       686 +                bgcolor="transparent";
       687 +                node [fontname="Helvetica", fontsize=11];
       688 +                empty [label="(empty)\nAll commits DELETED", 
           +shape=plaintext, fontcolor="#cc0000"];
       689 +              }
       690 +            '></div>
       691 +            <div class="danger">Git deleted all "unreachable"
           + objects. Your data is GONE.</div>
       692 +          </div>
       693 +          <div class="view">
       694 +            <h5 class="graph">Empty Graph View</h5>
       695 +            <div class="graph-container" data-dot='
       696 +              digraph {
       697 +                bgcolor="transparent";
       698 +                node [fontname="Helvetica", fontsize=10];
       699 +                err [label="graph.readNode(sha1)\n\nError: ob
           +ject not found", shape=box, style=filled, fillcolor="#ffcccc"
           +, fontname="monospace", fontsize=10];
       700 +              }
       701 +            '></div>
       702 +            <div class="danger">DATA LOSS. Unrecoverable.</di
           +v>
       703 +          </div>
       704 +        </div>
       705        </div>
      1083 -      <div class="view graph-view">                          
      1084 -        <h4>Empty Graph View - Combined</h4>                 
      1085 -        <div class="graph-container" data-dot='              
      1086 -          digraph {                                          
      1087 -            bgcolor="transparent";                           
      1088 -            node [fontname="Helvetica", fontsize=10, shape=bo
           -x, style="rounded,filled"];                                  
      1089 -            rankdir=TB;                                      
       706 
      1091 -            noteA [label="NoteA\n(Alice)", fillcolor="#ffe6e6
           -"];                                                          
      1092 -            noteB [label="NoteB\n(Bob)", fillcolor="#e6e6ff"]
           -;                                                            
      1093 -            placed [label="OrderPlaced", fillcolor="white"]; 
      1094 -            signup [label="UserSignedUp", fillcolor="white"];
      1095 -                                                             
      1096 -            noteA -> placed;                                 
      1097 -            noteB -> placed;                                 
      1098 -            placed -> signup;                                
      1099 -          }                                                  
      1100 -        '></div>                                             
      1101 -        <p style="text-align:center;font-size:11px;">NOT a co
           -nflict - both nodes exist!</p>                               
       707 +      <div class="fixed-side">
       708 +        <div class="side-header">With Fix</div>
       709 +        <div class="views">
       710 +          <div class="view">
       711 +            <h5 class="git">Git View</h5>
       712 +            <div class="graph-container" data-dot='
       713 +              digraph {
       714 +                rankdir=LR;
       715 +                bgcolor="transparent";
       716 +                node [fontname="Helvetica", fontsize=10];
       717 +                ref [label="ref", shape=box, style=filled, fi
           +llcolor="#ffe0e0"];
       718 +                anchor [label="ANCHOR", shape=circle, style=f
           +illed, fillcolor="#cce5ff", width=0.6];
       719 +                d4e5 [label="d4e5f6", shape=circle, style=fil
           +led, fillcolor="#ccffcc", width=0.55];
       720 +                g7h8 [label="g7h8i9", shape=circle, style=fil
           +led, fillcolor="#ccffcc", width=0.55];
       721 +                a1b2 [label="a1b2c3", shape=circle, style=fil
           +led, fillcolor="#ccffcc", width=0.55];
       722 +                ref -> anchor [color="#009900", penwidth=2];
       723 +                anchor -> d4e5;
       724 +                anchor -> g7h8;
       725 +                d4e5 -> a1b2;
       726 +                g7h8 -> a1b2;
       727 +                gc [label="GC runs...\nnothing deleted!", sha
           +pe=plaintext, fontcolor="#009900", fontsize=9];
       728 +              }
       729 +            '></div>
       730 +            <div class="success">All commits reachable from r
           +ef. GC leaves them alone.</div>
       731 +          </div>
       732 +          <div class="view">
       733 +            <h5 class="graph">Empty Graph View</h5>
       734 +            <div class="graph-container" data-dot='
       735 +              digraph {
       736 +                rankdir=TB;
       737 +                bgcolor="transparent";
       738 +                node [fontname="Helvetica", fontsize=9];
       739 +                n2 [label="OrderPlaced\nd4e5f6", shape=box, s
           +tyle="rounded,filled", fillcolor="#ccffcc"];
       740 +                n3 [label="OrderCancelled\ng7h8i9", shape=box
           +, style="rounded,filled", fillcolor="#ccffcc"];
       741 +                n1 [label="UserCreated\na1b2c3", shape=box, s
           +tyle="rounded,filled", fillcolor="#ccffcc"];
       742 +                n2 -> n1;
       743 +                n3 -> n1;
       744 +              }
       745 +            '></div>
       746 +            <div class="success">Data intact. Works exactly a
           +s before.</div>
       747 +          </div>
       748 +        </div>
       749        </div>
       750      </div>
      1104 -  </div>                                                     
       751 
      1106 -  <div class="step">                                         
      1107 -    <div class="step-header">                                
      1108 -      <span class="step-num">STEP 2</span>                   
      1109 -      After merge - both nodes preserved                     
      1110 -    </div>                                                   
      1111 -    <div class="step-description">                           
      1112 -      <p>The merge creates an anchor with both NoteA and Note
           -B as ancestors. Both nodes coexist.</p>                      
      1113 -    </div>                                                   
      1114 -    <div class="views">                                      
      1115 -      <div class="view git-view">                            
      1116 -        <h4>Git View - Merged</h4>                           
      1117 -        <div class="graph-container" data-dot='              
      1118 -          digraph {                                          
      1119 -            rankdir=LR;                                      
      1120 -            bgcolor="transparent";                           
      1121 -            node [fontname="Helvetica", fontsize=10];        
      1122 -                                                             
      1123 -            ref [label="ref", shape=box, style=filled, fillco
           -lor="#ccffcc"];                                              
      1124 -            anchor [label="ANCHOR\n(merged)", shape=circle, s
           -tyle=filled, fillcolor="#cce5ff", width=0.7];                
      1125 -            noteA [label="NoteA", shape=circle, style=filled,
           - fillcolor="#ccffcc", width=0.5];                            
      1126 -            noteB [label="NoteB", shape=circle, style=filled,
           - fillcolor="#ccffcc", width=0.5];                            
      1127 -            placed [label="placed", shape=circle, style=fille
           -d, fillcolor="#ccffcc", width=0.5];                          
      1128 -            signup [label="signup", shape=circle, style=fille
           -d, fillcolor="#ccffcc", width=0.5];                          
      1129 -                                                             
      1130 -            ref -> anchor;                                   
      1131 -            anchor -> noteA -> placed -> signup;             
      1132 -            anchor -> noteB -> placed;                       
      1133 -          }                                                  
      1134 -        '></div>                                             
       752 +    <div class="explanation">
       753 +      <div class="current">
       754 +        <h5>Current Behavior</h5>
       755 +        <p>Git's garbage collector deletes objects that aren'
           +t reachable from any ref. Your commits had no ref pointing to
           + them (directly or indirectly), so they're gone. This might h
           +appen 2 weeks later, or immediately if someone runs <code>git
           + gc --prune=now</code>.</p>
       756        </div>
      1136 -      <div class="view graph-view">                          
      1137 -        <h4>Empty Graph View</h4>                            
      1138 -        <div class="graph-container" data-dot='              
      1139 -          digraph {                                          
      1140 -            bgcolor="transparent";                           
      1141 -            node [fontname="Helvetica", fontsize=10, shape=bo
           -x, style="rounded,filled", fillcolor="#ccffcc"];             
      1142 -            rankdir=TB;                                      
      1143 -                                                             
      1144 -            noteA [label="NoteA\n(Alice)"];                  
      1145 -            noteB [label="NoteB\n(Bob)"];                    
      1146 -            placed [label="OrderPlaced"];                    
      1147 -            signup [label="UserSignedUp"];                   
      1148 -                                                             
      1149 -            noteA -> placed;                                 
      1150 -            noteB -> placed;                                 
      1151 -            placed -> signup;                                
      1152 -          }                                                  
      1153 -        '></div>                                             
       757 +      <div class="fixed">
       758 +        <h5>Fixed Behavior</h5>
       759 +        <p>The ref → anchor → commits chain means everything
           +is reachable. GC checks reachability, finds all commits are r
           +eachable, and leaves them alone. Your data survives forever (
           +or until you delete the ref).</p>
       760        </div>
       761      </div>
       762    </div>
       763 
      1158 -  <div class="key-insight">                                  
      1159 -    <h4>Key Insight: There Are No "Conflicts" in Empty Graph<
           -/h4>                                                         
      1160 -    <p>In traditional Git, a conflict occurs when two people 
           -edit the <strong>same line of the same file</strong>. In Empt
           -y Graph, nodes are immutable and independent. Two nodes with 
           -the same parent simply creates a fork - both exist. Your <str
           -ong>application logic</strong> decides how to interpret multi
           -ple children (last-write-wins? merge them? error?).</p>      
      1161 -  </div>                                                     
      1162 -                                                             
       764    <!-- ============================================== -->
      1164 -  <!-- SCENARIO 5: The GC Problem                    -->     
       765 +  <!-- SUMMARY                                       -->
       766    <!-- ============================================== -->
       767 
      1167 -  <h2 id="scenario5">Scenario 5: The GC Problem - Why Anchori
           -ng Matters</h2>                                              
       768 +  <div class="intro" style="margin-top:40px;">
       769 +    <h3>Summary: The Key Difference</h3>
       770 +    <table>
       771 +      <tr>
       772 +        <th></th>
       773 +        <th style="color:var(--current-color)">Currently</th>
       774 +        <th style="color:var(--fixed-color)">With Fix</th>
       775 +      </tr>
       776 +      <tr>
       777 +        <td><strong>On init</strong></td>
       778 +        <td>Nothing</td>
       779 +        <td>Create ref</td>
       780 +      </tr>
       781 +      <tr>
       782 +        <td><strong>On createNode</strong></td>
       783 +        <td>Create commit (dangling)</td>
       784 +        <td>Create commit + update ref (or anchor)</td>
       785 +      </tr>
       786 +      <tr>
       787 +        <td><strong>Multiple tips</strong></td>
       788 +        <td>Multiple dangling commits</td>
       789 +        <td>Anchor commit unifies them</td>
       790 +      </tr>
       791 +      <tr>
       792 +        <td><strong>After GC</strong></td>
       793 +        <td>DATA LOSS</td>
       794 +        <td>Data intact</td>
       795 +      </tr>
       796 +      <tr>
       797 +        <td><strong>User responsibility</strong></td>
       798 +        <td>Must manually manage refs</td>
       799 +        <td>Automatic (or explicit via Writer API)</td>
       800 +      </tr>
       801 +    </table>
       802 
      1169 -  <div class="scenario-intro">                               
      1170 -    <p>What happens if you create nodes but forget to commit/
           -anchor them?</p>                                             
       803 +    <h4 style="margin-top:25px;">The Core Problem</h4>
       804 +    <p>Git reachability flows: <strong>ref → commit → parent
           +→ parent → ...</strong></p>
       805 +    <p>Your node having a parent doesn't make it reachable. S
           +omething must point <em>to</em> your node. Currently, nothing
           + does.</p>
       806    </div>
       807 
      1173 -  <div class="step">                                         
      1174 -    <div class="step-header">                                
      1175 -      <span class="step-num">STEP 1</span>                   
      1176 -      Create nodes without committing                        
      1177 -    </div>                                                   
      1178 -    <div class="step-description">                           
      1179 -      <code>const writer = graph.writer();<br>               
      1180 -      await writer.createNode({ message: 'Important!' });<br>
      1181 -      // Oops, forgot to commit!<br>                         
      1182 -      // Process exits or crashes</code>                     
      1183 -    </div>                                                   
      1184 -    <div class="views">                                      
      1185 -      <div class="view git-view">                            
      1186 -        <h4>Git View</h4>                                    
      1187 -        <div class="graph-container" data-dot='              
      1188 -          digraph {                                          
      1189 -            rankdir=LR;                                      
      1190 -            bgcolor="transparent";                           
      1191 -            node [fontname="Helvetica", fontsize=11];        
      1192 -                                                             
      1193 -            ref [label="ref", shape=box, style=filled, fillco
           -lor="#ccffcc"];                                              
      1194 -            old [label="old\nanchor", shape=circle, style=fil
           -led, fillcolor="#ccffcc", width=0.6];                        
      1195 -            important [label="Important!", shape=circle, styl
           -e=filled, fillcolor="#ffcccc", width=0.7];                   
      1196 -                                                             
      1197 -            ref -> old;                                      
      1198 -                                                             
      1199 -            important -> old [style=dashed, color="#999"];   
      1200 -                                                             
      1201 -            gc [label="GC will\nDELETE this!", shape=plaintex
           -t, fontcolor="#cc0000", fontsize=10];                        
      1202 -            gc -> important [style=dashed, color="#cc0000", a
           -rrowhead=none];                                              
      1203 -          }                                                  
      1204 -        '></div>                                             
      1205 -        <div class="note danger">"Important!" commit exists b
           -ut nothing points TO it. Unreachable = deletable.</div>      
      1206 -      </div>                                                 
      1207 -      <div class="view graph-view">                          
      1208 -        <h4>Empty Graph View</h4>                            
      1209 -        <div class="graph-container" data-dot='              
      1210 -          digraph {                                          
      1211 -            bgcolor="transparent";                           
      1212 -            node [fontname="Helvetica", fontsize=10, shape=bo
           -x, style="rounded,filled"];                                  
      1213 -                                                             
      1214 -            important [label="Important!\n(WILL VANISH)", fil
           -lcolor="#ffcccc"];                                           
      1215 -            old [label="(old nodes)", fillcolor="white"];    
      1216 -                                                             
      1217 -            important -> old [style=dashed];                 
      1218 -          }                                                  
      1219 -        '></div>                                             
      1220 -        <p style="text-align:center;font-size:12px;color:#cc0
           -000;">Node is readable NOW but may disappear later!</p>      
      1221 -      </div>                                                 
      1222 -    </div>                                                   
      1223 -  </div>                                                     
      1224 -                                                             
      1225 -  <div class="step">                                         
      1226 -    <div class="step-header">                                
      1227 -      <span class="step-num">STEP 2</span>                   
      1228 -      Two weeks later... GC runs                             
      1229 -    </div>                                                   
      1230 -    <div class="step-description">                           
      1231 -      <code>// Git runs: git gc --prune=2.weeks.ago</code>   
      1232 -      <p>Git's garbage collection removes unreachable objects
           - older than 2 weeks.</p>                                     
      1233 -    </div>                                                   
      1234 -    <div class="views">                                      
      1235 -      <div class="view git-view">                            
      1236 -        <h4>Git View - After GC</h4>                         
      1237 -        <div class="graph-container" data-dot='              
      1238 -          digraph {                                          
      1239 -            rankdir=LR;                                      
      1240 -            bgcolor="transparent";                           
      1241 -            node [fontname="Helvetica", fontsize=11];        
      1242 -                                                             
      1243 -            ref [label="ref", shape=box, style=filled, fillco
           -lor="#ccffcc"];                                              
      1244 -            old [label="old\nanchor", shape=circle, style=fil
           -led, fillcolor="#ccffcc", width=0.6];                        
      1245 -                                                             
      1246 -            ref -> old;                                      
      1247 -                                                             
      1248 -            gone [label="\"Important!\"\nDELETED", shape=plai
           -ntext, fontcolor="#cc0000", fontsize=10];                    
      1249 -          }                                                  
      1250 -        '></div>                                             
      1251 -      </div>                                                 
      1252 -      <div class="view graph-view">                          
      1253 -        <h4>Empty Graph View - After GC</h4>                 
      1254 -        <div class="graph-container" data-dot='              
      1255 -          digraph {                                          
      1256 -            bgcolor="transparent";                           
      1257 -            node [fontname="Helvetica", fontsize=10];        
      1258 -                                                             
      1259 -            gone [label="graph.readNode(sha)\n// Error: objec
           -t not found", shape=box, style=filled, fillcolor="#ffcccc", f
           -ontname="monospace"];                                        
      1260 -          }                                                  
      1261 -        '></div>                                             
      1262 -        <p style="text-align:center;font-size:12px;color:#cc0
           -000;">DATA LOSS. The node is gone forever.</p>               
      1263 -      </div>                                                 
      1264 -    </div>                                                   
      1265 -  </div>                                                     
      1266 -                                                             
      1267 -  <div class="key-insight">                                  
      1268 -    <h4>Key Insight: The Anchor Protects Against GC</h4>     
      1269 -    <p>This is why the Writer/commit pattern exists. When you
           - <code>commit()</code>, the library creates an anchor commit 
           -that makes all your nodes reachable from the ref. Without thi
           -s anchor, your data exists in Git's object store but is consi
           -dered "garbage" and will eventually be deleted.</p>          
      1270 -    <p><strong>Remember:</strong> Git reachability goes ref →
           - commit → parents. Your node having a parent doesn't make it 
           -reachable - something must point TO your node.</p>           
      1271 -  </div>                                                     
      1272 -                                                             
       808    <script>
      1274 -    // Render all Graphviz diagrams                          
       809      Viz.instance().then(viz => {
       810        document.querySelectorAll('[data-dot]').forEach(contain
            er => {
       811          const dot = container.getAttribute('data-dot');
     ...
       814            container.innerHTML = '';
       815            container.appendChild(svg);
       816          } catch (err) {
      1283 -          container.innerHTML = `<pre style="color:red;font-s
           -ize:11px;">Error: ${err.message}</pre>`;                     
       817 +          container.innerHTML = `<pre style="color:red;font-s
           +ize:10px;">${err.message}</pre>`;
       818          }
       819        });
       820      });

⏺ Done. Refresh http://localhost:8765 to see the updated tutorial.

  Now it shows 4 panels at each step:
  ┌───────────┬───────────────┬────────────────────┐
  │           │   Git View    │     Graph View     │
  ├───────────┼───────────────┼────────────────────┤
  │ CURRENTLY │ What Git sees │ What your app sees │
  ├───────────┼───────────────┼────────────────────┤
  │ WITH FIX  │ What Git sees │ What your app sees │
  └───────────┴───────────────┴────────────────────┘
  The 5 steps walk through:

  1. Initialize - Currently: nothing. Fixed: ref created
  2. Create first node - Currently: dangling commit. Fixed: ref points to it
  3. Create child node - Currently: both dangling. Fixed: ref moves to new tip
  4. Create branch - Currently: all dangling. Fixed: anchor commit unifies tips
  5. GC runs - Currently: DATA LOSS. Fixed: everything intact

  Each step has an explanation comparing current vs fixed behavior. The summary
  table at the end captures the key differences.

✻ Crunched for 1m 56s

❯ WHAT wait a minute... What about the "empty tree"? When does that come    
  in? 4b825dc642cb6eb9a060e54bf8d69288fbee4904                              

⏺ You're right - that's a critical piece I left out! Every commit in Empty Graph
   points to the empty tree as its tree object. That's what makes it "empty" -
  no files, ever. The data lives in commit messages.

  Let me add that to the diagrams.

⏺ Update(index.html)
  ⎿  Added 15 lines
      261      </div>
      262    </div>
      263 
      264 +  <div class="intro" style="background:#fff8e1; border-color:#
          +ffcc80;">
      265 +    <h3>The "Empty" in Empty Graph: The Empty Tree</h3>
      266 +    <p>Every Git commit points to a <strong>tree</strong> (a s
          +napshot of files). In Empty Graph, every commit points to the
          +same special tree: the <strong>empty tree</strong>.</p>
      267 +    <div style="background:#333;color:#d4d4d4;padding:15px;bor
          +der-radius:6px;font-family:monospace;font-size:13px;margin:15p
          +x 0;">
      268 +      4b825dc642cb6eb9a060e54bf8d69288fbee4904  &larr; SHA of
          +the empty tree (no files)
      269 +    </div>
      270 +    <p>This means:</p>
      271 +    <ul>
      272 +      <li><strong>No files</strong> - Your working directory s
          +tays empty (or has your regular code)</li>
      273 +      <li><strong>Data in messages</strong> - All your graph d
          +ata is stored in commit messages</li>
      274 +      <li><strong>Invisible storage</strong> - The graph exist
          +s only in <code>.git/objects/</code></li>
      275 +    </ul>
      276 +    <p>In the Git View diagrams below, you'll see commits poin
          +ting to <code>EMPTY TREE</code>. This is the same tree for ALL
          + commits - it's a constant.</p>
      277 +  </div>
      278 +
      279    <!-- ============================================== -->
      280    <!-- STEP 1: Initialize                            -->
      281    <!-- ============================================== -->

⏺ Now let me update the Git diagrams to show commits pointing to the empty tree.

⏺ Update(index.html)
  ⎿  Added 2 lines
      383                  bgcolor="transparent";
      384                  node [fontname="Helvetica", fontsize=11];
      385                  a1b2 [label="a1b2c3", shape=circle, style=fill
           ed, fillcolor="#ffffcc", width=0.7];
      386 +                empty [label="EMPTY\nTREE\n4b825d...", shape=b
          +ox, style=filled, fillcolor="#f0f0f0", fontsize=8, width=0.6];
      387 +                a1b2 -> empty [label="tree", fontsize=8, color
          +="#999", style=dashed];
      388                  warn [label="DANGLING!\nNo ref points here", s
           hape=plaintext, fontcolor="#cc0000", fontsize=9];
      389                  warn -> a1b2 [style=dashed, arrowhead=none, co
           lor="#cc0000"];
      390                }

⏺ Update(index.html)
  ⎿  Added 4 lines, removed 2 lines
      419                  node [fontname="Helvetica", fontsize=11];
      420                  ref [label="refs/.../my-graph", shape=box, sty
           le=filled, fillcolor="#ffe0e0"];
      421                  a1b2 [label="a1b2c3", shape=circle, style=fill
           ed, fillcolor="#ccffcc", width=0.7];
      422 +                empty [label="EMPTY\nTREE", shape=box, style=f
          +illed, fillcolor="#f0f0f0", fontsize=8, width=0.5];
      423                  ref -> a1b2 [color="#009900", penwidth=2];
      424 +                a1b2 -> empty [label="tree", fontsize=8, color
          +="#999", style=dashed];
      425                }
      426              '></div>
      427              <div class="success">Ref immediately updated to po
           int to new commit.</div>
     ...
      447      <div class="explanation">
      448        <div class="current">
      449          <h5>Current Behavior</h5>
      448 -        <p><code>git commit-tree</code> creates a commit objec
          -t in <code>.git/objects/</code>. But nothing points to it. You
          -r app can read it (Git stores it), but Git considers it garbag
          -e.</p>                                                        
      450 +        <p><code>git commit-tree 4b825dc... -m "..."</code> cr
          +eates a commit pointing to the empty tree. The commit exists i
          +n <code>.git/objects/</code>, but no ref points to it. Git con
          +siders it garbage.</p>
      451        </div>
      452        <div class="fixed">
      453          <h5>Fixed Behavior</h5>
      452 -        <p>After creating the commit, the ref is updated to po
          -int to it. The commit is immediately reachable and GC-safe. On
          -e extra <code>git update-ref</code> call.</p>                 
      454 +        <p>Same commit creation, but immediately followed by <
          +code>git update-ref</code> to point the ref at it. Now reachab
          +le: ref → commit → empty tree. GC-safe.</p>
      455        </div>
      456      </div>
      457    </div>

⏺ Update(index.html)
  ⎿  Added 3 lines
      486                  node [fontname="Helvetica", fontsize=11];
      487                  d4e5 [label="d4e5f6", shape=circle, style=fill
           ed, fillcolor="#ffffcc", width=0.6];
      488                  a1b2 [label="a1b2c3", shape=circle, style=fill
           ed, fillcolor="#ffffcc", width=0.6];
      489 +                empty [label="EMPTY\nTREE", shape=box, style=f
          +illed, fillcolor="#f0f0f0", fontsize=8];
      490                  d4e5 -> a1b2 [label="parent", fontsize=9];
      491 +                d4e5 -> empty [style=dashed, color="#999"];
      492 +                a1b2 -> empty [style=dashed, color="#999"];
      493                  warn [label="BOTH DANGLING!", shape=plaintext,
            fontcolor="#cc0000", fontsize=9];
      494                }
      495              '></div>

⏺ Update(index.html)
  ⎿  Added 3 lines
      530                  ref [label="ref", shape=box, style=filled, fil
           lcolor="#ffe0e0"];
      531                  d4e5 [label="d4e5f6", shape=circle, style=fill
           ed, fillcolor="#ccffcc", width=0.6];
      532                  a1b2 [label="a1b2c3", shape=circle, style=fill
           ed, fillcolor="#ccffcc", width=0.6];
      533 +                empty [label="EMPTY\nTREE", shape=box, style=f
          +illed, fillcolor="#f0f0f0", fontsize=8];
      534                  ref -> d4e5 [color="#009900", penwidth=2];
      535                  d4e5 -> a1b2 [label="parent", fontsize=9];
      536 +                d4e5 -> empty [style=dashed, color="#999"];
      537 +                a1b2 -> empty [style=dashed, color="#999"];
      538                }
      539              '></div>
      540              <div class="success">Ref moved to new tip. Both co
           mmits reachable.</div>

⏺ Update(index.html)
  ⎿  Added 2 lines, removed 2 lines
      565      <div class="explanation">
      566        <div class="current">
      567          <h5>Current Behavior</h5>
      568 -        <p>Another dangling commit. Yes, d4e5f6 points to a1b2
          -c3 as its parent, but that doesn't help - nothing points TO d4
          -e5f6, so neither is reachable.</p>                            
      568 +        <p>Another dangling commit. Both point to the same emp
          +ty tree (that's fine - the empty tree is always reachable). Bu
          +t d4e5f6 pointing to a1b2c3 as parent doesn't help - nothing p
          +oints TO d4e5f6, so neither commit is reachable.</p>
      569        </div>
      570        <div class="fixed">
      571          <h5>Fixed Behavior</h5>
      572 -        <p>Ref is updated to point to the new tip (d4e5f6). Si
          -nce d4e5f6's parent is a1b2c3, both are now reachable via: ref
          - → d4e5f6 → a1b2c3.</p>                                       
      572 +        <p>Ref is updated to point to the new tip (d4e5f6). Re
          +achability: ref → d4e5f6 → a1b2c3 → (empty tree). Both commits
          + reachable, GC-safe.</p>
      573        </div>
      574      </div>
      575    </div>

⏺ Update(index.html)
  ⎿  Added 4 lines
      605                  d4e5 [label="d4e5f6", shape=circle, style=fill
           ed, fillcolor="#ffffcc", width=0.55];
      606                  g7h8 [label="g7h8i9", shape=circle, style=fill
           ed, fillcolor="#ffffcc", width=0.55];
      607                  a1b2 [label="a1b2c3", shape=circle, style=fill
           ed, fillcolor="#ffffcc", width=0.55];
      608 +                empty [label="EMPTY\nTREE", shape=box, style=f
          +illed, fillcolor="#f0f0f0", fontsize=7];
      609                  d4e5 -> a1b2;
      610                  g7h8 -> a1b2;
      611 +                d4e5 -> empty [style=dashed, color="#ccc"];
      612 +                g7h8 -> empty [style=dashed, color="#ccc"];
      613 +                a1b2 -> empty [style=dashed, color="#ccc"];
      614                  warn [label="ALL DANGLING!", shape=plaintext, 
           fontcolor="#cc0000", fontsize=9];
      615                }
      616              '></div>

⏺ Update(index.html)
  ⎿  Added 5 lines
      650                  d4e5 [label="d4e5f6", shape=circle, style=fill
           ed, fillcolor="#ccffcc", width=0.55];
      651                  g7h8 [label="g7h8i9", shape=circle, style=fill
           ed, fillcolor="#ccffcc", width=0.55];
      652                  a1b2 [label="a1b2c3", shape=circle, style=fill
           ed, fillcolor="#ccffcc", width=0.55];
      653 +                empty [label="EMPTY\nTREE", shape=box, style=f
          +illed, fillcolor="#f0f0f0", fontsize=7];
      654                  ref -> anchor [color="#009900", penwidth=2];
      655                  anchor -> d4e5;
      656                  anchor -> g7h8;
      657                  d4e5 -> a1b2;
      658                  g7h8 -> a1b2;
      659 +                anchor -> empty [style=dashed, color="#ccc"];
      660 +                d4e5 -> empty [style=dashed, color="#ccc"];
      661 +                g7h8 -> empty [style=dashed, color="#ccc"];
      662 +                a1b2 -> empty [style=dashed, color="#ccc"];
      663                }
      664              '></div>
      665              <div class="success">Anchor commit unifies both ti
           ps. All reachable.</div>

⏺ Update(index.html)
  ⎿  Added 5 lines, removed 2 lines
      834        </tr>
      835      </table>
      836 
      837 +    <h4 style="margin-top:25px;">The Empty Tree</h4>
      838 +    <p>Every commit points to a tree. In Empty Graph, it's alw
          +ays the same tree: <code>4b825dc642cb6eb9a060e54bf8d69288fbee4
          +904</code> (the empty tree with no files). This is why your wo
          +rking directory has no files from the graph - all data lives i
          +n commit messages.</p>
      839 +
      840      <h4 style="margin-top:25px;">The Core Problem</h4>
      838 -    <p>Git reachability flows: <strong>ref → commit → parent →
          - parent → ...</strong></p>                                    
      839 -    <p>Your node having a parent doesn't make it reachable. So
          -mething must point <em>to</em> your node. Currently, nothing d
          -oes.</p>                                                      
      841 +    <p>Git reachability flows: <strong>ref → commit → parent →
          + parent → ... → empty tree</strong></p>
      842 +    <p>The empty tree is always reachable (it's a well-known c
          +onstant). But your commits pointing TO the empty tree doesn't
          +make THEM reachable. Something must point <em>to</em> your com
          +mits. Currently, nothing does.</p>
      843    </div>
      844 
      845    <script>

⏺ Done! Refresh http://localhost:8765 to see the updated diagrams.

  Now every Git view shows:
  - Commits as circles (yellow = dangling, green = reachable)
  - The EMPTY TREE box that all commits point to (dashed lines)
  - Parent relationships (solid lines)
  - Refs (red boxes)

  The key insight is now clearer:
  - All commits point TO the empty tree (as their tree/content)
  - The empty tree is a constant - always exists
  - But commits pointing to the empty tree doesn't make THEM reachable
  - Reachability flows: ref → commits → parents → ... → empty tree
  - The problem is nothing points TO your commits from a ref

  The intro section now explains the empty tree (4b825dc...) and why it matters
  - it's why there are no files in your working directory.

✻ Worked for 2m 3s

❯ What is the point of the empty tree? 

⏺ Great question. In Git, every commit must point to a tree - that's how Git
  stores the file snapshot. You can't create a commit without one.

  So Empty Graph has a choice:
  Option: Create actual files with node data
  Problem: Files appear in working directory. Clutters your repo. Data
  duplicated
     (files + messages).
  ────────────────────────────────────────
  Option: Create a unique empty tree per commit
  Problem: Wasteful - they're all identical.
  ────────────────────────────────────────
  Option: Use THE empty tree (4b825dc...)
  Problem: All commits share one tree. No files. No overhead.
  The empty tree is Git's well-known "zero files" tree. It always exists
  (implicitly) in every repo.

  By pointing all commits to it:

  1. No files - Your working directory stays clean (or has your normal code)
  2. Invisible storage - The graph exists only in .git/objects/
  3. No duplication - One tree object shared by millions of commits
  4. Data in messages - Commit message = node payload (the natural place for
  metadata)

  It's the trick that makes the graph "empty" - empty of files, full of data.

  Normal Git commit:          Empty Graph commit:
        │                           │
        ▼                           ▼
      tree ─► files              EMPTY TREE (no files)
        │                           │
     (data in files)            (data in commit message)

❯ but isn't it the same aas creating a named ref and committing empty       
  commits to it?                                                            

⏺ Yes, essentially! The ref management is the same. The difference is what's in
  the commits.
  Column 1: Tree
  Regular Git: Your actual files
  Empty Graph: Always empty tree (no files)
  ────────────────────────────────────────
  Column 1: Data location
  Regular Git: Files in tree
  Empty Graph: Commit message
  ────────────────────────────────────────
  Column 1: Commit creation
  Regular Git: git commit (updates branch)
  Empty Graph: git commit-tree (no ref update!)
  ────────────────────────────────────────
  Column 1: Parent
  Regular Git: Automatic (HEAD)
  Empty Graph: Explicit (you specify)
  ────────────────────────────────────────
  Column 1: Structure
  Regular Git: Linear history (mostly)
  Empty Graph: Arbitrary DAG
  The ref/GC problem exists because Empty Graph uses git commit-tree directly
  instead of git commit:

  # Regular Git - automatically updates branch ref
  git commit --allow-empty -m "data"

  # Empty Graph - creates commit, does NOT update any ref
  git commit-tree 4b825dc... -m "data" -p $parent

  So you're right - if Empty Graph just used normal git commit --allow-empty on
  a branch, the ref problem wouldn't exist. But then:

  1. You'd need to manage branch switching for graph branches
  2. The working directory would need to stay empty (tricky if you have real
  code)
  3. Parent relationships would be harder to control (graphs aren't linear)

  The commit-tree plumbing gives precise control over the DAG structure, but
  loses the automatic ref management. That's the tradeoff the fix addresses.

❯ So basically there's no point to using the empty-tree. Using the          
  empty-tree just means your data gets nuked when GC happens??              

⏺ No no - these are two separate things:
  ┌────────────────┬──────────────────────────────┬────────────────────────────┐
  │    Concept     │         What it does         │          Problem?          │
  ├────────────────┼──────────────────────────────┼────────────────────────────┤
  │ Empty tree     │ Stores data in messages      │ No - this is intentional   │
  │                │ instead of files             │ and useful                 │
  ├────────────────┼──────────────────────────────┼────────────────────────────┤
  │ No ref         │ Commits aren't anchored      │ YES - this causes GC       │
  │ management     │                              │ deletion                   │
  └────────────────┴──────────────────────────────┴────────────────────────────┘
  The empty tree is not the problem. You'd have the same GC problem with a full
  tree of files if you used git commit-tree without updating refs.

  # This gets GC'd (empty tree)
  git commit-tree 4b825dc... -m "data"

  # This ALSO gets GC'd (tree with files!)
  git commit-tree abc123... -m "data"   # abc123 = tree with actual files

  # Neither updates a ref, so both are "dangling"

  The empty tree gives you:
  - Invisible storage (no files in working directory)
  - Data lives in commit messages
  - Can coexist with a normal codebase in the same repo

  The GC problem comes from:
  - Using commit-tree (low-level plumbing)
  - Not calling update-ref afterward

  The fix isn't "stop using empty tree" - it's "update a ref after creating
  commits."

  The empty tree is a feature. The missing ref management is the bug.

❯ but to sync up the graph you would need to check out the graph's ref,     
  right? so you're basically just using a branch... which is basically not  
  using the empty tree. What am i not understanding here?                   

⏺ You never checkout the graph's ref. That's the key insight you're missing.

  # You DON'T do this:
  git checkout refs/empty-graph/my-graph  # NOPE, never

  # The ref is just a pointer for:
  # 1. GC protection
  # 2. Knowing where the graph "starts" (for traversal)
  # 3. Push/pull sync

  How you actually interact with the graph:

  // Read a node (uses git cat-file internally)
  const data = await graph.readNode(sha);

  // Create a node (uses git commit-tree internally)
  const sha = await graph.createNode({ message: '...' });

  // Traverse (uses git log internally)
  for await (const node of graph.nodes()) { ... }

  All of this uses Git plumbing commands that don't care about checkout state:
  ┌─────────────────┬──────────────────┬─────────────────┐
  │     Command     │   What it does   │ Needs checkout? │
  ├─────────────────┼──────────────────┼─────────────────┤
  │ git commit-tree │ Create commit    │ No              │
  ├─────────────────┼──────────────────┼─────────────────┤
  │ git cat-file    │ Read object      │ No              │
  ├─────────────────┼──────────────────┼─────────────────┤
  │ git log <ref>   │ Traverse history │ No              │
  ├─────────────────┼──────────────────┼─────────────────┤
  │ git update-ref  │ Move ref pointer │ No              │
  └─────────────────┴──────────────────┴─────────────────┘
  Your working directory stays exactly as it is. You could have a full React app
   checked out on main, and the Empty Graph lives in refs/empty-graph/foo
  completely invisibly. They don't interact.

  The ref is just a bookmark that says "the graph tips are here" - for GC and
  sync purposes. You never checkout it.

❯ is the scenario where a graph has multiple root nodes represented in this 
  "lesson" html file? for example tasks DAG where there are legit multiple  
  starting points. Can you show that example please                         

⏺ Good catch - that's not shown. Let me add a scenario for multiple root nodes
  (independent starting points).

⏺ Update(index.html)
  ⎿  Added 290 lines
       796    </div>
       797 
       798    <!-- ============================================== -->
       799 +  <!-- STEP 6: Multiple Root Nodes                   -->
       800 +  <!-- ============================================== -->
       801 +
       802 +  <div class="step">
       803 +    <div class="step-header">
       804 +      <span class="num">STEP 6</span>
       805 +      Multiple root nodes (independent starting points)
       806 +    </div>
       807 +    <div class="step-code">
       808 +// Task DAG with independent workstreams - no common ancestor
           +<br>
       809 +const taskA = await graph.createNode({ message: '{"task":"Bui
           +ld API"}' });           // Root 1<br>
       810 +const taskB = await graph.createNode({ message: '{"task":"Des
           +ign UI"}' });           // Root 2<br>
       811 +const taskC = await graph.createNode({ message: '{"task":"Wri
           +te docs"}' });          // Root 3<br>
       812 +const taskA1 = await graph.createNode({ message: '{"task":"Au
           +th endpoint"}', parents: [taskA] });<br>
       813 +const taskB1 = await graph.createNode({ message: '{"task":"Lo
           +gin page"}', parents: [taskB] });
       814 +    </div>
       815 +
       816 +    <div class="comparison">
       817 +      <div class="current-side">
       818 +        <div class="side-header">Currently</div>
       819 +        <div class="views">
       820 +          <div class="view">
       821 +            <h5 class="git">Git View</h5>
       822 +            <div class="graph-container" data-dot='
       823 +              digraph {
       824 +                rankdir=TB;
       825 +                bgcolor="transparent";
       826 +                node [fontname="Helvetica", fontsize=9];
       827 +
       828 +                subgraph cluster_1 {
       829 +                  style=dashed; color="#cc0000";
       830 +                  A1 [label="Auth\nendpoint", shape=circle, s
           +tyle=filled, fillcolor="#ffffcc", width=0.5];
       831 +                  A [label="Build\nAPI", shape=circle, style=
           +filled, fillcolor="#ffffcc", width=0.5];
       832 +                  A1 -> A;
       833 +                }
       834 +
       835 +                subgraph cluster_2 {
       836 +                  style=dashed; color="#cc0000";
       837 +                  B1 [label="Login\npage", shape=circle, styl
           +e=filled, fillcolor="#ffffcc", width=0.5];
       838 +                  B [label="Design\nUI", shape=circle, style=
           +filled, fillcolor="#ffffcc", width=0.5];
       839 +                  B1 -> B;
       840 +                }
       841 +
       842 +                subgraph cluster_3 {
       843 +                  style=dashed; color="#cc0000";
       844 +                  C [label="Write\ndocs", shape=circle, style
           +=filled, fillcolor="#ffffcc", width=0.5];
       845 +                }
       846 +
       847 +                empty [label="EMPTY TREE", shape=box, style=f
           +illed, fillcolor="#f0f0f0", fontsize=8];
       848 +                A -> empty [style=dashed, color="#ccc"];
       849 +                B -> empty [style=dashed, color="#ccc"];
       850 +                C -> empty [style=dashed, color="#ccc"];
       851 +
       852 +                warn [label="3 DISCONNECTED\nDANGLING SUBGRAP
           +HS!", shape=plaintext, fontcolor="#cc0000", fontsize=9];
       853 +              }
       854 +            '></div>
       855 +            <div class="danger">Three separate subgraphs, all
           + dangling. No ref points to any of them.</div>
       856 +          </div>
       857 +          <div class="view">
       858 +            <h5 class="graph">Empty Graph View</h5>
       859 +            <div class="graph-container" data-dot='
       860 +              digraph {
       861 +                rankdir=TB;
       862 +                bgcolor="transparent";
       863 +                node [fontname="Helvetica", fontsize=9, shape
           +=box, style="rounded,filled", fillcolor="white"];
       864 +
       865 +                A1 [label="Auth endpoint"];
       866 +                A [label="Build API"];
       867 +                B1 [label="Login page"];
       868 +                B [label="Design UI"];
       869 +                C [label="Write docs"];
       870 +
       871 +                A1 -> A;
       872 +                B1 -> B;
       873 +              }
       874 +            '></div>
       875 +            <p style="font-size:10px;color:#666;text-align:ce
           +nter;">Three independent workstreams.<br/>Looks fine, but all
           + will be deleted!</p>
       876 +          </div>
       877 +        </div>
       878 +      </div>
       879 +
       880 +      <div class="fixed-side">
       881 +        <div class="side-header">With Fix</div>
       882 +        <div class="views">
       883 +          <div class="view">
       884 +            <h5 class="git">Git View</h5>
       885 +            <div class="graph-container" data-dot='
       886 +              digraph {
       887 +                rankdir=TB;
       888 +                bgcolor="transparent";
       889 +                node [fontname="Helvetica", fontsize=9];
       890 +
       891 +                ref [label="ref", shape=box, style=filled, fi
           +llcolor="#ffe0e0"];
       892 +                anchor [label="ANCHOR", shape=circle, style=f
           +illed, fillcolor="#cce5ff", width=0.6];
       893 +
       894 +                A1 [label="Auth\nendpoint", shape=circle, sty
           +le=filled, fillcolor="#ccffcc", width=0.5];
       895 +                A [label="Build\nAPI", shape=circle, style=fi
           +lled, fillcolor="#ccffcc", width=0.5];
       896 +                B1 [label="Login\npage", shape=circle, style=
           +filled, fillcolor="#ccffcc", width=0.5];
       897 +                B [label="Design\nUI", shape=circle, style=fi
           +lled, fillcolor="#ccffcc", width=0.5];
       898 +                C [label="Write\ndocs", shape=circle, style=f
           +illed, fillcolor="#ccffcc", width=0.5];
       899 +
       900 +                empty [label="EMPTY TREE", shape=box, style=f
           +illed, fillcolor="#f0f0f0", fontsize=8];
       901 +
       902 +                ref -> anchor [color="#009900", penwidth=2];
       903 +                anchor -> A1 [color="#009900"];
       904 +                anchor -> B1 [color="#009900"];
       905 +                anchor -> C [color="#009900"];
       906 +                A1 -> A;
       907 +                B1 -> B;
       908 +
       909 +                A -> empty [style=dashed, color="#ccc"];
       910 +                B -> empty [style=dashed, color="#ccc"];
       911 +                C -> empty [style=dashed, color="#ccc"];
       912 +              }
       913 +            '></div>
       914 +            <div class="success">Anchor has 3 parents (all ti
           +ps). All subgraphs reachable!</div>
       915 +          </div>
       916 +          <div class="view">
       917 +            <h5 class="graph">Empty Graph View</h5>
       918 +            <div class="graph-container" data-dot='
       919 +              digraph {
       920 +                rankdir=TB;
       921 +                bgcolor="transparent";
       922 +                node [fontname="Helvetica", fontsize=9, shape
           +=box, style="rounded,filled", fillcolor="#ccffcc"];
       923 +
       924 +                A1 [label="Auth endpoint"];
       925 +                A [label="Build API"];
       926 +                B1 [label="Login page"];
       927 +                B [label="Design UI"];
       928 +                C [label="Write docs"];
       929 +
       930 +                A1 -> A;
       931 +                B1 -> B;
       932 +              }
       933 +            '></div>
       934 +            <p style="font-size:10px;color:#009900;text-align
           +:center;">Same view - anchor is hidden.<br/>All three workstr
           +eams persisted!</p>
       935 +          </div>
       936 +        </div>
       937 +      </div>
       938 +    </div>
       939 +
       940 +    <div class="explanation">
       941 +      <div class="current">
       942 +        <h5>Current Behavior</h5>
       943 +        <p>Three independent subgraphs with three root nodes.
           + None are connected to each other. Since no ref points to any
           + of them, ALL commits in ALL subgraphs are garbage. Your enti
           +re task system vanishes on GC.</p>
       944 +      </div>
       945 +      <div class="fixed">
       946 +        <h5>Fixed Behavior</h5>
       947 +        <p>The anchor commit has <strong>all tips</strong> as
           + parents (A1, B1, C). Reachability: ref → anchor → tips → roo
           +ts. Even though the subgraphs are disconnected from each othe
           +r, they're all connected to the anchor. One ref protects ever
           +ything.</p>
       948 +      </div>
       949 +    </div>
       950 +  </div>
       951 +
       952 +  <!-- ============================================== -->
       953 +  <!-- STEP 7: Multiple roots later merge            -->
       954 +  <!-- ============================================== -->
       955 +
       956 +  <div class="step">
       957 +    <div class="step-header">
       958 +      <span class="num">STEP 7</span>
       959 +      Independent roots that later merge
       960 +    </div>
       961 +    <div class="step-code">
       962 +// Later, the workstreams converge for integration<br>
       963 +const integration = await graph.createNode({<br>
       964 +&nbsp;&nbsp;message: '{"task":"Integration testing"}',<br>
       965 +&nbsp;&nbsp;parents: [taskA1, taskB1, taskC]  // Merges all t
           +hree workstreams!<br>
       966 +});
       967 +    </div>
       968 +
       969 +    <div class="comparison">
       970 +      <div class="current-side">
       971 +        <div class="side-header">Currently</div>
       972 +        <div class="views">
       973 +          <div class="view">
       974 +            <h5 class="git">Git View</h5>
       975 +            <div class="graph-container" data-dot='
       976 +              digraph {
       977 +                rankdir=TB;
       978 +                bgcolor="transparent";
       979 +                node [fontname="Helvetica", fontsize=9];
       980 +
       981 +                integration [label="Integration", shape=circl
           +e, style=filled, fillcolor="#ffffcc", width=0.6];
       982 +                A1 [label="Auth", shape=circle, style=filled,
           + fillcolor="#ffffcc", width=0.45];
       983 +                A [label="API", shape=circle, style=filled, f
           +illcolor="#ffffcc", width=0.45];
       984 +                B1 [label="Login", shape=circle, style=filled
           +, fillcolor="#ffffcc", width=0.45];
       985 +                B [label="UI", shape=circle, style=filled, fi
           +llcolor="#ffffcc", width=0.45];
       986 +                C [label="Docs", shape=circle, style=filled, 
           +fillcolor="#ffffcc", width=0.45];
       987 +
       988 +                integration -> A1 -> A;
       989 +                integration -> B1 -> B;
       990 +                integration -> C;
       991 +
       992 +                warn [label="ALL STILL\nDANGLING!", shape=pla
           +intext, fontcolor="#cc0000", fontsize=9];
       993 +              }
       994 +            '></div>
       995 +            <div class="danger">Now connected in Git too - bu
           +t still no ref. Still all garbage.</div>
       996 +          </div>
       997 +          <div class="view">
       998 +            <h5 class="graph">Empty Graph View</h5>
       999 +            <div class="graph-container" data-dot='
      1000 +              digraph {
      1001 +                rankdir=TB;
      1002 +                bgcolor="transparent";
      1003 +                node [fontname="Helvetica", fontsize=9, shape
           +=box, style="rounded,filled", fillcolor="white"];
      1004 +
      1005 +                integration [label="Integration\ntesting", fi
           +llcolor="#ffe6cc"];
      1006 +                A1 [label="Auth endpoint"];
      1007 +                A [label="Build API"];
      1008 +                B1 [label="Login page"];
      1009 +                B [label="Design UI"];
      1010 +                C [label="Write docs"];
      1011 +
      1012 +                integration -> A1 -> A;
      1013 +                integration -> B1 -> B;
      1014 +                integration -> C;
      1015 +              }
      1016 +            '></div>
      1017 +            <p style="font-size:10px;text-align:center;">Beau
           +tiful merge node!<br/>Still gonna be deleted.</p>
      1018 +          </div>
      1019 +        </div>
      1020 +      </div>
      1021 +
      1022 +      <div class="fixed-side">
      1023 +        <div class="side-header">With Fix</div>
      1024 +        <div class="views">
      1025 +          <div class="view">
      1026 +            <h5 class="git">Git View</h5>
      1027 +            <div class="graph-container" data-dot='
      1028 +              digraph {
      1029 +                rankdir=TB;
      1030 +                bgcolor="transparent";
      1031 +                node [fontname="Helvetica", fontsize=9];
      1032 +
      1033 +                ref [label="ref", shape=box, style=filled, fi
           +llcolor="#ffe0e0"];
      1034 +
      1035 +                integration [label="Integration", shape=circl
           +e, style=filled, fillcolor="#ccffcc", width=0.6];
      1036 +                A1 [label="Auth", shape=circle, style=filled,
           + fillcolor="#ccffcc", width=0.45];
      1037 +                A [label="API", shape=circle, style=filled, f
           +illcolor="#ccffcc", width=0.45];
      1038 +                B1 [label="Login", shape=circle, style=filled
           +, fillcolor="#ccffcc", width=0.45];
      1039 +                B [label="UI", shape=circle, style=filled, fi
           +llcolor="#ccffcc", width=0.45];
      1040 +                C [label="Docs", shape=circle, style=filled, 
           +fillcolor="#ccffcc", width=0.45];
      1041 +
      1042 +                ref -> integration [color="#009900", penwidth
           +=2];
      1043 +                integration -> A1 -> A;
      1044 +                integration -> B1 -> B;
      1045 +                integration -> C;
      1046 +              }
      1047 +            '></div>
      1048 +            <div class="success">Single tip now - ref points
           +directly to it. No anchor needed!</div>
      1049 +          </div>
      1050 +          <div class="view">
      1051 +            <h5 class="graph">Empty Graph View</h5>
      1052 +            <div class="graph-container" data-dot='
      1053 +              digraph {
      1054 +                rankdir=TB;
      1055 +                bgcolor="transparent";
      1056 +                node [fontname="Helvetica", fontsize=9, shape
           +=box, style="rounded,filled", fillcolor="#ccffcc"];
      1057 +
      1058 +                integration [label="Integration\ntesting", fi
           +llcolor="#c8e6c9"];
      1059 +                A1 [label="Auth endpoint"];
      1060 +                A [label="Build API"];
      1061 +                B1 [label="Login page"];
      1062 +                B [label="Design UI"];
      1063 +                C [label="Write docs"];
      1064 +
      1065 +                integration -> A1 -> A;
      1066 +                integration -> B1 -> B;
      1067 +                integration -> C;
      1068 +              }
      1069 +            '></div>
      1070 +            <p style="font-size:10px;color:#009900;text-align
           +:center;">Same beautiful merge.<br/>Now it's permanent!</p>
      1071 +          </div>
      1072 +        </div>
      1073 +      </div>
      1074 +    </div>
      1075 +
      1076 +    <div class="explanation">
      1077 +      <div class="current">
      1078 +        <h5>Current Behavior</h5>
      1079 +        <p>The "Integration" node merges all three workstream
           +s by having them as parents. In Git, this now forms a connect
           +ed DAG. But it's STILL dangling - no ref points to Integratio
           +n, so the entire graph is garbage.</p>
      1080 +      </div>
      1081 +      <div class="fixed">
      1082 +        <h5>Fixed Behavior</h5>
      1083 +        <p>Now there's only one tip (Integration), so the ref
           + can point directly to it - no anchor commit needed! All thre
           +e root nodes are reachable via: ref → Integration → (A1, B1,
           +C) → (A, B). The merge node naturally unifies everything.</p>
      1084 +      </div>
      1085 +    </div>
      1086 +  </div>
      1087 +
      1088 +  <!-- ============================================== -->
      1089    <!-- SUMMARY                                       -->
      1090    <!-- ============================================== -->
      1091 

⏺ Now let me update the summary to include the multiple roots case.

⏺ Update(index.html)
  ⎿  Added 10 lines
      1113          <td>Anchor commit unifies them</td>
      1114        </tr>
      1115        <tr>
      1116 +        <td><strong>Multiple roots</strong></td>
      1117 +        <td>Disconnected dangling subgraphs</td>
      1118 +        <td>Anchor reaches all tips → all roots reachable</td
           +>
      1119 +      </tr>
      1120 +      <tr>
      1121 +        <td><strong>Roots that merge</strong></td>
      1122 +        <td>Still dangling (no ref)</td>
      1123 +        <td>Merge node becomes single tip → ref points to it<
           +/td>
      1124 +      </tr>
      1125 +      <tr>
      1126          <td><strong>After GC</strong></td>
      1127          <td>DATA LOSS</td>
      1128          <td>Data intact</td>

⏺ Done! Refresh http://localhost:8765 to see the new scenarios.

  Added two new steps:

  Step 6: Multiple root nodes
  - Task DAG with 3 independent workstreams (Build API, Design UI, Write docs)
  - No common ancestor - truly disconnected subgraphs
  - Current: 3 separate dangling subgraphs → all garbage
  - Fixed: Anchor has all tips as parents → all roots reachable

  Step 7: Independent roots that later merge
  - An "Integration testing" node merges all 3 workstreams
  - Current: Beautiful DAG structure, still dangling, still garbage
  - Fixed: Single tip now → ref points directly to merge node → no anchor needed

  Key insight shown: When disconnected subgraphs merge, the merge node becomes 
  the single tip. The anchor is only needed when you have multiple tips that
  haven't merged yet.

  Before merge:          After merge:
     A1    B1    C         Integration
     ↓     ↓              ↙    ↓    ↘
     A     B            A1    B1    C
                         ↓     ↓
  3 tips = need anchor   A     B

                        1 tip = ref points directly

✻ Brewed for 1m 18s

❯ i just don't get it. why is this different than jus t making a new ref    
  that allows empty commits?                                                
  ⎿  [Image #1]

⏺ You're right - it IS essentially the same thing.

  The "fix" is literally just: update a ref after creating commits.

  That's exactly what git commit on a branch does automatically. The only
  differences are:
  ┌─────────────────────────────┬──────────────────────────────────┐
  │       Regular branch        │           Empty Graph            │
  ├─────────────────────────────┼──────────────────────────────────┤
  │ git commit --allow-empty    │ git commit-tree + git update-ref │
  ├─────────────────────────────┼──────────────────────────────────┤
  │ Linear history (one parent) │ Arbitrary DAG (multiple parents) │
  ├─────────────────────────────┼──────────────────────────────────┤
  │ Auto-updates branch ref     │ Must manually update ref         │
  ├─────────────────────────────┼──────────────────────────────────┤
  │ Tree = your files           │ Tree = empty tree (no files)     │
  └─────────────────────────────┴──────────────────────────────────┘
  Empty Graph uses plumbing commands (commit-tree) because it needs precise
  control over parent relationships (DAGs, not linear history). But plumbing
  commands don't update refs - that's a porcelain feature.

  The "fix" adds back the ref-updating that porcelain commands (git commit) do
  automatically.

  So yes: conceptually, it's "just a branch with empty commits." The empty tree
  is just an implementation detail meaning "no files in the tree." The fancy
  diagrams are overcomplicating something simple:

  Current:  git commit-tree ... (creates commit, no ref update)
  Fixed:    git commit-tree ... && git update-ref ... (same as what git commit
  does)

  Does that make more sense?

❯ If you were to describe the problem, the solution, and my                 
  misunderstanding to another person, how would you do that?                

⏺ The Problem

  Empty Graph stores data in Git commits (with data in commit messages, pointing
   to the empty tree so there are no files). It uses git commit-tree to create
  commits with arbitrary parent relationships (DAGs, not linear history).

  The bug: git commit-tree creates commits but doesn't update any ref. Without a
   ref pointing to them, Git considers these commits "garbage" and will delete
  them during GC.

  The Solution

  After creating commits, update a ref to point to the tip(s). That's it. One
  extra git update-ref call.

  If there are multiple tips (branches in the graph that haven't merged), create
   an "anchor" commit that has all tips as parents, and point the ref at that.

  The Misunderstanding

  James kept asking "isn't this just a branch with empty commits?" and he's 
  completely right.

  The confusion came from overcomplicating it:
  - Fancy diagrams showing "empty tree" as if it's special
  - Making "anchor commits" sound like a novel concept
  - Talking about "Git view vs Graph view" as if they're fundamentally different

  The simple truth: Empty Graph is just commits on a ref. The only differences
  from a normal branch are:
  1. Uses commit-tree (for DAG control) instead of git commit (linear)
  2. Points to empty tree (no files) instead of real files
  3. Forgot to update the ref (the bug)

  The "empty tree" isn't magic - it just means "no files." The "anchor commit"
  is just a merge commit. The "fix" is just "update the ref like git commit does
   automatically."

  James's instinct was correct the whole time. The explanation was making simple
   things sound complicated.

❯ I am still confused as hell about how you would update your view of the   
  empty graph. and how graphs with more than one root node work with all of 
  this                                                                      

⏺ Let me try to explain these two things as simply as possible.

  ---
  1. How do you "view" or "read" the graph?

  You never checkout. You just traverse commits starting from the ref.

  # The ref tells you where to start
  git rev-parse refs/empty-graph/my-graph
  # Returns: abc123 (the tip commit, or anchor)

  # Traverse backward through parents
  git log abc123 --format="%H %P %s"
  # Shows: each commit's SHA, its parents, and its message (your data)

  In code:
  // Start from ref, walk backward through parents
  for await (const node of graph.nodes()) {
    console.log(node.message);  // Your data
    console.log(node.parents);  // Links to other nodes
  }

  There's no "checkout". You're just reading commit objects from .git/objects/ 
  and following parent pointers.

  ---
  2. Multiple root nodes

  Here's where I think the confusion is. Let me draw it differently.

  Three independent roots (no parents):
  A (root - no parents)
  B (root - no parents)
  C (root - no parents)

  Problem: A ref can only point to ONE commit. How do you make all three
  reachable?

  Solution: Create a commit that has all three as parents:

          ANCHOR (ref points here)
         /   |   \
        v    v    v
        A    B    C

  Now when you traverse:
  git log ANCHOR
  Git follows ALL parent pointers. It visits:
  1. ANCHOR
  2. A (parent of ANCHOR)
  3. B (parent of ANCHOR)
  4. C (parent of ANCHOR)

  Your app filters out ANCHOR (it's just infrastructure). You see A, B, C as
  three root nodes.

  ---
  The key insight you might be missing:

  git log doesn't just follow one path - it follows ALL parents.

         ANCHOR
        /   |   \
       v    v    v
       A    B    C
       |         |
       v         v
       D         E

  git log ANCHOR visits: ANCHOR, A, B, C, D, E (order may vary, but ALL are
  visited).

  So "multiple roots" just means "the anchor has multiple parents, and git log
  visits them all."

  ---
  Does that help? Or is there a specific part that's still confusing?