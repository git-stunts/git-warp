<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 400">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <path d="M0,0 L0,6 L9,3 z" fill="#666"/>
    </marker>
    <marker id="arrow-purple" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <path d="M0,0 L0,6 L9,3 z" fill="#9c27b0"/>
    </marker>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.3"/>
    </filter>
    <linearGradient id="wormhole-grad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" stop-color="#9c27b0"/>
      <stop offset="50%" stop-color="#ce93d8"/>
      <stop offset="100%" stop-color="#9c27b0"/>
    </linearGradient>
    <filter id="glow-purple">
      <feGaussianBlur stdDeviation="2" result="blur"/>
      <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
    </filter>
  </defs>

  <!-- Title -->
  <text x="450" y="25" text-anchor="middle" font-family="system-ui, sans-serif" font-size="16" font-weight="bold" fill="#333">Compression Animation Storyboard</text>

  <!-- Panel 1: Full worldline visible -->
  <g transform="translate(10, 45)">
    <rect width="210" height="160" rx="8" fill="#fff" stroke="#ddd" stroke-width="2" filter="url(#shadow)"/>
    <rect width="210" height="22" rx="8" fill="#f5f5f5" stroke="#ddd" stroke-width="1"/>
    <text x="105" y="15" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#666">Frame 1: Full Worldline</text>

    <!-- Worldline states -->
    <circle cx="30" cy="80" r="14" fill="#e3f2fd" stroke="#2196f3" stroke-width="2"/>
    <text x="30" y="84" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#1565c0">U0</text>

    <circle cx="60" cy="80" r="10" fill="#e3f2fd" stroke="#2196f3" stroke-width="1.5"/>
    <text x="60" y="83" text-anchor="middle" font-family="system-ui, sans-serif" font-size="7" fill="#1565c0">U1</text>

    <circle cx="90" cy="80" r="10" fill="#e3f2fd" stroke="#2196f3" stroke-width="1.5"/>
    <text x="90" y="83" text-anchor="middle" font-family="system-ui, sans-serif" font-size="7" fill="#1565c0">U2</text>

    <circle cx="120" cy="80" r="14" fill="#e3f2fd" stroke="#2196f3" stroke-width="2"/>
    <text x="120" y="84" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#1565c0">U3</text>

    <circle cx="150" cy="80" r="10" fill="#e3f2fd" stroke="#2196f3" stroke-width="1.5"/>
    <text x="150" y="83" text-anchor="middle" font-family="system-ui, sans-serif" font-size="7" fill="#1565c0">U4</text>

    <circle cx="180" cy="80" r="14" fill="#e3f2fd" stroke="#2196f3" stroke-width="2"/>
    <text x="180" y="84" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#1565c0">U5</text>

    <!-- Tick arrows -->
    <path d="M44,80 L48,80" stroke="#666" stroke-width="1" marker-end="url(#arrow)"/>
    <path d="M70,80 L78,80" stroke="#666" stroke-width="1" marker-end="url(#arrow)"/>
    <path d="M100,80 L104,80" stroke="#666" stroke-width="1" marker-end="url(#arrow)"/>
    <path d="M134,80 L138,80" stroke="#666" stroke-width="1" marker-end="url(#arrow)"/>
    <path d="M160,80 L164,80" stroke="#666" stroke-width="1" marker-end="url(#arrow)"/>

    <!-- Tick labels -->
    <text x="45" y="72" font-family="system-ui, sans-serif" font-size="7" fill="#999">m0</text>
    <text x="75" y="72" font-family="system-ui, sans-serif" font-size="7" fill="#999">m1</text>
    <text x="101" y="72" font-family="system-ui, sans-serif" font-size="7" fill="#999">m2</text>
    <text x="135" y="72" font-family="system-ui, sans-serif" font-size="7" fill="#999">m3</text>
    <text x="161" y="72" font-family="system-ui, sans-serif" font-size="7" fill="#999">m4</text>

    <!-- Caption -->
    <text x="105" y="120" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#333">Complete worldline with</text>
    <text x="105" y="132" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#333">all states visible</text>
    <text x="105" y="150" text-anchor="middle" font-family="system-ui, sans-serif" font-size="8" fill="#999">(6 states, 5 tick patches)</text>
  </g>

  <!-- Arrow 1-2 -->
  <path d="M225,125 L230,125" stroke="#666" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Panel 2: Selection highlight -->
  <g transform="translate(235, 45)">
    <rect width="210" height="160" rx="8" fill="#fff" stroke="#ddd" stroke-width="2" filter="url(#shadow)"/>
    <rect width="210" height="22" rx="8" fill="#fff3e0" stroke="#ff9800" stroke-width="1"/>
    <text x="105" y="15" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#e65100">Frame 2: Selection</text>

    <!-- Highlight box for U0-U3 -->
    <rect x="18" y="55" width="115" height="50" rx="6" fill="#f3e5f5" stroke="#9c27b0" stroke-width="2" stroke-dasharray="4,2"/>

    <!-- Worldline states -->
    <circle cx="30" cy="80" r="14" fill="#ce93d8" stroke="#9c27b0" stroke-width="2"/>
    <text x="30" y="84" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#4a148c">U0</text>

    <circle cx="60" cy="80" r="10" fill="#e1bee7" stroke="#9c27b0" stroke-width="1.5"/>
    <text x="60" y="83" text-anchor="middle" font-family="system-ui, sans-serif" font-size="7" fill="#4a148c">U1</text>

    <circle cx="90" cy="80" r="10" fill="#e1bee7" stroke="#9c27b0" stroke-width="1.5"/>
    <text x="90" y="83" text-anchor="middle" font-family="system-ui, sans-serif" font-size="7" fill="#4a148c">U2</text>

    <circle cx="120" cy="80" r="14" fill="#ce93d8" stroke="#9c27b0" stroke-width="2"/>
    <text x="120" y="84" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#4a148c">U3</text>

    <circle cx="150" cy="80" r="10" fill="#e3f2fd" stroke="#2196f3" stroke-width="1.5"/>
    <text x="150" y="83" text-anchor="middle" font-family="system-ui, sans-serif" font-size="7" fill="#1565c0">U4</text>

    <circle cx="180" cy="80" r="14" fill="#e3f2fd" stroke="#2196f3" stroke-width="2"/>
    <text x="180" y="84" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#1565c0">U5</text>

    <!-- Tick arrows -->
    <path d="M44,80 L48,80" stroke="#9c27b0" stroke-width="1.5" marker-end="url(#arrow-purple)"/>
    <path d="M70,80 L78,80" stroke="#9c27b0" stroke-width="1.5" marker-end="url(#arrow-purple)"/>
    <path d="M100,80 L104,80" stroke="#9c27b0" stroke-width="1.5" marker-end="url(#arrow-purple)"/>
    <path d="M134,80 L138,80" stroke="#666" stroke-width="1" marker-end="url(#arrow)"/>
    <path d="M160,80 L164,80" stroke="#666" stroke-width="1" marker-end="url(#arrow)"/>

    <!-- Caption -->
    <text x="105" y="120" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#333">U0 to U3 selected for</text>
    <text x="105" y="132" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#333">compression (3 ticks)</text>
    <text x="105" y="150" text-anchor="middle" font-family="system-ui, sans-serif" font-size="8" fill="#9c27b0">Drag or Shift+Click</text>
  </g>

  <!-- Arrow 2-3 -->
  <path d="M450,125 L455,125" stroke="#666" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Panel 3: Collapse animation -->
  <g transform="translate(460, 45)">
    <rect width="210" height="160" rx="8" fill="#fff" stroke="#ddd" stroke-width="2" filter="url(#shadow)"/>
    <rect width="210" height="22" rx="8" fill="#f3e5f5" stroke="#9c27b0" stroke-width="1"/>
    <text x="105" y="15" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#7b1fa2">Frame 3: Collapsing</text>

    <!-- Animating collapse -->
    <circle cx="30" cy="80" r="14" fill="#ce93d8" stroke="#9c27b0" stroke-width="2"/>
    <text x="30" y="84" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#4a148c">U0</text>

    <!-- Fading intermediate states with motion blur effect -->
    <circle cx="55" cy="80" r="6" fill="#e1bee7" stroke="#9c27b0" stroke-width="1" opacity="0.5"/>
    <circle cx="70" cy="80" r="4" fill="#e1bee7" stroke="#9c27b0" stroke-width="0.5" opacity="0.3"/>
    <circle cx="82" cy="80" r="3" fill="#e1bee7" stroke="#9c27b0" stroke-width="0.5" opacity="0.2"/>

    <circle cx="100" cy="80" r="14" fill="#ce93d8" stroke="#9c27b0" stroke-width="2"/>
    <text x="100" y="84" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#4a148c">U3</text>

    <!-- Curved collapsing path indicator -->
    <path d="M44,75 Q65,55 85,75" stroke="#9c27b0" stroke-width="2" fill="none" stroke-dasharray="3,2"/>

    <!-- Unchanged remainder -->
    <circle cx="145" cy="80" r="10" fill="#e3f2fd" stroke="#2196f3" stroke-width="1.5"/>
    <text x="145" y="83" text-anchor="middle" font-family="system-ui, sans-serif" font-size="7" fill="#1565c0">U4</text>

    <circle cx="180" cy="80" r="14" fill="#e3f2fd" stroke="#2196f3" stroke-width="2"/>
    <text x="180" y="84" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#1565c0">U5</text>

    <path d="M114,80 L133,80" stroke="#666" stroke-width="1" marker-end="url(#arrow)"/>
    <path d="M155,80 L164,80" stroke="#666" stroke-width="1" marker-end="url(#arrow)"/>

    <!-- Motion lines -->
    <line x1="50" y1="90" x2="60" y2="90" stroke="#9c27b0" stroke-width="1" opacity="0.4"/>
    <line x1="55" y1="93" x2="65" y2="93" stroke="#9c27b0" stroke-width="1" opacity="0.3"/>
    <line x1="80" y1="90" x2="90" y2="90" stroke="#9c27b0" stroke-width="1" opacity="0.4"/>
    <line x1="75" y1="93" x2="85" y2="93" stroke="#9c27b0" stroke-width="1" opacity="0.3"/>

    <!-- Caption -->
    <text x="105" y="120" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#333">Interior states collapse</text>
    <text x="105" y="132" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#333">toward endpoints</text>
    <text x="105" y="150" text-anchor="middle" font-family="system-ui, sans-serif" font-size="8" fill="#999">Spring physics animation</text>
  </g>

  <!-- Arrow 3-4 -->
  <path d="M675,125 L680,125" stroke="#666" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Panel 4: Wormhole formed -->
  <g transform="translate(685, 45)">
    <rect width="210" height="160" rx="8" fill="#fff" stroke="#4caf50" stroke-width="3" filter="url(#shadow)"/>
    <rect width="210" height="22" rx="8" fill="#e8f5e9" stroke="#4caf50" stroke-width="1"/>
    <text x="105" y="15" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#2e7d32">Frame 4: Complete</text>

    <!-- Endpoint states -->
    <circle cx="30" cy="80" r="14" fill="#e3f2fd" stroke="#2196f3" stroke-width="2"/>
    <text x="30" y="84" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#1565c0">U0</text>

    <circle cx="100" cy="80" r="14" fill="#e3f2fd" stroke="#2196f3" stroke-width="2"/>
    <text x="100" y="84" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#1565c0">U3</text>

    <!-- Wormhole curved edge -->
    <path d="M44,75 Q65,45 85,75" stroke="url(#wormhole-grad)" stroke-width="4" fill="none" filter="url(#glow-purple)"/>

    <!-- Wormhole label -->
    <rect x="48" y="42" width="35" height="14" rx="3" fill="#9c27b0"/>
    <text x="65" y="52" text-anchor="middle" font-family="system-ui, sans-serif" font-size="8" fill="white" font-weight="bold">W1</text>

    <!-- Remainder of worldline -->
    <circle cx="145" cy="80" r="10" fill="#e3f2fd" stroke="#2196f3" stroke-width="1.5"/>
    <text x="145" y="83" text-anchor="middle" font-family="system-ui, sans-serif" font-size="7" fill="#1565c0">U4</text>

    <circle cx="180" cy="80" r="14" fill="#e3f2fd" stroke="#2196f3" stroke-width="2"/>
    <text x="180" y="84" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#1565c0">U5</text>

    <path d="M114,80 L133,80" stroke="#666" stroke-width="1" marker-end="url(#arrow)"/>
    <path d="M155,80 L164,80" stroke="#666" stroke-width="1" marker-end="url(#arrow)"/>

    <!-- Caption -->
    <text x="105" y="120" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#333">Wormhole W1 formed</text>
    <text x="105" y="132" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#333">carrying sub-payload P0:3</text>
    <text x="105" y="150" text-anchor="middle" font-family="system-ui, sans-serif" font-size="8" fill="#9c27b0">Click to expand</text>
  </g>

  <!-- Legend -->
  <g transform="translate(10, 220)">
    <rect width="880" height="80" rx="8" fill="#fafafa" stroke="#e0e0e0" stroke-width="1"/>
    <text x="20" y="20" font-family="system-ui, sans-serif" font-size="11" font-weight="bold" fill="#333">Legend</text>

    <!-- State -->
    <circle cx="40" cy="45" r="10" fill="#e3f2fd" stroke="#2196f3" stroke-width="2"/>
    <text x="58" y="49" font-family="system-ui, sans-serif" font-size="10" fill="#333">State (U)</text>

    <!-- Tick arrow -->
    <path d="M130,45 L160,45" stroke="#666" stroke-width="2" marker-end="url(#arrow)"/>
    <text x="175" y="49" font-family="system-ui, sans-serif" font-size="10" fill="#333">Tick patch (mu)</text>

    <!-- Selected -->
    <circle cx="285" cy="45" r="10" fill="#ce93d8" stroke="#9c27b0" stroke-width="2"/>
    <text x="303" y="49" font-family="system-ui, sans-serif" font-size="10" fill="#333">Selected state</text>

    <!-- Wormhole edge -->
    <path d="M410,40 Q430,25 450,40" stroke="#9c27b0" stroke-width="3" fill="none"/>
    <text x="465" y="44" font-family="system-ui, sans-serif" font-size="10" fill="#333">Wormhole edge</text>

    <!-- Animation indicator -->
    <line x1="580" y1="45" x2="610" y2="45" stroke="#9c27b0" stroke-width="2" stroke-dasharray="4,2"/>
    <text x="625" y="49" font-family="system-ui, sans-serif" font-size="10" fill="#333">Collapsing motion</text>

    <!-- Payload info -->
    <rect x="750" y="35" width="50" height="18" rx="3" fill="#f3e5f5" stroke="#9c27b0"/>
    <text x="775" y="48" text-anchor="middle" font-family="system-ui, sans-serif" font-size="8" fill="#7b1fa2">P0:3</text>
    <text x="815" y="49" font-family="system-ui, sans-serif" font-size="10" fill="#333">Sub-payload</text>
  </g>

  <!-- Compression metrics -->
  <g transform="translate(10, 310)">
    <rect width="880" height="80" rx="8" fill="#e8f5e9" stroke="#4caf50" stroke-width="1"/>
    <text x="20" y="22" font-family="system-ui, sans-serif" font-size="11" font-weight="bold" fill="#2e7d32">Compression Result</text>

    <text x="20" y="45" font-family="system-ui, sans-serif" font-size="10" fill="#333">Before: 6 states, 5 tick patches</text>
    <text x="20" y="62" font-family="system-ui, sans-serif" font-size="10" fill="#333">After: 4 states, 2 ticks + 1 wormhole (carrying 3 compressed ticks)</text>

    <text x="450" y="45" font-family="system-ui, sans-serif" font-size="10" fill="#333">Sub-payload P0:3 = (mu0, mu1, mu2)</text>
    <text x="450" y="62" font-family="system-ui, sans-serif" font-size="10" fill="#333">Boundary hashes preserved for verification</text>

    <rect x="750" y="30" width="120" height="40" rx="6" fill="#c8e6c9" stroke="#4caf50"/>
    <text x="810" y="52" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#2e7d32" font-weight="bold">BTR Created</text>
    <text x="810" y="64" text-anchor="middle" font-family="system-ui, sans-serif" font-size="8" fill="#388e3c">h_in / h_out</text>
  </g>
</svg>
