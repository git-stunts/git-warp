<svg viewBox="0 0 1000 700" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="dep-arrow" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#f59e0b"/>
    </marker>
    <filter id="cone-glow">
      <feGaussianBlur stdDeviation="5" result="coloredBlur"/>
      <feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="1000" height="700" fill="#0f172a"/>

  <!-- Title -->
  <text x="500" y="35" fill="#e2e8f0" font-family="monospace" font-size="18" text-anchor="middle">Causal Cone Slicer</text>
  <text x="500" y="55" fill="#64748b" font-family="monospace" font-size="12" text-anchor="middle">Derivation Graph D(v) for target value v = "total_count"</text>

  <!-- Full Provenance Graph (faded background) -->
  <rect x="30" y="80" width="600" height="400" rx="8" fill="#1e293b" stroke="#334155"/>
  <text x="50" y="105" fill="#64748b" font-family="monospace" font-size="12">PROVENANCE GRAPH ‚Ñô</text>

  <!-- Values not in cone (faded) -->
  <circle cx="100" cy="180" r="20" fill="#1e293b" stroke="#334155" stroke-width="1" opacity="0.4"/>
  <text x="100" y="185" fill="#475569" font-family="monospace" font-size="9" text-anchor="middle">v‚ÇÅ</text>

  <circle cx="200" cy="150" r="20" fill="#1e293b" stroke="#334155" stroke-width="1" opacity="0.4"/>
  <text x="200" y="155" fill="#475569" font-family="monospace" font-size="9" text-anchor="middle">v‚ÇÇ</text>

  <circle cx="150" cy="280" r="20" fill="#1e293b" stroke="#334155" stroke-width="1" opacity="0.4"/>
  <text x="150" y="285" fill="#475569" font-family="monospace" font-size="9" text-anchor="middle">v‚ÇÖ</text>

  <!-- Edges not in cone (faded) -->
  <line x1="120" y1="175" x2="180" y2="160" stroke="#334155" stroke-width="1" opacity="0.3"/>
  <line x1="140" y1="270" x2="180" y2="230" stroke="#334155" stroke-width="1" opacity="0.3"/>

  <!-- CAUSAL CONE (highlighted) -->
  <!-- Initial values in V‚ÇÄ -->
  <circle cx="280" cy="160" r="25" fill="#1e3a5f" stroke="#3b82f6" stroke-width="2" filter="url(#cone-glow)"/>
  <text x="280" y="155" fill="#60a5fa" font-family="monospace" font-size="10" text-anchor="middle">count‚ÇÅ</text>
  <text x="280" y="170" fill="#94a3b8" font-family="monospace" font-size="7" text-anchor="middle">V‚ÇÄ</text>

  <circle cx="380" cy="140" r="25" fill="#1e3a5f" stroke="#3b82f6" stroke-width="2" filter="url(#cone-glow)"/>
  <text x="380" y="135" fill="#60a5fa" font-family="monospace" font-size="10" text-anchor="middle">count‚ÇÇ</text>
  <text x="380" y="150" fill="#94a3b8" font-family="monospace" font-size="7" text-anchor="middle">V‚ÇÄ</text>

  <circle cx="280" cy="280" r="25" fill="#1e3a5f" stroke="#3b82f6" stroke-width="2" filter="url(#cone-glow)"/>
  <text x="280" y="275" fill="#60a5fa" font-family="monospace" font-size="10" text-anchor="middle">count‚ÇÉ</text>
  <text x="280" y="290" fill="#94a3b8" font-family="monospace" font-size="7" text-anchor="middle">V‚ÇÄ</text>

  <!-- Intermediate values produced by patches -->
  <circle cx="420" cy="220" r="25" fill="#14532d" stroke="#22c55e" stroke-width="2" filter="url(#cone-glow)"/>
  <text x="420" y="215" fill="#22c55e" font-family="monospace" font-size="10" text-anchor="middle">sum_12</text>
  <text x="420" y="230" fill="#86efac" font-family="monospace" font-size="7" text-anchor="middle">Œº‚ÇÇ</text>

  <circle cx="480" cy="320" r="25" fill="#14532d" stroke="#22c55e" stroke-width="2" filter="url(#cone-glow)"/>
  <text x="480" y="315" fill="#22c55e" font-family="monospace" font-size="10" text-anchor="middle">sum_3</text>
  <text x="480" y="330" fill="#86efac" font-family="monospace" font-size="7" text-anchor="middle">Œº‚ÇÉ</text>

  <!-- TARGET VALUE -->
  <circle cx="560" cy="270" r="30" fill="#7c2d12" stroke="#f59e0b" stroke-width="3" filter="url(#cone-glow)"/>
  <text x="560" y="265" fill="#fbbf24" font-family="monospace" font-size="11" text-anchor="middle">total</text>
  <text x="560" y="280" fill="#f59e0b" font-family="monospace" font-size="8" text-anchor="middle">TARGET</text>

  <!-- Dependency arrows (in cone) -->
  <line x1="305" y1="165" x2="395" y2="205" stroke="#f59e0b" stroke-width="2" marker-end="url(#dep-arrow)"/>
  <line x1="380" y1="168" x2="400" y2="198" stroke="#f59e0b" stroke-width="2" marker-end="url(#dep-arrow)"/>
  <line x1="300" y1="270" x2="458" y2="308" stroke="#f59e0b" stroke-width="2" marker-end="url(#dep-arrow)"/>
  <line x1="443" y1="232" x2="533" y2="258" stroke="#f59e0b" stroke-width="2" marker-end="url(#dep-arrow)"/>
  <line x1="498" y1="305" x2="533" y2="278" stroke="#f59e0b" stroke-width="2" marker-end="url(#dep-arrow)"/>

  <!-- Tick labels on arrows -->
  <rect x="350" y="175" width="25" height="15" rx="3" fill="#7c2d12"/>
  <text x="362" y="185" fill="#fbbf24" font-family="monospace" font-size="8" text-anchor="middle">Œº‚ÇÇ</text>

  <rect x="365" y="290" width="25" height="15" rx="3" fill="#7c2d12"/>
  <text x="377" y="300" fill="#fbbf24" font-family="monospace" font-size="8" text-anchor="middle">Œº‚ÇÉ</text>

  <rect x="505" y="240" width="25" height="15" rx="3" fill="#7c2d12"/>
  <text x="517" y="250" fill="#fbbf24" font-family="monospace" font-size="8" text-anchor="middle">Œº‚ÇÖ</text>

  <!-- Slice Payload Panel -->
  <rect x="650" y="80" width="320" height="200" rx="8" fill="#1e293b" stroke="#f59e0b" stroke-width="2"/>
  <text x="670" y="105" fill="#f59e0b" font-family="monospace" font-size="12">SLICE PAYLOAD P|_{D(v)}</text>

  <text x="670" y="135" fill="#94a3b8" font-family="monospace" font-size="10">Required patches for "total":</text>

  <rect x="670" y="150" width="280" height="25" rx="4" fill="#14532d" stroke="#22c55e"/>
  <text x="685" y="168" fill="#22c55e" font-family="monospace" font-size="10">Œº‚ÇÇ: Add(count‚ÇÅ, count‚ÇÇ) ‚Üí sum_12</text>

  <rect x="670" y="180" width="280" height="25" rx="4" fill="#14532d" stroke="#22c55e"/>
  <text x="685" y="198" fill="#22c55e" font-family="monospace" font-size="10">Œº‚ÇÉ: Add(count‚ÇÉ) ‚Üí sum_3</text>

  <rect x="670" y="210" width="280" height="25" rx="4" fill="#14532d" stroke="#22c55e"/>
  <text x="685" y="228" fill="#22c55e" font-family="monospace" font-size="10">Œº‚ÇÖ: Add(sum_12, sum_3) ‚Üí total</text>

  <text x="670" y="260" fill="#64748b" font-family="monospace" font-size="9">Skipped: Œº‚ÇÄ, Œº‚ÇÅ, Œº‚ÇÑ, Œº‚ÇÜ, Œº‚Çá, Œº‚Çà</text>

  <!-- Comparison stats -->
  <rect x="650" y="300" width="320" height="180" rx="8" fill="#1e293b" stroke="#334155"/>
  <text x="670" y="325" fill="#94a3b8" font-family="monospace" font-size="12">SLICING EFFICIENCY</text>

  <!-- Full payload bar -->
  <text x="670" y="355" fill="#64748b" font-family="monospace" font-size="10">Full payload:</text>
  <rect x="670" y="365" width="280" height="20" rx="4" fill="#334155"/>
  <rect x="670" y="365" width="280" height="20" rx="4" fill="#3b82f6"/>
  <text x="810" y="380" fill="#fff" font-family="monospace" font-size="9" text-anchor="middle">9 patches</text>

  <!-- Slice payload bar -->
  <text x="670" y="410" fill="#64748b" font-family="monospace" font-size="10">Slice payload:</text>
  <rect x="670" y="420" width="280" height="20" rx="4" fill="#334155"/>
  <rect x="670" y="420" width="93" height="20" rx="4" fill="#22c55e"/>
  <text x="716" y="435" fill="#fff" font-family="monospace" font-size="9" text-anchor="middle">3 patches</text>

  <!-- Savings -->
  <text x="670" y="465" fill="#22c55e" font-family="monospace" font-size="14">67% reduction</text>
  <text x="800" y="465" fill="#64748b" font-family="monospace" font-size="10">(6 patches skipped)</text>

  <!-- Value selector -->
  <rect x="30" y="500" width="600" height="80" rx="8" fill="#1e293b" stroke="#334155"/>
  <text x="50" y="525" fill="#94a3b8" font-family="monospace" font-size="11">SELECT TARGET VALUE</text>

  <!-- Value chips -->
  <rect x="50" y="540" width="80" height="28" rx="14" fill="#334155"/>
  <text x="90" y="559" fill="#94a3b8" font-family="monospace" font-size="10" text-anchor="middle">count‚ÇÅ</text>

  <rect x="140" y="540" width="80" height="28" rx="14" fill="#334155"/>
  <text x="180" y="559" fill="#94a3b8" font-family="monospace" font-size="10" text-anchor="middle">count‚ÇÇ</text>

  <rect x="230" y="540" width="80" height="28" rx="14" fill="#334155"/>
  <text x="270" y="559" fill="#94a3b8" font-family="monospace" font-size="10" text-anchor="middle">sum_12</text>

  <rect x="320" y="540" width="70" height="28" rx="14" fill="#7c2d12" stroke="#f59e0b" stroke-width="2"/>
  <text x="355" y="559" fill="#fbbf24" font-family="monospace" font-size="10" text-anchor="middle">total ‚úì</text>

  <rect x="400" y="540" width="80" height="28" rx="14" fill="#334155"/>
  <text x="440" y="559" fill="#94a3b8" font-family="monospace" font-size="10" text-anchor="middle">status</text>

  <rect x="490" y="540" width="80" height="28" rx="14" fill="#334155"/>
  <text x="530" y="559" fill="#94a3b8" font-family="monospace" font-size="10" text-anchor="middle">name</text>

  <!-- Actions -->
  <rect x="650" y="500" width="320" height="80" rx="8" fill="#1e293b" stroke="#334155"/>

  <rect x="670" y="520" width="130" height="35" rx="6" fill="#22c55e"/>
  <text x="735" y="543" fill="#fff" font-family="monospace" font-size="11" text-anchor="middle">‚ñ∂ Replay Slice</text>

  <rect x="820" y="520" width="130" height="35" rx="6" fill="#334155"/>
  <text x="885" y="543" fill="#94a3b8" font-family="monospace" font-size="11" text-anchor="middle">üì§ Export Slice</text>

  <!-- Legend -->
  <rect x="30" y="600" width="940" height="80" rx="8" fill="#0f172a" stroke="#334155"/>

  <circle cx="60" cy="640" r="12" fill="#1e3a5f" stroke="#3b82f6" stroke-width="2"/>
  <text x="80" y="645" fill="#64748b" font-family="monospace" font-size="10">Initial value (V‚ÇÄ)</text>

  <circle cx="220" cy="640" r="12" fill="#14532d" stroke="#22c55e" stroke-width="2"/>
  <text x="240" y="645" fill="#64748b" font-family="monospace" font-size="10">Produced value (in D(v))</text>

  <circle cx="420" cy="640" r="12" fill="#7c2d12" stroke="#f59e0b" stroke-width="2"/>
  <text x="440" y="645" fill="#64748b" font-family="monospace" font-size="10">Target value</text>

  <circle cx="580" cy="640" r="12" fill="#1e293b" stroke="#334155" stroke-width="1" opacity="0.4"/>
  <text x="600" y="645" fill="#64748b" font-family="monospace" font-size="10">Outside cone (skipped)</text>

  <line x1="750" y1="640" x2="790" y2="640" stroke="#f59e0b" stroke-width="2" marker-end="url(#dep-arrow)"/>
  <text x="800" y="645" fill="#64748b" font-family="monospace" font-size="10">Dependency</text>
</svg>
