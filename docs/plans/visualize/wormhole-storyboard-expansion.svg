<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 400">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <path d="M0,0 L0,6 L9,3 z" fill="#666"/>
    </marker>
    <marker id="arrow-blue" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <path d="M0,0 L0,6 L9,3 z" fill="#2196f3"/>
    </marker>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.3"/>
    </filter>
    <linearGradient id="wormhole-grad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" stop-color="#9c27b0"/>
      <stop offset="50%" stop-color="#ce93d8"/>
      <stop offset="100%" stop-color="#9c27b0"/>
    </linearGradient>
    <filter id="glow-purple">
      <feGaussianBlur stdDeviation="2" result="blur"/>
      <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
    </filter>
    <filter id="glow-blue">
      <feGaussianBlur stdDeviation="2" result="blur"/>
      <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
    </filter>
  </defs>

  <!-- Title -->
  <text x="450" y="25" text-anchor="middle" font-family="system-ui, sans-serif" font-size="16" font-weight="bold" fill="#333">Expansion Animation Storyboard</text>

  <!-- Panel 1: Click on wormhole -->
  <g transform="translate(30, 50)">
    <rect width="270" height="180" rx="8" fill="#fff" stroke="#ddd" stroke-width="2" filter="url(#shadow)"/>
    <rect width="270" height="24" rx="8" fill="#f3e5f5" stroke="#9c27b0" stroke-width="1"/>
    <text x="135" y="16" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" fill="#7b1fa2">Frame 1: Click Wormhole</text>

    <!-- Entry state -->
    <circle cx="50" cy="100" r="18" fill="#e3f2fd" stroke="#2196f3" stroke-width="2"/>
    <text x="50" y="105" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" fill="#1565c0">U0</text>

    <!-- Exit state -->
    <circle cx="170" cy="100" r="18" fill="#e3f2fd" stroke="#2196f3" stroke-width="2"/>
    <text x="170" y="105" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" fill="#1565c0">U3</text>

    <!-- Wormhole curved edge with click indicator -->
    <path d="M68,90 Q110,45 152,90" stroke="url(#wormhole-grad)" stroke-width="5" fill="none" filter="url(#glow-purple)"/>

    <!-- Click ring animation effect -->
    <circle cx="110" cy="55" r="12" fill="none" stroke="#9c27b0" stroke-width="2" opacity="0.6"/>
    <circle cx="110" cy="55" r="18" fill="none" stroke="#9c27b0" stroke-width="1" opacity="0.3"/>
    <circle cx="110" cy="55" r="24" fill="none" stroke="#9c27b0" stroke-width="0.5" opacity="0.15"/>

    <!-- Wormhole label -->
    <rect x="92" y="48" width="36" height="16" rx="4" fill="#9c27b0"/>
    <text x="110" y="60" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="white" font-weight="bold">W1</text>

    <!-- Cursor pointer -->
    <path d="M122,55 L122,72 L129,66 L125,66 L130,76 L127,77 L122,68 L122,72" fill="#333"/>

    <!-- Remainder states -->
    <circle cx="210" cy="100" r="12" fill="#e3f2fd" stroke="#2196f3" stroke-width="1.5"/>
    <text x="210" y="104" text-anchor="middle" font-family="system-ui, sans-serif" font-size="8" fill="#1565c0">U4</text>

    <circle cx="245" cy="100" r="14" fill="#e3f2fd" stroke="#2196f3" stroke-width="2"/>
    <text x="245" y="105" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#1565c0">U5</text>

    <path d="M188,100 L196,100" stroke="#666" stroke-width="1" marker-end="url(#arrow)"/>
    <path d="M222,100 L229,100" stroke="#666" stroke-width="1" marker-end="url(#arrow)"/>

    <!-- Caption -->
    <text x="135" y="145" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#333">Double-click wormhole W1</text>
    <text x="135" y="160" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#333">to expand interior</text>
    <text x="135" y="175" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#9c27b0">or press 'E' key</text>
  </g>

  <!-- Arrow 1-2 -->
  <path d="M310,140 L320,140" stroke="#666" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Panel 2: Wormhole opens (elastic effect) -->
  <g transform="translate(330, 50)">
    <rect width="270" height="180" rx="8" fill="#fff" stroke="#ddd" stroke-width="2" filter="url(#shadow)"/>
    <rect width="270" height="24" rx="8" fill="#fff3e0" stroke="#ff9800" stroke-width="1"/>
    <text x="135" y="16" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" fill="#e65100">Frame 2: Opening</text>

    <!-- Entry state moving left -->
    <circle cx="35" cy="100" r="18" fill="#e3f2fd" stroke="#2196f3" stroke-width="2"/>
    <text x="35" y="105" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" fill="#1565c0">U0</text>

    <!-- Exit state moving right -->
    <circle cx="185" cy="100" r="18" fill="#e3f2fd" stroke="#2196f3" stroke-width="2"/>
    <text x="185" y="105" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" fill="#1565c0">U3</text>

    <!-- Elastic stretching wormhole -->
    <path d="M53,90 Q110,30 167,90" stroke="url(#wormhole-grad)" stroke-width="3" fill="none" stroke-dasharray="6,3" filter="url(#glow-purple)"/>

    <!-- Interior appearing as ghosts -->
    <circle cx="75" cy="100" r="10" fill="#e1bee7" stroke="#9c27b0" stroke-width="1" opacity="0.5" stroke-dasharray="3,2"/>
    <text x="75" y="104" text-anchor="middle" font-family="system-ui, sans-serif" font-size="7" fill="#9c27b0" opacity="0.6">U1</text>

    <circle cx="110" cy="100" r="8" fill="#e1bee7" stroke="#9c27b0" stroke-width="1" opacity="0.4" stroke-dasharray="3,2"/>
    <text x="110" y="103" text-anchor="middle" font-family="system-ui, sans-serif" font-size="6" fill="#9c27b0" opacity="0.5">U2</text>

    <circle cx="145" cy="100" r="10" fill="#e1bee7" stroke="#9c27b0" stroke-width="1" opacity="0.5" stroke-dasharray="3,2"/>

    <!-- Motion arrows -->
    <path d="M20,100 L12,100" stroke="#ff9800" stroke-width="2" marker-end="url(#arrow)"/>
    <path d="M200,100 L208,100" stroke="#ff9800" stroke-width="2"/>
    <polygon points="208,96 215,100 208,104" fill="#ff9800"/>

    <!-- Expanding label -->
    <text x="110" y="55" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#9c27b0" font-style="italic">expanding...</text>

    <!-- Spring indicator lines -->
    <path d="M53,85 C58,82 62,88 67,85 C72,82 76,88 81,85" stroke="#ff9800" stroke-width="1.5" fill="none"/>
    <path d="M139,85 C144,82 148,88 153,85 C158,82 162,88 167,85" stroke="#ff9800" stroke-width="1.5" fill="none"/>

    <!-- Remainder states (pushed aside) -->
    <circle cx="225" cy="100" r="10" fill="#e3f2fd" stroke="#2196f3" stroke-width="1.5" opacity="0.7"/>
    <text x="225" y="104" text-anchor="middle" font-family="system-ui, sans-serif" font-size="7" fill="#1565c0">U4</text>

    <circle cx="255" cy="100" r="12" fill="#e3f2fd" stroke="#2196f3" stroke-width="1.5" opacity="0.7"/>
    <text x="255" y="104" text-anchor="middle" font-family="system-ui, sans-serif" font-size="8" fill="#1565c0">U5</text>

    <!-- Caption -->
    <text x="135" y="145" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#333">Elastic spring animation</text>
    <text x="135" y="160" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#333">opens space for interior</text>
    <text x="135" y="175" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#999">States materialize progressively</text>
  </g>

  <!-- Arrow 2-3 -->
  <path d="M610,140 L620,140" stroke="#666" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Panel 3: Interior states materialize -->
  <g transform="translate(630, 50)">
    <rect width="260" height="180" rx="8" fill="#fff" stroke="#4caf50" stroke-width="3" filter="url(#shadow)"/>
    <rect width="260" height="24" rx="8" fill="#e8f5e9" stroke="#4caf50" stroke-width="1"/>
    <text x="130" y="16" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" fill="#2e7d32">Frame 3: Expanded</text>

    <!-- Full expanded worldline -->
    <circle cx="30" cy="100" r="16" fill="#e3f2fd" stroke="#2196f3" stroke-width="2"/>
    <text x="30" y="105" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#1565c0">U0</text>

    <circle cx="70" cy="100" r="12" fill="#c8e6c9" stroke="#4caf50" stroke-width="2" filter="url(#glow-blue)"/>
    <text x="70" y="104" text-anchor="middle" font-family="system-ui, sans-serif" font-size="8" fill="#2e7d32">U1</text>

    <circle cx="110" cy="100" r="12" fill="#c8e6c9" stroke="#4caf50" stroke-width="2" filter="url(#glow-blue)"/>
    <text x="110" y="104" text-anchor="middle" font-family="system-ui, sans-serif" font-size="8" fill="#2e7d32">U2</text>

    <circle cx="150" cy="100" r="16" fill="#e3f2fd" stroke="#2196f3" stroke-width="2"/>
    <text x="150" y="105" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#1565c0">U3</text>

    <!-- Tick arrows with labels -->
    <path d="M46,100 L56,100" stroke="#4caf50" stroke-width="1.5" marker-end="url(#arrow)"/>
    <text x="51" y="92" font-family="system-ui, sans-serif" font-size="7" fill="#4caf50">m0</text>

    <path d="M82,100 L96,100" stroke="#4caf50" stroke-width="1.5" marker-end="url(#arrow)"/>
    <text x="89" y="92" font-family="system-ui, sans-serif" font-size="7" fill="#4caf50">m1</text>

    <path d="M122,100 L136,100" stroke="#4caf50" stroke-width="1.5" marker-end="url(#arrow)"/>
    <text x="129" y="92" font-family="system-ui, sans-serif" font-size="7" fill="#4caf50">m2</text>

    <!-- Expanded interior bracket -->
    <path d="M55,120 L55,128 L125,128 L125,120" stroke="#4caf50" stroke-width="1.5" fill="none"/>
    <text x="90" y="140" text-anchor="middle" font-family="system-ui, sans-serif" font-size="8" fill="#4caf50">expanded interior</text>

    <!-- Remainder -->
    <circle cx="195" cy="100" r="10" fill="#e3f2fd" stroke="#2196f3" stroke-width="1.5"/>
    <text x="195" y="104" text-anchor="middle" font-family="system-ui, sans-serif" font-size="7" fill="#1565c0">U4</text>

    <circle cx="235" cy="100" r="14" fill="#e3f2fd" stroke="#2196f3" stroke-width="2"/>
    <text x="235" y="105" text-anchor="middle" font-family="system-ui, sans-serif" font-size="9" fill="#1565c0">U5</text>

    <path d="M166,100 L183,100" stroke="#666" stroke-width="1" marker-end="url(#arrow)"/>
    <path d="M205,100 L219,100" stroke="#666" stroke-width="1" marker-end="url(#arrow)"/>

    <!-- Caption -->
    <text x="130" y="160" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#333">Interior states U1, U2</text>
    <text x="130" y="175" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#333">fully materialized</text>
  </g>

  <!-- Legend -->
  <g transform="translate(30, 245)">
    <rect width="860" height="70" rx="8" fill="#fafafa" stroke="#e0e0e0" stroke-width="1"/>
    <text x="20" y="20" font-family="system-ui, sans-serif" font-size="11" font-weight="bold" fill="#333">Legend</text>

    <!-- Wormhole edge -->
    <path d="M30,50 Q55,30 80,50" stroke="#9c27b0" stroke-width="3" fill="none"/>
    <text x="95" y="54" font-family="system-ui, sans-serif" font-size="10" fill="#333">Compressed wormhole</text>

    <!-- Click indicator -->
    <circle cx="220" cy="45" r="8" fill="none" stroke="#9c27b0" stroke-width="1.5"/>
    <circle cx="220" cy="45" r="12" fill="none" stroke="#9c27b0" stroke-width="1" opacity="0.5"/>
    <text x="240" y="49" font-family="system-ui, sans-serif" font-size="10" fill="#333">Click event</text>

    <!-- Ghost state -->
    <circle cx="340" cy="45" r="8" fill="#e1bee7" stroke="#9c27b0" stroke-width="1" opacity="0.5" stroke-dasharray="3,2"/>
    <text x="360" y="49" font-family="system-ui, sans-serif" font-size="10" fill="#333">Materializing state</text>

    <!-- Materialized state -->
    <circle cx="490" cy="45" r="8" fill="#c8e6c9" stroke="#4caf50" stroke-width="2"/>
    <text x="510" y="49" font-family="system-ui, sans-serif" font-size="10" fill="#333">Materialized interior</text>

    <!-- Spring -->
    <path d="M620,45 C625,42 630,48 635,45 C640,42 645,48 650,45" stroke="#ff9800" stroke-width="2" fill="none"/>
    <text x="665" y="49" font-family="system-ui, sans-serif" font-size="10" fill="#333">Elastic animation</text>

    <!-- Motion arrow -->
    <path d="M780,45 L800,45" stroke="#ff9800" stroke-width="2"/>
    <polygon points="800,41 810,45 800,49" fill="#ff9800"/>
    <text x="820" y="49" font-family="system-ui, sans-serif" font-size="10" fill="#333">Motion</text>
  </g>

  <!-- Expansion info box -->
  <g transform="translate(30, 325)">
    <rect width="860" height="65" rx="8" fill="#e3f2fd" stroke="#2196f3" stroke-width="1"/>
    <text x="20" y="22" font-family="system-ui, sans-serif" font-size="11" font-weight="bold" fill="#1565c0">Expansion Details</text>

    <text x="20" y="42" font-family="system-ui, sans-serif" font-size="10" fill="#333">Sub-payload P0:3 = (m0, m1, m2) is replayed to materialize U1 and U2</text>
    <text x="20" y="57" font-family="system-ui, sans-serif" font-size="10" fill="#333">Verification: h_out computed from replay matches stored boundary hash</text>

    <rect x="580" y="28" width="130" height="28" rx="6" fill="#bbdefb" stroke="#2196f3"/>
    <text x="645" y="46" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#1565c0" font-weight="bold">Replay(P0:3)</text>

    <rect x="720" y="28" width="130" height="28" rx="6" fill="#c8e6c9" stroke="#4caf50"/>
    <text x="785" y="46" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#2e7d32" font-weight="bold">Verified</text>
  </g>
</svg>
